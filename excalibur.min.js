/*! excalibur - v0.10.0-alpha.1603+a24cdb6 - 2017-06-10
* https://github.com/excaliburjs/Excalibur
* Copyright (c) 2017 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>; Licensed BSD-2-Clause
* @preserve */
!function(a,b){"function"==typeof define&&define.amd?define([],function(c){return a.ex=b(c)}):"object"==typeof module&&module.exports?module.exports=b():a.ex=b()}(this,function(){/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */
var a,b,c;!function(d){function e(a,b){return v.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=t.map,q=p&&p["*"]||{};if(a){for(a=a.split("/"),g=a.length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if(e=p[o.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){var c=w.call(arguments,0);return"string"!=typeof c[0]&&1===c.length&&c.push(null),o.apply(d,c.concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){r[a]=b}}function j(a){if(e(s,a)){var b=s[a];delete s[a],u[a]=!0,n.apply(d,b)}if(!e(r,a)&&!e(u,a))throw new Error("No "+a);return r[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return a?k(a):[]}function m(a){return function(){return t&&t.config&&t.config[a]||{}}}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var c,d=k(a),e=d[0],g=b[1];return a=d[1],e&&(e=f(e,g),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(g)):f(a,g):(a=f(a,g),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},q={require:function(a){return g(a)},exports:function(a){var b=r[a];return"undefined"!=typeof b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:m(a)}}},n=function(a,b,c,f){var h,k,m,n,o,t,v,w=[],x=typeof c;if(f=f||a,t=l(f),"undefined"===x||"function"===x){for(b=!b.length&&c.length?["require","exports","module"]:b,o=0;o<b.length;o+=1)if(n=p(b[o],t),k=n.f,"require"===k)w[o]=q.require(a);else if("exports"===k)w[o]=q.exports(a),v=!0;else if("module"===k)h=w[o]=q.module(a);else if(e(r,k)||e(s,k)||e(u,k))w[o]=j(k);else{if(!n.p)throw new Error(a+" missing "+k);n.p.load(n.n,g(f,!0),i(k),{}),w[o]=r[k]}m=c?c.apply(r[a],w):void 0,a&&(h&&h.exports!==d&&h.exports!==r[a]?r[a]=h.exports:m===d&&v||(r[a]=m))}else a&&(r[a]=c)},a=b=o=function(a,b,c,e,f){if("string"==typeof a)return q[a]?q[a](b):j(p(a,l(b)).f);if(!a.splice){if(t=a,t.deps&&o(t.deps,t.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?n(d,a,b,c):setTimeout(function(){n(d,a,b,c)},4),o},o.config=function(a){return o(a)},a._defined=r,c=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(r,a)||e(s,a)||(s[a]=[a,b,c])},c.amd={jQuery:!0}}();/*! excalibur - v0.10.0-alpha.1603+a24cdb6 - 2017-06-10
* https://github.com/excaliburjs/Excalibur
* Copyright (c) 2017 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>; Licensed BSD-2-Clause
* @preserve */
var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();return c("Actions/RotationType",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.ShortestPath=0]="ShortestPath",a[a.LongestPath=1]="LongestPath",a[a.Clockwise=2]="Clockwise",a[a.CounterClockwise=3]="CounterClockwise"}(c=b.RotationType||(b.RotationType={}))}),c("Algebra",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.x=a,this.y=b}return a.fromAngle=function(b){return new a(Math.cos(b),Math.sin(b))},a.isValid=function(a){return null!==a&&void 0!==a&&(!isNaN(a.x)&&!isNaN(a.y)&&(a.x!==1/0&&a.y!==1/0&&a.x!==-(1/0)&&a.y!==1/0))},a.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},a.prototype.setTo=function(a,b){this.x=a,this.y=b},a.prototype.equals=function(a,b){return void 0===b&&(b=.001),Math.abs(this.x-a.x)<=b&&Math.abs(this.y-a.y)<=b},a.prototype.distance=function(b){return b||(b=a.Zero),Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},a.prototype.magnitude=function(){return this.distance()},a.prototype.normalize=function(){var b=this.distance();return b>0?new a(this.x/b,this.y/b):new a(0,1)},a.prototype.average=function(a){return this.add(a).scale(.5)},a.prototype.scale=function(b){return new a(this.x*b,this.y*b)},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.addEqual=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.subEqual=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.scaleEqual=function(a){return this.x*=a,this.y*=a,this},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(b){return b instanceof a?this.x*b.y-this.y*b.x:"number"==typeof b?new a(b*this.y,-b*this.x):void 0},a.prototype.perpendicular=function(){return new a(this.y,-this.x)},a.prototype.normal=function(){return this.perpendicular().normalize()},a.prototype.negate=function(){return this.scale(-1)},a.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},a.prototype.rotate=function(b,c){c||(c=new a(0,0));var d=Math.sin(b),e=Math.cos(b),f=e*(this.x-c.x)-d*(this.y-c.y)+c.x,g=d*(this.x-c.x)+e*(this.y-c.y)+c.y;return new a(f,g)},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.toString=function(){return"("+this.x+", "+this.y+")"},a}();c.Zero=new c(0,0),c.One=new c(1,1),c.Half=new c(.5,.5),c.Up=new c(0,-1),c.Down=new c(0,1),c.Left=new c(-1,0),c.Right=new c(1,0),b.Vector=c;var d=function(){function a(a,b){this.pos=a,this.dir=b.normalize()}return a.prototype.intersect=function(a){var b=a.begin.sub(this.pos);if(0===this.dir.cross(a.getSlope())&&0!==b.cross(this.dir))return-1;var c=this.dir.cross(a.getSlope());if(0===c)return-1;var d=b.cross(a.getSlope())/c;if(d>=0){var e=b.cross(this.dir)/c/a.getLength();if(e>=0&&e<=1)return d}return-1},a.prototype.getPoint=function(a){return this.pos.add(this.dir.scale(a))},a}();b.Ray=d;var e=function(){function a(a,b){this.begin=a,this.end=b}return Object.defineProperty(a.prototype,"slope",{get:function(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"intercept",{get:function(){return this.begin.y-this.slope*this.begin.x},enumerable:!0,configurable:!0}),a.prototype.getSlope=function(){var a=this.begin,b=this.end,c=a.distance(b);return b.sub(a).scale(1/c)},a.prototype.getLength=function(){var a=this.begin,b=this.end,c=a.distance(b);return c},a.prototype.findPoint=function(a,b){void 0===a&&(a=null),void 0===b&&(b=null);var d=this.slope,e=this.intercept;if(null!==a)return new c(a,d*a+e);if(null!==b)return new c((b-e)/d,b);throw new Error("You must provide an X or a Y value")},a.prototype.hasPoint=function(){var a,b=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])a=new c(arguments[0],arguments[1]),b=arguments[2]||0;else{if(!(arguments[0]instanceof c))throw"Could not determine the arguments for Vector.hasPoint";a=arguments[0],b=arguments[1]||0}var d=a.x-this.begin.x,e=a.y-this.begin.y,f=this.end.x-this.begin.x,g=this.end.y-this.begin.y,h=d*g-e*f;return!(Math.abs(h)>b)&&(Math.abs(f)>=Math.abs(g)?f>0?this.begin.x<=a.x&&a.x<=this.end.x:this.end.x<=a.x&&a.x<=this.begin.x:g>0?this.begin.y<=a.y&&a.y<=this.end.y:this.end.y<=a.y&&a.y<=this.begin.y)},a}();b.Line=e;var f=function(){function a(a,b){this.min=a,this.max=b}return a.prototype.overlaps=function(a){return this.max>a.min&&a.max>this.min},a.prototype.getOverlap=function(a){return this.overlaps(a)?this.max>a.max?a.max-this.min:this.max-a.min:0},a}();b.Projection=f}),c("Physics",["require","exports","Algebra"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.Box=0]="Box",a[a.RigidBody=1]="RigidBody"}(d=b.CollisionResolutionStrategy||(b.CollisionResolutionStrategy={}));var e;!function(a){a[a.Naive=0]="Naive",a[a.DynamicAABBTree=1]="DynamicAABBTree"}(e=b.BroadphaseStrategy||(b.BroadphaseStrategy={}));var f;!function(a){a[a.Euler=0]="Euler"}(f=b.Integrator||(b.Integrator={}));var g=function(){function a(){}return a.useBoxPhysics=function(){a.collisionResolutionStrategy=d.Box},a.useRigidBodyPhysics=function(){a.collisionResolutionStrategy=d.RigidBody},a}();g.acc=new c.Vector(0,0),g.enabled=!0,g.collisionPasses=5,g.broadphaseStrategy=e.DynamicAABBTree,g.broadphaseDebug=!1,g.showCollisionNormals=!1,g.showMotionVectors=!1,g.showBounds=!1,g.showArea=!1,g.showContacts=!1,g.showNormals=!1,g.collisionResolutionStrategy=d.Box,g.defaultMass=10,g.integrator=f.Euler,g.integrationSteps=1,g.allowRigidBodyRotation=!0,g.collisionShift=.001,g.dynamicTreeVelocityMultiplyer=2,g.boundsPadding=5,g.surfaceEpsilon=.1,g.checkForFastBodies=!0,g.disableMinimumSpeedForFastBody=!1,b.Physics=g}),c("Util/EasingFunctions",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a}();c.Linear=function(a,b,c,d){return c-=b,c*a/d+b},c.EaseInQuad=function(a,b,c,d){return c-=b,a/=d,c*a*a+b},c.EaseOutQuad=function(a,b,c,d){return c-=b,a/=d,-c*a*(a-2)+b},c.EaseInOutQuad=function(a,b,c,d){return c-=b,a/=d/2,a<1?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},c.EaseInCubic=function(a,b,c,d){return c-=b,a/=d,c*a*a*a+b},c.EaseOutCubic=function(a,b,c,d){return c-=b,a/=d,a--,c*(a*a*a+1)+b},c.EaseInOutCubic=function(a,b,c,d){return c-=b,a/=d/2,a<1?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b)},b.EasingFunctions=c}),c("Util/Log",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.Debug=0]="Debug",a[a.Info=1]="Info",a[a.Warn=2]="Warn",a[a.Error=3]="Error",a[a.Fatal=4]="Fatal"}(c=b.LogLevel||(b.LogLevel={}));var d=function(){function a(){if(this._appenders=[],this.defaultLevel=c.Info,a._instance)throw new Error("Logger is a singleton");return a._instance=this,a._instance.addAppender(new e),a._instance}return a.getInstance=function(){return null==a._instance&&(a._instance=new a),a._instance},a.prototype.addAppender=function(a){this._appenders.push(a)},a.prototype.clearAppenders=function(){this._appenders.length=0},a.prototype._log=function(a,b){null==a&&(a=this.defaultLevel);var c=0,d=this._appenders.length;for(c;c<d;c++)a>=this.defaultLevel&&this._appenders[c].log(a,b)},a.prototype.debug=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._log(c.Debug,a)},a.prototype.info=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._log(c.Info,a)},a.prototype.warn=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._log(c.Warn,a)},a.prototype.error=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._log(c.Error,a)},a.prototype.fatal=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._log(c.Fatal,a)},a}();d._instance=null,b.Logger=d;var e=function(){function a(){}return a.prototype.log=function(a,b){if(console||console.log||!console.warn||!console.error){var d=[];d.unshift.apply(d,b),d.unshift("["+c[a]+"] : "),a<c.Warn?console.log.apply?console.log.apply(console,d):console.log(d.join(" ")):a<c.Error?console.warn.apply?console.warn.apply(console,d):console.warn(d.join(" ")):console.error.apply?console.error.apply(console,d):console.error(d.join(" "))}},a}();b.ConsoleAppender=e;var f=function(){function a(a,b){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=a||window.innerWidth,this._canvas.height=b||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return a.prototype.log=function(a,b){var d=b.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+c[a]+"] : "+d);for(var e=10,f=1,g=0;g<this._messages.length;g++)this._ctx.fillStyle="rgba(255,255,255,"+f.toFixed(2)+")",this._ctx.fillText(this._messages[g],200,e),e+=10,f=f>0?f-.05:0},a}();b.ScreenAppender=f}),c("Collision/Side",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c;!function(a){a[a.None=0]="None",a[a.Top=1]="Top",a[a.Bottom=2]="Bottom",a[a.Left=3]="Left",a[a.Right=4]="Right"}(c=b.Side||(b.Side={}))}),c("Util/Util",["require","exports","Algebra","Collision/Side"],function(a,b,c,d){"use strict";function e(){var a={},b=!1,c=0,d=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],c++);var f="function"==typeof Object.assign,g=null;for(g=f?Object.assign:function(c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(b&&"[object Object]"===Object.prototype.toString.call(c[d])?a[d]=e(!0,a[d],c[d]):a[d]=c[d])};c<d;c++){var h=arguments[c];f?g(a,h):g(h)}return a}function f(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0;d<a.length;){var e,f,g=255&a.charCodeAt(d++),h=255&a.charCodeAt(d++),i=255&a.charCodeAt(d++),j=g>>2,k=(3&g)<<4|h>>4;isNaN(h)?e=f=64:(e=(15&h)<<2|i>>6,f=isNaN(i)?64:63&i),c+=b.charAt(j)+b.charAt(k)+b.charAt(e)+b.charAt(f)}return c}function g(a,b,c){return Math.min(Math.max(b,a),c)}function h(a,b){return a+Math.random()*(b-a)}function i(a,b){return Math.round(h(a,b))}function j(a){var c=a;if(a>b.TwoPI)for(;c>b.TwoPI;)c-=b.TwoPI;if(a<0)for(;c<0;)c+=b.TwoPI;return c}function k(a){return 180/Math.PI*a}function l(a){return a/180*Math.PI}function m(a){var b=0,d=0,e=function(a){b+=a.offsetLeft,a.offsetParent&&e(a.offsetParent)},f=function(a){d+=a.offsetTop,a.offsetParent&&f(a.offsetParent)};return e(a),f(a),new c.Vector(b,d)}function n(a,b){return b.indexOf(a)===-1&&(b.push(a),!0)}function o(a,b){var c=-1;return(c=b.indexOf(a))>-1&&(b.splice(c,1),!0)}function p(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}function q(a){return a===d.Side.Top?d.Side.Bottom:a===d.Side.Bottom?d.Side.Top:a===d.Side.Left?d.Side.Right:a===d.Side.Right?d.Side.Left:d.Side.None}function r(a){for(var b=[c.Vector.Left,c.Vector.Right,c.Vector.Up,c.Vector.Down],e=[d.Side.Left,d.Side.Right,d.Side.Top,d.Side.Bottom],f=-Number.MAX_VALUE,g=-1,h=0;h<b.length;h++)b[h].dot(a)>f&&(f=b[h].dot(a),g=h);return e[g]}Object.defineProperty(b,"__esModule",{value:!0}),b.TwoPI=2*Math.PI,b.extend=e,b.base64Encode=f,b.clamp=g,b.randomInRange=h,b.randomIntInRange=i,b.canonicalizeAngle=j,b.toDegrees=k,b.toRadians=l,b.getPosition=m,b.addItemToArray=n,b.removeItemFromArray=o,b.contains=p,b.getOppositeSide=q,b.getSideFromVector=r;var s=function(){function a(b){void 0===b&&(b=a.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=new Array(b)}return a.prototype._resize=function(){for(var a=2*this._internalArray.length,b=new Array(a),c=this.count(),d=0;d<c;d++)b[d]=this._internalArray[d];delete this._internalArray,this._internalArray=b},a.prototype.push=function(a){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=a},a.prototype.pop=function(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]},a.prototype.count=function(){return this._endPointer},a.prototype.clear=function(){this._endPointer=0},a.prototype.internalSize=function(){return this._internalArray.length},a.prototype.elementAt=function(a){if(a>=this.count())throw new Error("Invalid index "+a);return this._internalArray[a]},a.prototype.insert=function(a,b){return a>=this.count()&&this._resize(),this._internalArray[a]=b},a.prototype.remove=function(a){var b=this.count();if(0===b)throw new Error("Invalid parameter "+a);for(var c=this._internalArray[a],d=a;d<b;d++)this._internalArray[d]=this._internalArray[d+1];return this._endPointer--,c},a.prototype.removeElement=function(a){var b=this._internalArray.indexOf(a);this.remove(b)},a.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},a.prototype.forEach=function(a){var b=0,c=this.count();for(b;b<c;b++)a.call(this,this._internalArray[b],b)},a.prototype.map=function(a){for(var b=this.count(),c=0;c<b;c++)this._internalArray[c]=a.call(this,this._internalArray[c],c)},a}();s.DefaultSize=200,b.Collection=s}),c("Util/Decorators",["require","exports","Util/Log","Util/Util"],function(a,b,c,d){"use strict";function e(a){return a=d.extend({},{message:"This method will be removed in future versions of Excalibur.",alternateMethod:null},a),function(b,e,f){if("function"!=typeof f.value&&"function"!=typeof f.get&&"function"!=typeof f.set)throw new SyntaxError("Only functions/getters/setters can be marked as obsolete");var g=""+(b.name||"")+(b.name?".":"")+e,h=g+" is marked obsolete: "+a.message+(a.alternateMethod?" Use "+a.alternateMethod+" instead":""),i=d.extend({},f);return f.value?(i.value=function(){return c.Logger.getInstance().warn(h),f.value.apply(this,arguments)},i):(f.get&&(i.get=function(){return c.Logger.getInstance().warn(h),f.get.apply(this,arguments)}),f.set&&(i.set=function(){return c.Logger.getInstance().warn(h),f.set.apply(this,arguments)}),i)}}Object.defineProperty(b,"__esModule",{value:!0}),b.obsolete=e}),c("Promises",["require","exports","Util/Decorators"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e;!function(a){a[a.Resolved=0]="Resolved",a[a.Rejected=1]="Rejected",a[a.Pending=2]="Pending"}(e=b.PromiseState||(b.PromiseState={}));var f=function(){function a(){this._state=e.Pending,this._successCallbacks=[],this._rejectCallback=function(){}}return a.wrap=function(b){return a.resolve(b)},a.resolve=function(b){var c=(new a).resolve(b);return c},a.reject=function(b){var c=(new a).reject(b);return c},a.join=function(){var b=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(var c=0;c<arguments.length;c++)b[c-0]=arguments[c];else 1===arguments.length&&Array.isArray(arguments[0])&&(b=arguments[0]);var d=new a;if(!b||!b.length)return d.resolve();var e=b.length,f=0,g=0,h=[];return b.forEach(function(a){a.then(function(){f+=1,f===e?d.resolve():f+g+h.length===e&&d.reject(h)},function(){g+=1,f+g+h.length===e&&d.reject(h)}).error(function(a){h.push(a),h.length+f+g===e&&d.reject(h)})}),d},a.prototype.then=function(a,b){if(a&&(this._successCallbacks.push(a),this.state()===e.Resolved))try{a.call(this,this._value)}catch(a){this._handleError(a)}if(b&&(this._rejectCallback=b,this.state()===e.Rejected))try{b.call(this,this._value)}catch(a){this._handleError(a)}return this},a.prototype.error=function(a){return a&&(this._errorCallback=a),this},a.prototype.resolve=function(a){var b=this;if(this._state!==e.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=a;try{this._state=e.Resolved,this._successCallbacks.forEach(function(a){a.call(b,b._value)})}catch(a){this._handleError(a)}return this},a.prototype.reject=function(a){if(this._state!==e.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=a;try{this._state=e.Rejected,this._rejectCallback.call(this,this._value)}catch(a){this._handleError(a)}return this},a.prototype.state=function(){return this._state},a.prototype._handleError=function(a){if(!this._errorCallback)throw a;this._errorCallback.call(this,a)},a}();d([c.obsolete({alternateMethod:"ex.Promise.resolve/reject"})],f,"wrap",null),b.Promise=f}),c("Camera",["require","exports","Util/EasingFunctions","Promises","Algebra"],function(a,b,c,d,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(){this.z=1,this.dx=0,this.dy=0,this.dz=0,this.ax=0,this.ay=0,this.az=0,this.rotation=0,this.rx=0,this._x=0,this._y=0,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._maxZoomScale=1,this._zoomDuration=0,this._zoomIncrement=.01,this._easing=c.EasingFunctions.EaseInOutCubic}return Object.defineProperty(a.prototype,"x",{get:function(){return this._x},set:function(a){this._follow||this._cameraMoving||(this._x=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._y},set:function(a){this._follow||this._cameraMoving||(this._y=a)},enumerable:!0,configurable:!0}),a.prototype.setActorToFollow=function(a){this._follow=a},a.prototype.getFocus=function(){return new f.Vector(this.x,this.y)},a.prototype.move=function(a,b,e){if(void 0===e&&(e=c.EasingFunctions.EaseInOutCubic),"function"!=typeof e)throw"Please specify an EasingFunction";return this._follow?(new d.Promise).reject(a):(this._lerpPromise&&this._lerpPromise.state()===d.PromiseState.Pending&&this._lerpPromise.resolve(a),this._lerpPromise=new d.Promise,this._lerpStart=this.getFocus().clone(),this._lerpDuration=b,this._lerpEnd=a,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=e,this._lerpPromise)},a.prototype.shake=function(a,b,c){this._isShaking=!0,this._shakeMagnitudeX=a,this._shakeMagnitudeY=b,this._shakeDuration=c},a.prototype.zoom=function(a,b){return void 0===b&&(b=0),this._zoomPromise=new d.Promise,b?(this._isZooming=!0,this._maxZoomScale=a,this._zoomDuration=b,this._zoomIncrement=(a-this.z)/b):(this._isZooming=!1,this.z=a,this._zoomPromise.resolve(!0)),this._zoomPromise},a.prototype.getZoom=function(){return this.z},a.prototype.update=function(a,b){if(this._x+=this.dx*b/1e3,this._y+=this.dy*b/1e3,this.z+=this.dz*b/1e3,this.dx+=this.ax*b/1e3,this.dy+=this.ay*b/1e3,this.dz+=this.az*b/1e3,this.rotation+=this.rx*b/1e3,this._isZooming){var c=this.z+this._zoomIncrement*b;this.z=c,this._zoomIncrement>0?c>=this._maxZoomScale&&(this._isZooming=!1,this.z=this._maxZoomScale,this._zoomPromise.resolve(!0)):c<=this._maxZoomScale&&(this._isZooming=!1,this.z=this._maxZoomScale,this._zoomPromise.resolve(!0))}this._cameraMoving&&(this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?this._x=this._lerpStart.x-(this._easing(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this._x=this._easing(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?this._y=this._lerpStart.y-(this._easing(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this._y=this._easing(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._currentLerpTime+=b):(this._x=this._lerpEnd.x,this._y=this._lerpEnd.y,this._lerpPromise.resolve(this._lerpEnd),this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1)),this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=b,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1)},a.prototype.draw=function(a){var b=this.getFocus(),c=a.canvas.width,d=a.canvas.height,e=c/this.getZoom(),f=d/this.getZoom();a.scale(this.getZoom(),this.getZoom()),a.translate(-b.x+e/2+this._xShake,-b.y+f/2+this._yShake)},a.prototype.debugDraw=function(a){var b=this.getFocus();a.fillStyle="red",a.strokeStyle="white",a.lineWidth=3,a.beginPath(),a.arc(b.x,b.y,15,0,2*Math.PI),a.closePath(),a.stroke(),a.beginPath(),a.arc(b.x,b.y,5,0,2*Math.PI),a.closePath(),a.stroke()},a.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},a}();b.BaseCamera=g;var h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.getFocus=function(){return this._follow?new f.Vector(this._follow.pos.x+this._follow.getWidth()/2,a.prototype.getFocus.call(this).y):a.prototype.getFocus.call(this)},b}(g);b.SideCamera=h;var i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.getFocus=function(){return this._follow?new f.Vector(this._follow.pos.x+this._follow.getWidth()/2,this._follow.pos.y+this._follow.getHeight()/2):a.prototype.getFocus.call(this)},b}(g);b.LockedCamera=i}),c("DebugFlags",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Drawing/Color",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=null!=d?d:1}return a.fromRGB=function(b,c,d,e){return new a(b,c,d,e)},a.fromHex=function(b){var c=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=null;if(d=b.match(c)){var e=parseInt(d[1],16),f=parseInt(d[2],16),g=parseInt(d[3],16),h=1;return d[4]&&(h=parseInt(d[4],16)/255),new a(e,f,g,h)}throw new Error("Invalid hex string: "+b)},a.fromHSL=function(a,b,c,e){void 0===e&&(e=1);var f=new d(a,b,c,e);return f.toRGBA()},a.prototype.lighten=function(a){void 0===a&&(a=.1);var b=d.fromRGBA(this.r,this.g,this.b,this.a);return b.l+=b.l*a,b.toRGBA()},a.prototype.darken=function(a){void 0===a&&(a=.1);var b=d.fromRGBA(this.r,this.g,this.b,this.a);return b.l-=b.l*a,b.toRGBA()},a.prototype.saturate=function(a){void 0===a&&(a=.1);var b=d.fromRGBA(this.r,this.g,this.b,this.a);return b.s+=b.s*a,b.toRGBA()},a.prototype.desaturate=function(a){void 0===a&&(a=.1);var b=d.fromRGBA(this.r,this.g,this.b,this.a);return b.s-=b.s*a,b.toRGBA()},a.prototype.mulitiply=function(b){var c=b.r/255*this.r/255*255,d=b.g/255*this.g/255*255,e=b.b/255*this.b/255*255,f=b.a*this.a;return new a(c,d,e,f)},a.prototype.screen=function(a){var b=a.invert(),c=a.invert();return b.mulitiply(c).invert()},a.prototype.invert=function(){return new a(255-this.r,255-this.g,255-this.b,1-this.a)},a.prototype.average=function(b){var c=(b.r+this.r)/2,d=(b.g+this.g)/2,e=(b.b+this.b)/2,f=(b.a+this.a)/2;return new a(c,d,e,f)},a.prototype.toString=function(){var a=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+a+", "+String(this.a)+")":"rgb("+a+")"},a.prototype.fillStyle=function(){return this.toString()},a.prototype.clone=function(){return new a(this.r,this.g,this.b,this.a)},a}();c.Black=c.fromHex("#000000"),c.White=c.fromHex("#FFFFFF"),c.Gray=c.fromHex("#808080"),c.LightGray=c.fromHex("#D3D3D3"),c.DarkGray=c.fromHex("#A9A9A9"),c.Yellow=c.fromHex("#FFFF00"),c.Orange=c.fromHex("#FFA500"),c.Red=c.fromHex("#FF0000"),c.Vermillion=c.fromHex("#FF5B31"),c.Rose=c.fromHex("#FF007F"),c.Magenta=c.fromHex("#FF00FF"),c.Violet=c.fromHex("#7F00FF"),c.Blue=c.fromHex("#0000FF"),c.Azure=c.fromHex("#007FFF"),c.Cyan=c.fromHex("#00FFFF"),c.Viridian=c.fromHex("#59978F"),c.Green=c.fromHex("#00FF00"),c.Chartreuse=c.fromHex("#7FFF00"),c.Transparent=c.fromHex("#FFFFFF00"),b.Color=c;var d=function(){function a(a,b,c,d){this.h=a,this.s=b,this.l=c,this.a=d}return a.hue2rgb=function(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a},a.fromRGBA=function(b,c,d,e){b/=255,c/=255,d/=255;var f,g,h=Math.max(b,c,d),i=Math.min(b,c,d),j=(h+i)/2;if(h===i)f=g=0;else{var k=h-i;switch(g=j>.5?k/(2-h-i):k/(h+i),h){case b:f=(c-d)/k+(c<d?6:0);break;case c:f=(d-b)/k+2;break;case d:f=(b-c)/k+4}f/=6}return new a(f,g,j,e)},a.prototype.toRGBA=function(){var b,d,e;if(0===this.s)b=d=e=this.l;else{var f=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,g=2*this.l-f;b=a.hue2rgb(g,f,this.h+1/3),d=a.hue2rgb(g,f,this.h),e=a.hue2rgb(g,f,this.h-1/3)}return new c(255*b,255*d,255*e,this.a)},a}()}),c("Collision/CollisionContact",["require","exports","Collision/Side","Actor","Algebra","Physics","Events","Util/Util"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b,c,d,e){this.bodyA=a,this.bodyB=b,this.mtv=c,this.point=d,this.normal=e}return a.prototype.resolve=function(a){if(a===f.CollisionResolutionStrategy.RigidBody)this._resolveRigidBodyCollision();else{if(a!==f.CollisionResolutionStrategy.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision()}},a.prototype._applyBoxImpluse=function(a,b,e,f){if((a.collisionType===d.CollisionType.Active||a.collisionType===d.CollisionType.Elastic)&&b.collisionType!==d.CollisionType.Passive)if(a.collisionType===d.CollisionType.Active&&b.collisionType===d.CollisionType.Active&&(e=e.scale(.5)),a.pos.y+=e.y,a.pos.x+=e.x,a.collisionType===d.CollisionType.Elastic)f===c.Side.Left?a.vel.x=Math.abs(a.vel.x):f===c.Side.Right?a.vel.x=-Math.abs(a.vel.x):f===c.Side.Top?a.vel.y=Math.abs(a.vel.y):f===c.Side.Bottom&&(a.vel.y=-Math.abs(a.vel.y));else{if(0!==this.mtv.x){var g=0;a.vel.x<0&&b.vel.x<0?g=Math.min(a.vel.x,b.vel.x):a.vel.x>0&&b.vel.x>0?g=Math.max(a.vel.x,b.vel.x):b.collisionType===d.CollisionType.Fixed&&(g=a.pos.sub(b.pos).dot(a.vel)>0?a.vel.x:b.vel.x),a.vel.x=g}if(0!==this.mtv.y){var h=0;a.vel.y<0&&b.vel.y<0?h=Math.min(a.vel.y,b.vel.y):a.vel.y>0&&b.vel.y>0?h=Math.max(a.vel.y,b.vel.y):b.collisionType===d.CollisionType.Fixed&&(h=a.pos.sub(b.pos).dot(a.vel)>0?a.vel.y:b.vel.y),a.vel.y=h}}},a.prototype._resolveBoxCollision=function(){var a=this.bodyA.body.actor,b=this.bodyB.body.actor,c=h.getSideFromVector(this.mtv),d=this.mtv.negate();a.emit("collision",new g.CollisionEvent(a,b,c,d)),b.emit("collision",new g.CollisionEvent(b,a,h.getOppositeSide(c),d.negate())),this._applyBoxImpluse(a,b,d,c),this._applyBoxImpluse(b,a,d.negate(),h.getOppositeSide(c))},a.prototype._resolveRigidBodyCollision=function(){var a=this.bodyA.body,b=this.bodyB.body,c=this.mtv,i=this.normal;if(a.actor!==b.actor){var j=a.actor.collisionType===d.CollisionType.Fixed?0:1/a.mass,k=b.actor.collisionType===d.CollisionType.Fixed?0:1/b.mass,l=a.actor.collisionType===d.CollisionType.Fixed?0:1/a.moi,m=b.actor.collisionType===d.CollisionType.Fixed?0:1/b.moi,n=Math.min(a.restitution,b.restitution),o=Math.min(a.friction,b.friction);i=i.normalize();var p=i.normal().normalize(),q=this.point.sub(this.bodyA.getCenter()),r=this.point.sub(this.bodyB.getCenter()),s=b.vel.add(r.cross(-b.rx)).sub(a.vel.sub(q.cross(a.rx))),t=s.dot(i),u=s.dot(p),v=q.dot(p),w=q.dot(i),x=r.dot(p),y=r.dot(i);if(!(t>0)){var z=h.getSideFromVector(this.mtv);a.actor.emit("collision",new g.CollisionEvent(this.bodyA.body.actor,this.bodyB.body.actor,z,this.mtv)),b.actor.emit("collision",new g.CollisionEvent(this.bodyB.body.actor,this.bodyA.body.actor,h.getOppositeSide(z),this.mtv.negate()));var A=-((1+n)*t)/(j+k+l*v*v+m*x*x);if(a.actor.collisionType===d.CollisionType.Fixed?(b.vel=b.vel.add(i.scale(A*k)),f.Physics.allowRigidBodyRotation&&(b.rx-=A*m*-r.cross(i)),b.addMtv(c)):b.actor.collisionType===d.CollisionType.Fixed?(a.vel=a.vel.sub(i.scale(A*j)),f.Physics.allowRigidBodyRotation&&(a.rx+=A*l*-q.cross(i)),a.addMtv(c.negate())):(b.vel=b.vel.add(i.scale(A*k)),a.vel=a.vel.sub(i.scale(A*j)),f.Physics.allowRigidBodyRotation&&(b.rx-=A*m*-r.cross(i),a.rx+=A*l*-q.cross(i)),b.addMtv(c.scale(.5)),a.addMtv(c.scale(-.5))),o&&u){var B=s.sub(i.scale(s.dot(i))).normalize(),C=s.dot(B)/(j+k+w*w*l+y*y*m),D=new e.Vector(0,0);D=Math.abs(C)<=A*o?B.scale(C).negate():B.scale(-A*o),a.actor.collisionType===d.CollisionType.Fixed?(b.vel=b.vel.add(D.scale(k)),f.Physics.allowRigidBodyRotation&&(b.rx+=D.dot(B)*m*r.cross(B))):b.actor.collisionType===d.CollisionType.Fixed?(a.vel=a.vel.sub(D.scale(j)),f.Physics.allowRigidBodyRotation&&(a.rx-=D.dot(B)*l*q.cross(B))):(b.vel=b.vel.add(D.scale(k)),a.vel=a.vel.sub(D.scale(j)),f.Physics.allowRigidBodyRotation&&(b.rx+=D.dot(B)*m*r.cross(B),a.rx-=D.dot(B)*l*q.cross(B)))}}}},a}();b.CollisionContact=i}),c("Collision/ICollisionArea",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Collision/CircleArea",["require","exports","Collision/BoundingBox","Collision/PolygonArea","Collision/EdgeArea","Collision/CollisionJumpTable","Algebra","Physics","Drawing/Color"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j=function(){function a(a){this.pos=g.Vector.Zero.clone(),this.pos=a.pos||g.Vector.Zero.clone(),this.radius=a.radius||0,this.body=a.body||null}return a.prototype.getCenter=function(){return this.body?this.pos.add(this.body.pos):this.pos},a.prototype.contains=function(a){var b=this.body.pos.distance(a);return b<=this.radius},a.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);var c=this.getCenter(),d=a.dir,e=a.pos,f=Math.sqrt(Math.pow(d.dot(e.sub(c)),2)-Math.pow(e.sub(c).distance(),2)+Math.pow(this.radius,2));if(f<0)return null;var g=0;if(0===f)return g=-d.dot(e.sub(c)),g>0&&g<b?a.getPoint(g):null;var h=-d.dot(e.sub(c))+f,i=-d.dot(e.sub(c))-f,j=Math.min(h,i);return j<=b?a.getPoint(j):null},a.prototype.collide=function(b){if(b instanceof a)return f.CollisionJumpTable.CollideCircleCircle(this,b);if(b instanceof d.PolygonArea)return f.CollisionJumpTable.CollideCirclePolygon(this,b);if(b instanceof e.EdgeArea)return f.CollisionJumpTable.CollideCircleEdge(this,b);throw new Error("Circle could not collide with unknown ICollisionArea "+typeof b)},a.prototype.getFurthestPoint=function(a){return this.getCenter().add(a.normalize().scale(this.radius))},a.prototype.getBounds=function(){return new c.BoundingBox(this.pos.x+this.body.pos.x-this.radius,this.pos.y+this.body.pos.y-this.radius,this.pos.x+this.body.pos.x+this.radius,this.pos.y+this.body.pos.y+this.radius)},a.prototype.getAxes=function(){return null},a.prototype.getMomentOfInertia=function(){var a=this.body?this.body.mass:h.Physics.defaultMass;return a*this.radius*this.radius/2},a.prototype.testSeparatingAxisTheorem=function(a){var b=a.getAxes(),c=a.getCenter(),d=a.getFurthestPoint(this.pos.sub(c));b.push(this.pos.sub(d).normalize());for(var e=Number.MAX_VALUE,f=null,g=-1,h=0;h<b.length;h++){var i=a.project(b[h]),j=this.project(b[h]),k=i.getOverlap(j);if(k<=0)return null;k<e&&(e=k,f=b[h],g=h)}return g<0?null:f.normalize().scale(e)},a.prototype.recalc=function(){},a.prototype.project=function(a){var b=[],c=this.getCenter(),d=c.dot(a);return b.push(d),b.push(d+this.radius),b.push(d-this.radius),new g.Projection(Math.min.apply(Math,b),Math.max.apply(Math,b))},a.prototype.debugDraw=function(a,b){void 0===b&&(b=i.Color.Green.clone());var c=this.body?this.body.pos.add(this.pos):this.pos,d=this.body?this.body.rotation:0;a.beginPath(),a.strokeStyle=b.toString(),a.arc(c.x,c.y,this.radius,0,2*Math.PI),
a.closePath(),a.stroke(),a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(Math.cos(d)*this.radius+c.x,Math.sin(d)*this.radius+c.y),a.closePath(),a.stroke()},a}();b.CircleArea=j}),c("Collision/CollisionJumpTable",["require","exports","Collision/CollisionContact","Collision/PolygonArea"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CollisionJumpTable={CollideCircleCircle:function(a,b){var d=a.radius+b.radius,e=a.body.pos.add(a.pos),f=b.body.pos.add(b.pos);if(e.distance(f)>d)return null;var g=f.sub(e).normalize(),h=g.scale(d-f.distance(e)),i=a.getFurthestPoint(g);return new c.CollisionContact(a,b,h,i,g)},CollideCirclePolygon:function(a,b){var d=a.testSeparatingAxisTheorem(b);if(!d)return null;var e=d.dot(b.getCenter().sub(a.getCenter()));d=e<0?d.negate():d;var f=[],g=b.getFurthestPoint(d.negate()),h=a.getFurthestPoint(d);return a.contains(g)&&f.push(g),b.contains(h)&&f.push(h),0===f.length&&f.push(h),new c.CollisionContact(a,b,d,2===f.length?f[0].average(f[1]):f[0],d.normalize())},CollideCircleEdge:function(a,b){var d=a.getCenter(),e=b.end.sub(b.begin),f=e.dot(b.end.sub(d)),g=e.dot(d.sub(b.begin));if(g<=0){var h=b.begin.sub(d),i=h.dot(h);return i>a.radius*a.radius?null:new c.CollisionContact(a,b,h.normalize().scale(a.radius-Math.sqrt(i)),b.begin,h.normalize())}if(f<=0){var j=b.end.sub(d),k=j.dot(j);return k>a.radius*a.radius?null:new c.CollisionContact(a,b,j.normalize().scale(a.radius-Math.sqrt(k)),b.end,j.normalize())}var l=e.dot(e),m=b.begin.scale(f).add(b.end.scale(g)).scale(1/l),n=d.sub(m),o=n.dot(n);if(o>a.radius*a.radius)return null;var p=e.perpendicular();p.dot(d.sub(b.begin))<0&&(p.x=-p.x,p.y=-p.y),p=p.normalize();var q=p.scale(Math.abs(a.radius-Math.sqrt(o)));return new c.CollisionContact(a,b,q.negate(),m,p.negate())},CollideEdgeEdge:function(){return null},CollidePolygonEdge:function(a,b){var e=b.end.sub(b.begin),f=e.normal(),g=new d.PolygonArea({points:[b.begin,b.end,b.end.sub(f.scale(10)),b.begin.sub(f.scale(10))]}),h=a.testSeparatingAxisTheorem(g);return h?new c.CollisionContact(a,b,h,a.getFurthestPoint(f.negate()),f.negate()):null},CollidePolygonPolygon:function(a,b){var d=a.testSeparatingAxisTheorem(b);if(!d)return null;var e=d.dot(b.getCenter().sub(a.getCenter()));d=e<0?d.negate():d;var f=[],g=a.getFurthestPoint(d),h=b.getFurthestPoint(d.negate());b.contains(g)&&f.push(g),a.contains(h)&&f.push(h),0===f.length&&f.push(h);var i=2===f.length?f[0].add(f[1]).scale(.5):f[0];return new c.CollisionContact(a,b,d,i,d.normalize())}}}),c("Collision/PolygonArea",["require","exports","Drawing/Color","Physics","Collision/BoundingBox","Collision/EdgeArea","Collision/CollisionJumpTable","Collision/CircleArea","Algebra"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j=function(){function a(a){this._transformedPoints=[],this._axes=[],this._sides=[],this.pos=a.pos||i.Vector.Zero.clone();var b=!!a.clockwiseWinding;this.points=(b?a.points.reverse():a.points)||[],this.body=a.body||null,this._calculateTransformation()}return a.prototype.getCenter=function(){return this.body?this.body.pos.add(this.pos):this.pos},a.prototype._calculateTransformation=function(){var a=this.body?this.body.pos.add(this.pos):this.pos,b=this.body?this.body.rotation:0,c=this.points.length;this._transformedPoints.length=0;for(var d=0;d<c;d++)this._transformedPoints[d]=this.points[d].rotate(b).add(a)},a.prototype.getTransformedPoints=function(){return this._transformedPoints.length||this._calculateTransformation(),this._transformedPoints},a.prototype.getSides=function(){if(this._sides.length)return this._sides;for(var a=[],b=this.getTransformedPoints(),c=b.length,d=0;d<c;d++)a.push(new i.Line(b[d],b[(d-1+c)%c]));return this._sides=a,this._sides},a.prototype.recalc=function(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getAxes(),this.getSides()},a.prototype.contains=function(a){var b=new i.Ray(a,new i.Vector(1,0)),c=this.getSides().reduce(function(a,c){return b.intersect(c)>=0?a+1:a},0);return c%2!==0},a.prototype.collide=function(b){if(b instanceof h.CircleArea)return g.CollisionJumpTable.CollideCirclePolygon(b,this);if(b instanceof a)return g.CollisionJumpTable.CollidePolygonPolygon(this,b);if(b instanceof f.EdgeArea)return g.CollisionJumpTable.CollidePolygonEdge(this,b);throw new Error("Polygon could not collide with unknown ICollisionArea "+typeof b)},a.prototype.getFurthestPoint=function(a){for(var b=this.getTransformedPoints(),c=null,d=-Number.MAX_VALUE,e=0;e<b.length;e++){var f=a.dot(b[e]);f>d&&(d=f,c=b[e])}return c},a.prototype.getBounds=function(){var a=this.getTransformedPoints(),b=a.reduce(function(a,b){return Math.min(a,b.x)},999999999),c=a.reduce(function(a,b){return Math.max(a,b.x)},-99999999),d=a.reduce(function(a,b){return Math.min(a,b.y)},9999999999),f=a.reduce(function(a,b){return Math.max(a,b.y)},-9999999999);return new e.BoundingBox(b,d,c,f)},a.prototype.getMomentOfInertia=function(){for(var a=this.body?this.body.mass:d.Physics.defaultMass,b=0,c=0,e=0;e<this.points.length;e++){var f=(e+1)%this.points.length,g=this.points[f].cross(this.points[e]);b+=g*(this.points[e].dot(this.points[e])+this.points[e].dot(this.points[f])+this.points[f].dot(this.points[f])),c+=g}return a/6*(b/c)},a.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);for(var c=this.getSides(),d=c.length,e=Number.MAX_VALUE,f=-1,g=0;g<d;g++){var h=a.intersect(c[g]);h>=0&&h<e&&h<=b&&(e=h,f=g)}return f>=0?a.getPoint(e):null},a.prototype.getAxes=function(){if(this._axes.length)return this._axes;for(var a=[],b=this.getTransformedPoints(),c=b.length,d=0;d<c;d++)a.push(b[d].sub(b[(d+1)%c]).normal());return this._axes=a,this._axes},a.prototype.testSeparatingAxisTheorem=function(a){for(var b=this,c=a,d=b.getAxes().concat(c.getAxes()),e=Number.MAX_VALUE,f=null,g=-1,h=0;h<d.length;h++){var i=b.project(d[h]),j=c.project(d[h]),k=i.getOverlap(j);if(k<=0)return null;k<e&&(e=k,f=d[h],g=h)}return g===-1?null:f.normalize().scale(e)},a.prototype.project=function(a){for(var b=this.getTransformedPoints(),c=b.length,d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=0;f<c;f++){var g=b[f].dot(a);d=Math.min(d,g),e=Math.max(e,g)}return new i.Projection(d,e)},a.prototype.debugDraw=function(a,b){void 0===b&&(b=c.Color.Red.clone()),a.beginPath(),a.strokeStyle=b.toString();var d=this.getTransformedPoints()[0];a.moveTo(d.x,d.y),this.getTransformedPoints().forEach(function(b){a.lineTo(b.x,b.y)}),a.lineTo(d.x,d.y),a.closePath(),a.stroke()},a}();b.PolygonArea=j}),c("Collision/BoundingBox",["require","exports","Collision/PolygonArea","Algebra","Drawing/Color"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.left=a,this.top=b,this.right=c,this.bottom=d}return a.fromPoints=function(b){for(var c=1/0,d=1/0,e=-(1/0),f=-(1/0),g=0;g<b.length;g++)b[g].x<c&&(c=b[g].x),b[g].x>e&&(e=b[g].x),b[g].y<d&&(d=b[g].y),b[g].y>f&&(f=b[g].y);return new a(c,d,e,f)},a.prototype.getWidth=function(){return this.right-this.left},a.prototype.getHeight=function(){return this.bottom-this.top},a.prototype.rotate=function(b,c){void 0===c&&(c=d.Vector.Zero.clone());var e=this.getPoints().map(function(a){return a.rotate(b,c)});return a.fromPoints(e)},a.prototype.getPerimeter=function(){var a=this.getWidth(),b=this.getHeight();return 2*(a+b)},a.prototype.getPoints=function(){var a=[];return a.push(new d.Vector(this.left,this.top)),a.push(new d.Vector(this.right,this.top)),a.push(new d.Vector(this.right,this.bottom)),a.push(new d.Vector(this.left,this.bottom)),a},a.prototype.toPolygon=function(a){return new c.PolygonArea({body:a?a.body:null,points:this.getPoints(),pos:d.Vector.Zero.clone()})},a.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);var c=-(1/0),d=+(1/0),e=0===a.dir.x?Number.MAX_VALUE:1/a.dir.x,f=0===a.dir.y?Number.MAX_VALUE:1/a.dir.y,g=(this.left-a.pos.x)*e,h=(this.right-a.pos.x)*e;c=Math.min(g,h),d=Math.max(g,h);var i=(this.top-a.pos.y)*f,j=(this.bottom-a.pos.y)*f;return c=Math.max(c,Math.min(i,j)),d=Math.min(d,Math.max(i,j)),d>=Math.max(0,c)&&c<b},a.prototype.rayCastTime=function(a,b){void 0===b&&(b=1/0);var c=-(1/0),d=+(1/0),e=0===a.dir.x?Number.MAX_VALUE:1/a.dir.x,f=0===a.dir.y?Number.MAX_VALUE:1/a.dir.y,g=(this.left-a.pos.x)*e,h=(this.right-a.pos.x)*e;c=Math.min(g,h),d=Math.max(g,h);var i=(this.top-a.pos.y)*f,j=(this.bottom-a.pos.y)*f;return c=Math.max(c,Math.min(i,j)),d=Math.min(d,Math.max(i,j)),d>=Math.max(0,c)&&c<b?c:-1},a.prototype.contains=function(b){return b instanceof d.Vector?this.left<=b.x&&this.top<=b.y&&this.bottom>=b.y&&this.right>=b.x:b instanceof a&&(this.left<b.left&&this.top<b.top&&b.bottom<this.bottom&&b.right<this.right)},a.prototype.combine=function(b){var c=new a(Math.min(this.left,b.left),Math.min(this.top,b.top),Math.max(this.right,b.right),Math.max(this.bottom,b.bottom));return c},a.prototype.collides=function(b){if(b instanceof a){var c=b,e=this.combine(c);if(e.getWidth()<c.getWidth()+this.getWidth()&&e.getHeight()<c.getHeight()+this.getHeight()){var f=0;f=this.right>=c.left&&this.right<=c.right?c.left-this.right:c.right-this.left;var g=0;return g=this.top<=c.bottom&&this.top>=c.top?c.bottom-this.top:c.top-this.bottom,Math.abs(f)<Math.abs(g)?new d.Vector(f,0):new d.Vector(0,g)}return null}return null},a.prototype.debugDraw=function(a,b){void 0===b&&(b=e.Color.Yellow),a.strokeStyle=b.toString(),a.strokeRect(this.left,this.top,this.getWidth(),this.getHeight())},a}();b.BoundingBox=f}),c("Collision/EdgeArea",["require","exports","Collision/BoundingBox","Collision/CollisionJumpTable","Collision/CircleArea","Collision/PolygonArea","Algebra","Physics","Drawing/Color"],function(a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j=function(){function a(a){this.begin=a.begin||g.Vector.Zero.clone(),this.end=a.end||g.Vector.Zero.clone(),this.body=a.body||null,this.pos=this.getCenter()}return a.prototype.getCenter=function(){var a=this.begin.average(this.end).add(this._getBodyPos());return a},a.prototype._getBodyPos=function(){var a=g.Vector.Zero.clone();return this.body.pos&&(a=this.body.pos),a},a.prototype._getTransformedBegin=function(){var a=this.body?this.body.rotation:0;return this.begin.rotate(a).add(this._getBodyPos())},a.prototype._getTransformedEnd=function(){var a=this.body?this.body.rotation:0;return this.end.rotate(a).add(this._getBodyPos())},a.prototype.getSlope=function(){var a=this._getTransformedBegin(),b=this._getTransformedEnd(),c=a.distance(b);return b.sub(a).scale(1/c)},a.prototype.getLength=function(){var a=this._getTransformedBegin(),b=this._getTransformedEnd(),c=a.distance(b);return c},a.prototype.contains=function(){return!1},a.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);var c=this._getTransformedBegin().sub(a.pos);if(0===a.dir.cross(this.getSlope())&&0!==c.cross(a.dir))return null;var d=a.dir.cross(this.getSlope());if(0===d)return null;var e=c.cross(this.getSlope())/d;if(e>=0&&e<=b){var f=c.cross(a.dir)/d/this.getLength();if(f>=0&&f<=1)return a.getPoint(e)}return null},a.prototype.collide=function(b){if(b instanceof e.CircleArea)return d.CollisionJumpTable.CollideCircleEdge(b,this);if(b instanceof f.PolygonArea)return d.CollisionJumpTable.CollidePolygonEdge(b,this);if(b instanceof a)return d.CollisionJumpTable.CollideEdgeEdge();throw new Error("Edge could not collide with unknown ICollisionArea "+typeof b)},a.prototype.getFurthestPoint=function(a){var b=this._getTransformedBegin(),c=this._getTransformedEnd();return a.dot(b)>0?b:c},a.prototype.getBounds=function(){var a=this._getTransformedBegin(),b=this._getTransformedEnd();return new c.BoundingBox(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.max(a.x,b.x),Math.max(a.y,b.y))},a.prototype.getAxes=function(){var a=this._getTransformedEnd().sub(this._getTransformedBegin()),b=a.normal(),c=[];return c.push(b),c.push(b.negate()),c.push(b.normal()),c.push(b.normal().negate()),c},a.prototype.getMomentOfInertia=function(){var a=this.body?this.body.mass:h.Physics.defaultMass,b=this.end.sub(this.begin).distance()/2;return a*b*b},a.prototype.recalc=function(){},a.prototype.project=function(a){for(var b=[],c=[this._getTransformedBegin(),this._getTransformedEnd()],d=c.length,e=0;e<d;e++)b.push(c[e].dot(a));return new g.Projection(Math.min.apply(Math,b),Math.max.apply(Math,b))},a.prototype.debugDraw=function(a,b){void 0===b&&(b=i.Color.Red.clone()),a.strokeStyle=b.toString(),a.beginPath(),a.moveTo(this.begin.x,this.begin.y),a.lineTo(this.end.x,this.end.y),a.closePath(),a.stroke()},a}();b.EdgeArea=j}),c("Util/DrawUtil",["require","exports","Drawing/Color"],function(a,b,c){"use strict";function d(a,b,d,e,f,g,h,i){void 0===b&&(b=c.Color.Red.clone()),void 0===h&&(h=1),void 0===i&&(i="butt"),a.beginPath(),a.lineWidth=h,a.lineCap=i,a.strokeStyle=b.toString(),a.moveTo(d,e),a.lineTo(f,g),a.closePath(),a.stroke()}function e(a,b,d){void 0===b&&(b=c.Color.Red.clone()),a.beginPath(),a.strokeStyle=b.toString(),a.arc(d.x,d.y,5,0,2*Math.PI),a.closePath(),a.stroke()}function f(a,b,c,d,e){void 0===e&&(e=1);var f=b?b.toString():"blue",g=d.scale(e);a.beginPath(),a.strokeStyle=f,a.moveTo(c.x,c.y),a.lineTo(c.x+g.x,c.y+g.y),a.closePath(),a.stroke()}function g(a,b,d,e,f,g,h,i){void 0===g&&(g=5),void 0===h&&(h=c.Color.White),void 0===i&&(i=null);var j;if("number"==typeof g)j={tl:g,tr:g,br:g,bl:g};else{var k={tl:0,tr:0,br:0,bl:0};for(var l in k)if(k.hasOwnProperty(l)){var m=l;j[m]=g[m]||k[m]}}a.beginPath(),a.moveTo(b+j.tl,d),a.lineTo(b+e-j.tr,d),a.quadraticCurveTo(b+e,d,b+e,d+j.tr),a.lineTo(b+e,d+f-j.br),a.quadraticCurveTo(b+e,d+f,b+e-j.br,d+f),a.lineTo(b+j.bl,d+f),a.quadraticCurveTo(b,d+f,b,d+f-j.bl),a.lineTo(b,d+j.tl),a.quadraticCurveTo(b,d,b+j.tl,d),a.closePath(),i&&(a.fillStyle=i.toString(),a.fill()),h&&(a.strokeStyle=h.toString(),a.stroke())}function h(a,b,d,e,f,g){void 0===f&&(f=c.Color.White),void 0===g&&(g=null),a.beginPath(),a.arc(b,d,e,0,2*Math.PI),a.closePath(),g&&(a.fillStyle=g.toString(),a.fill()),f&&(a.strokeStyle=f.toString(),a.stroke())}Object.defineProperty(b,"__esModule",{value:!0}),b.line=d,b.point=e,b.vector=f,b.roundRect=g,b.circle=h}),c("Collision/Body",["require","exports","Physics","Collision/EdgeArea","Collision/CircleArea","Collision/PolygonArea","Collision/Pair","Algebra","Drawing/Color","Util/DrawUtil"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var k=function(){function a(a){this.actor=a,this.collisionArea=null,this.pos=new h.Vector(0,0),this.oldPos=new h.Vector(0,0),this.vel=new h.Vector(0,0),this.oldVel=new h.Vector(0,0),this.acc=new h.Vector(0,0),this.torque=0,this.mass=1,this.moi=1e3,this.motion=10,this.friction=.99,this.restitution=.2,this.rotation=0,this.rx=0,this._totalMtv=h.Vector.Zero.clone()}return a.prototype.addMtv=function(a){this._totalMtv.addEqual(a)},a.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},a.prototype.getBounds=function(){return c.Physics.collisionResolutionStrategy===c.CollisionResolutionStrategy.Box?this.actor.getBounds():this.collisionArea.getBounds()},a.prototype.getRelativeBounds=function(){return c.Physics.collisionResolutionStrategy===c.CollisionResolutionStrategy.Box?this.actor.getRelativeBounds():this.actor.getRelativeBounds()},a.prototype.update=function(){this.collisionArea&&this.collisionArea.recalc()},a.prototype.useBoxCollision=function(a){void 0===a&&(a=h.Vector.Zero.clone()),this.collisionArea=new f.PolygonArea({body:this,points:this.actor.getRelativeBounds().getPoints(),pos:a}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},a.prototype.usePolygonCollision=function(a,b){void 0===b&&(b=h.Vector.Zero.clone()),this.collisionArea=new f.PolygonArea({body:this,points:a,pos:b}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},a.prototype.useCircleCollision=function(a,b){void 0===b&&(b=h.Vector.Zero.clone()),a||(a=this.actor.getWidth()/2),this.collisionArea=new e.CircleArea({body:this,radius:a,pos:b}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},a.prototype.useEdgeCollision=function(a,b){this.collisionArea=new d.EdgeArea({begin:a,end:b,body:this}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},a.prototype.debugDraw=function(a){c.Physics.showMotionVectors&&(j.vector(a,i.Color.Yellow,this.pos,this.acc.add(c.Physics.acc)),j.vector(a,i.Color.Red,this.pos,this.vel),j.point(a,i.Color.Red,this.pos)),c.Physics.showBounds&&this.getBounds().debugDraw(a,i.Color.Yellow),c.Physics.showArea&&this.collisionArea.debugDraw(a,i.Color.Green)},a.prototype.touching=function(a){var b=new g.Pair(this,a.body);return b.collide(),!!b.collision},a.prototype.wasTouching=function(a,b){var c=new g.Pair(this,a.body),d=!1;b.stats.prevFrame.physics.collidersHash[c.id]&&(d=!0);var e=this.touching(a);return d&&!e},a}();b.Body=k}),c("Collision/Pair",["require","exports","Physics","Drawing/Color","Util/DrawUtil"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(b,c){this.bodyA=b,this.bodyB=c,this.id=null,this.collision=null,this.id=a.calculatePairHash(b,c)}return a.prototype.collide=function(){this.collision=this.bodyA.collisionArea.collide(this.bodyB.collisionArea)},a.prototype.resolve=function(a){this.collision&&this.collision.resolve(a)},a.calculatePairHash=function(a,b){return a.actor.id<b.actor.id?"#"+a.actor.id+"+"+b.actor.id:"#"+b.actor.id+"+"+a.actor.id},a.prototype.debugDraw=function(a){this.collision&&(c.Physics.showContacts&&e.point(a,d.Color.Red,this.collision.point),c.Physics.showCollisionNormals&&e.vector(a,d.Color.Cyan,this.collision.point,this.collision.normal,30))},a}();b.Pair=f}),c("Debug",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.stats={currFrame:new d,prevFrame:new d}}return a}();b.Debug=c;var d=function(){function a(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new e}return a.prototype.reset=function(a){a?(this.id=a.id,this.delta=a.delta,this.fps=a.fps,this.actors.alive=a.actors.alive,this.actors.killed=a.actors.killed,this.actors.ui=a.actors.ui,this.duration.update=a.duration.update,this.duration.draw=a.duration.draw,this._physicsStats.reset(a.physics)):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset())},a.prototype.clone=function(){var b=new a;return b.reset(this),b},Object.defineProperty(a.prototype,"id",{get:function(){return this._id},set:function(a){this._id=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"delta",{get:function(){return this._delta},set:function(a){this._delta=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fps",{get:function(){return this._fps},set:function(a){this._fps=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"actors",{get:function(){return this._actorStats},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this._durationStats},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"physics",{get:function(){return this._physicsStats},enumerable:!0,configurable:!0}),a}();b.FrameStats=d;var e=function(){function a(){this._pairs=0,this._collisions=0,this._collidersHash={},this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}return a.prototype.reset=function(a){a?(this.pairs=a.pairs,this.collisions=a.collisions,this.collidersHash=a.collidersHash,this.fastBodies=a.fastBodies,this.fastBodyCollisions=a.fastBodyCollisions,this.broadphase=a.broadphase,this.narrowphase=a.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.collidersHash={})},a.prototype.clone=function(){var b=new a;return b.reset(this),b},Object.defineProperty(a.prototype,"pairs",{get:function(){return this._pairs},set:function(a){this._pairs=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"collisions",{get:function(){return this._collisions},set:function(a){this._collisions=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"collidersHash",{get:function(){return this._collidersHash},set:function(a){this._collidersHash=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fastBodies",{get:function(){return this._fastBodies},set:function(a){this._fastBodies=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fastBodyCollisions",{get:function(){return this._fastBodyCollisions},set:function(a){this._fastBodyCollisions=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"broadphase",{get:function(){return this._broadphase},set:function(a){this._broadphase=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"narrowphase",{get:function(){return this._narrowphase},set:function(a){this._narrowphase=a},enumerable:!0,configurable:!0}),a}();b.PhysicsStats=e}),c("Interfaces/IEvented",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("EventDispatcher",["require","exports","Events"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a){this._handlers={},this._wiredEventDispatchers=[],this._target=a}return a.prototype.emit=function(a,b){if(a){a=a.toLowerCase();var d=this._target;b||(b=new c.GameEvent),b.target=d;var e,f;if(this._handlers[a])for(e=0,f=this._handlers[a].length,e;e<f;e++)this._handlers[a][e].call(d,b);for(e=0,f=this._wiredEventDispatchers.length,e;e<f;e++)this._wiredEventDispatchers[e].emit(a,b)}},a.prototype.on=function(a,b){a=a.toLowerCase(),this._handlers[a]||(this._handlers[a]=[]),this._handlers[a].push(b),"unsubscribe"!==a&&"subscribe"!==a&&this.emit("subscribe",new c.SubscribeEvent(a,b))},a.prototype.off=function(a,b){a=a.toLowerCase();var d=this._handlers[a];if(d)if(b){var e=d.indexOf(b);this._handlers[a].splice(e,1)}else this._handlers[a].length=0;"unsubscribe"!==a&&"subscribe"!==a&&this.emit("unsubscribe",new c.UnsubscribeEvent(a,b))},a.prototype.wire=function(a){a._wiredEventDispatchers.push(this)},a.prototype.unwire=function(a){var b=a._wiredEventDispatchers.indexOf(this);b>-1&&a._wiredEventDispatchers.splice(b,1)},a}();b.EventDispatcher=d}),c("Actions/ActionContext",["require","exports","Actions/Action","Promises","Util/EasingFunctions"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(function(a){return a.actionQueue}))}return a.prototype.clearActions=function(){var a=0,b=this._queues.length;for(a;a<b;a++)this._queues[a].clearActions()},a.prototype.addActorToContext=function(a){this._actors.push(a),this._queues.push(a.actionQueue)},a.prototype.removeActorFromContext=function(a){var b=this._actors.indexOf(a);b>-1&&(this._actors.splice(b,1),this._queues.splice(b,1))},a.prototype.easeTo=function(a,b,d,f){void 0===f&&(f=e.EasingFunctions.Linear);var g=0,h=this._queues.length;for(g;g<h;g++)this._queues[g].add(new c.EaseTo(this._actors[g],a,b,d,f));return this},a.prototype.moveTo=function(a,b,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new c.MoveTo(this._actors[e],a,b,d));return this},a.prototype.moveBy=function(a,b,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new c.MoveBy(this._actors[e],a,b,d));return this},a.prototype.rotateTo=function(a,b,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new c.RotateTo(this._actors[e],a,b,d));return this},a.prototype.rotateBy=function(a,b,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new c.RotateBy(this._actors[e],a,b,d));return this},a.prototype.scaleTo=function(a,b,d,e){var f=0,g=this._queues.length;for(f;f<g;f++)this._queues[f].add(new c.ScaleTo(this._actors[f],a,b,d,e));return this},a.prototype.scaleBy=function(a,b,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new c.ScaleBy(this._actors[e],a,b,d));return this},a.prototype.blink=function(a,b,d){void 0===d&&(d=1);var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new c.Blink(this._actors[e],a,b,d));return this},a.prototype.fade=function(a,b){var d=0,e=this._queues.length;for(d;d<e;d++)this._queues[d].add(new c.Fade(this._actors[d],a,b));return this},a.prototype.delay=function(a){var b=0,d=this._queues.length;for(b;b<d;b++)this._queues[b].add(new c.Delay(this._actors[b],a));return this},a.prototype.die=function(){var a=0,b=this._queues.length;for(a;a<b;a++)this._queues[a].add(new c.Die(this._actors[a]));return this},a.prototype.callMethod=function(a){var b=0,d=this._queues.length;for(b;b<d;b++)this._queues[b].add(new c.CallMethod(this._actors[b],a));return this},a.prototype.repeat=function(a){if(!a)return this.repeatForever(),this;var b=0,d=this._queues.length;for(b;b<d;b++)this._queues[b].add(new c.Repeat(this._actors[b],a,this._actors[b].actionQueue.getActions()));return this},a.prototype.repeatForever=function(){var a=0,b=this._queues.length;for(a;a<b;a++)this._queues[a].add(new c.RepeatForever(this._actors[a],this._actors[a].actionQueue.getActions()));return this},a.prototype.follow=function(a,b){var d=0,e=this._queues.length;for(d;d<e;d++)void 0===b?this._queues[d].add(new c.Follow(this._actors[d],a)):this._queues[d].add(new c.Follow(this._actors[d],a,b));return this},a.prototype.meet=function(a,b){var d=0,e=this._queues.length;for(d;d<e;d++)void 0===b?this._queues[d].add(new c.Meet(this._actors[d],a)):this._queues[d].add(new c.Meet(this._actors[d],a,b));return this},a.prototype.asPromise=function(){var a=this,b=this._queues.map(function(b,e){var f=new d.Promise;return b.add(new c.CallMethod(a._actors[e],function(){f.resolve()})),f});return d.Promise.join.apply(this,b)},a}();b.ActionContext=f}),c("Actions/IActionable",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Group",["require","exports","Algebra","Actions/ActionContext","Actor","Util/Log","Class"],function(a,b,c,d,f,g,h){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var i=function(a){function b(b,c){var e=a.call(this)||this;if(e.name=b,e.scene=c,e._logger=g.Logger.getInstance(),e._members=[],e.actions=new d.ActionContext,null==c)e._logger.error("Invalid constructor arguments passed to Group: ",b,", scene must not be null!");else{var f=c.groups[b];f&&e._logger.warn("Group with name",b,"already exists. This new group will replace it."),c.groups[b]=e}return e}return e(b,a),b.prototype.add=function(a){a instanceof f.Actor&&(a=[].concat(a));var b,c=0,d=a.length;for(c;c<d;c++)b=this.getMembers().indexOf(a[c]),b===-1&&(this._members.push(a[c]),this.scene.add(a[c]),this.actions.addActorToContext(a[c]),this.eventDispatcher.wire(a[c].eventDispatcher))},b.prototype.remove=function(a){var b=this._members.indexOf(a);b>-1&&(this._members.splice(b,1),this.actions.removeActorFromContext(a),this.eventDispatcher.unwire(a.eventDispatcher))},b.prototype.move=function(a){var b=0,d=this.getMembers(),e=d.length;if(1===arguments.length&&a instanceof c.Vector)for(b;b<e;b++)d[b].pos.x+=a.x,d[b].pos.y+=a.y;else if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var f=arguments[0],g=arguments[1];for(b;b<e;b++)d[b].pos.x+=f,d[b].pos.y+=g}else this._logger.error("Invalid arguments passed to group move",this.name,"args:",arguments)},b.prototype.rotate=function(a){if("number"!=typeof a)return void this._logger.error("Invalid arguments passed to group rotate",this.name,"args:",arguments);for(var b=0,c=this.getMembers();b<c.length;b++){var d=c[b];d.rotation+=a}},b.prototype.on=function(a,b){this.eventDispatcher.on(a,b)},b.prototype.off=function(a,b){this.eventDispatcher.off(a,b)},b.prototype.emit=function(a,b){this.eventDispatcher.emit(a,b)},b.prototype.contains=function(a){return this.getMembers().indexOf(a)>-1},b.prototype.getMembers=function(){return this._members},b.prototype.getRandomMember=function(){return this._members[Math.floor(Math.random()*this._members.length)]},b.prototype.getBounds=function(){return this.getMembers().map(function(a){return a.getBounds()}).reduce(function(a,b){return a.combine(b)})},b}(h.Class);b.Group=i}),c("Drawing/SpriteEffects",["require","exports","Drawing/Color"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data,f=(e[d+0]+e[d+1]+e[d+2])/3;e[d+0]=f,e[d+1]=f,e[d+2]=f},a}();b.Grayscale=d;var e=function(){function a(){}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;e[d+0]=255-e[d+0],e[d+1]=255-e[d+1],e[d+2]=255-e[d+2]},a}();b.Invert=e;var f=function(){function a(a){this.opacity=a}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;0!==e[d+3]&&(e[d+3]=Math.round(this.opacity*e[d+3]))},a}();b.Opacity=f;var g=function(){function a(a){this.color=a}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;0!==e[d+3]&&(e[d+0]=(e[d+0]+this.color.r)/2,e[d+1]=(e[d+1]+this.color.g)/2,e[d+2]=(e[d+2]+this.color.b)/2)},a}();b.Colorize=g;var h=function(){function a(a){void 0===a&&(a=.1),this.factor=a}return a.prototype.updatePixel=function(a,b,d){var e=4*(a+b*d.width),f=d.data,g=c.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).lighten(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},a}();b.Lighten=h;var i=function(){function a(a){void 0===a&&(a=.1),this.factor=a}return a.prototype.updatePixel=function(a,b,d){var e=4*(a+b*d.width),f=d.data,g=c.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).darken(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},a}();b.Darken=i;var j=function(){function a(a){void 0===a&&(a=.1),this.factor=a}return a.prototype.updatePixel=function(a,b,d){var e=4*(a+b*d.width),f=d.data,g=c.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).saturate(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},a}();b.Saturate=j;var k=function(){function a(a){void 0===a&&(a=.1),this.factor=a}return a.prototype.updatePixel=function(a,b,d){var e=4*(a+b*d.width),f=d.data,g=c.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).desaturate(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},a}();b.Desaturate=k;var l=function(){function a(a){this.color=a}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;0!==e[d+3]&&(e[d+0]=this.color.r,e[d+1]=this.color.g,e[d+2]=this.color.b)},a}();b.Fill=l}),c("Interfaces/IDrawable",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Interfaces/ILoadable",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Resources/Resource",["require","exports","Class","Promises","Util/Log"],function(a,b,c,d,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var g=function(a){function b(b,c,d){void 0===d&&(d=!0);var e=a.call(this)||this;return e.path=b,e.responseType=c,e.bustCache=d,e.data=null,e.logger=f.Logger.getInstance(),e.onprogress=function(){},e.oncomplete=function(){},e.onerror=function(){},e}return e(b,a),b.prototype.isLoaded=function(){return null!==this.data},b.prototype.wireEngine=function(a){this._engine=a},b.prototype._cacheBust=function(a){var b=/\?\w*=\w*/;return a+=b.test(a)?"&__="+Date.now():"?__="+Date.now()},b.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},b.prototype.load=function(){var a=this,b=new d.Promise;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),
b.resolve(this.data),this.oncomplete(),b;var c=new XMLHttpRequest;return c.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),c.responseType=this.responseType,c.onloadstart=function(){a._start()},c.onprogress=this.onprogress,c.onerror=this.onerror,c.onload=function(){return 0!==c.status&&200!==c.status?(a.logger.error("Failed to load resource ",a.path," server responded with error code",c.status),a.onerror(c.response),void b.resolve(c.response)):(a.data=a.processData(c.response),a.oncomplete(),a.logger.debug("Completed loading resource",a.path),void b.resolve(a.data))},c.send(),b},b.prototype.getData=function(){return this.data},b.prototype.setData=function(a){this.data=this.processData(a)},b.prototype.processData=function(a){return URL.createObjectURL(a)},b}(c.Class);b.Resource=g}),c("Resources/Texture",["require","exports","Resources/Resource","Promises","Drawing/Sprite"],function(a,b,c,d,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var g=function(a){function b(b,c){void 0===c&&(c=!0);var e=a.call(this,b,"blob",c)||this;return e.path=b,e.bustCache=c,e.loaded=new d.Promise,e._isLoaded=!1,e._sprite=null,e._sprite=new f.Sprite(e,0,0,0,0),e}return e(b,a),b.prototype.isLoaded=function(){return this._isLoaded},b.prototype.load=function(){var b=this,c=new d.Promise,e=a.prototype.load.call(this);return e.then(function(){b.image=new Image,b.image.addEventListener("load",function(){b._isLoaded=!0,b.width=b._sprite.swidth=b._sprite.naturalWidth=b._sprite.width=b.image.naturalWidth,b.height=b._sprite.sheight=b._sprite.naturalHeight=b._sprite.height=b.image.naturalHeight,b.loaded.resolve(b.image),c.resolve(b.image)}),b.image.src=a.prototype.getData.call(b)},function(){c.reject("Error loading texture.")}),c},b.prototype.asSprite=function(){return this._sprite},b}(c.Resource);b.Texture=g}),c("Drawing/Sprite",["require","exports","Drawing/SpriteEffects","Drawing/Color","Algebra","Util/Log","Util/Util"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b,c,d,g){var h=this;this.sx=b,this.sy=c,this.swidth=d,this.sheight=g,this.rotation=0,this.anchor=new e.Vector(0,0),this.scale=new e.Vector(1,1),this.logger=f.Logger.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.effects=[],this.naturalWidth=0,this.naturalHeight=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1,(b<0||c<0||d<0||g<0)&&this.logger.error("Sprite cannot have any negative dimensions x:",b,"y:",c,"width:",d,"height:",g),this._texture=a,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=d,this._spriteCanvas.height=g,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then(function(){h._spriteCanvas.width=h._spriteCanvas.width||h._texture.image.naturalWidth,h._spriteCanvas.height=h._spriteCanvas.height||h._texture.image.naturalHeight,h._loadPixels(),h._dirtyEffect=!0}).error(function(a){h.logger.error("Error loading texture ",h._texture.path,a)}),this.width=d,this.height=g,this.naturalWidth=d,this.naturalHeight=g}return a.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var a=this._texture.image.naturalWidth||0,b=this._texture.image.naturalHeight||0;this.swidth>a&&this.logger.warn("The sprite width",this.swidth,"exceeds the width",a,"of the backing texture",this._texture.path),this.sheight>b&&this.logger.warn("The sprite height",this.sheight,"exceeds the height",b,"of the backing texture",this._texture.path),this._spriteCtx.drawImage(this._texture.image,g.clamp(this.sx,0,a),g.clamp(this.sy,0,b),g.clamp(this.swidth,0,a),g.clamp(this.sheight,0,b),0,0,this.swidth,this.sheight),this._pixelsLoaded=!0}},a.prototype.opacity=function(a){this.addEffect(new c.Opacity(a))},a.prototype.grayscale=function(){this.addEffect(new c.Grayscale)},a.prototype.invert=function(){this.addEffect(new c.Invert)},a.prototype.fill=function(a){this.addEffect(new c.Fill(a))},a.prototype.colorize=function(a){this.addEffect(new c.Colorize(a))},a.prototype.lighten=function(a){void 0===a&&(a=.1),this.addEffect(new c.Lighten(a))},a.prototype.darken=function(a){void 0===a&&(a=.1),this.addEffect(new c.Darken(a))},a.prototype.saturate=function(a){void 0===a&&(a=.1),this.addEffect(new c.Saturate(a))},a.prototype.desaturate=function(a){void 0===a&&(a=.1),this.addEffect(new c.Desaturate(a))},a.prototype.addEffect=function(a){this.effects.push(a),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},a.prototype.removeEffect=function(a){var b=-1;b="number"==typeof a?a:this.effects.indexOf(a),b<0||b>=this.effects.length||(this.effects.splice(b,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)},a.prototype._applyEffects=function(){var a=this._texture.image.naturalWidth||0,b=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.drawImage(this._texture.image,g.clamp(this.sx,0,a),g.clamp(this.sy,0,b),g.clamp(this.swidth,0,a),g.clamp(this.sheight,0,b),0,0,this.swidth,this.sheight),this._pixelData=this._spriteCtx.getImageData(0,0,this.swidth,this.sheight);var c=0,d=0,e=0,f=this.effects.length;for(c;c<f;c++)for(e=0;e<this.sheight;e++)for(d=0;d<this.swidth;d++)this.effects[c].updatePixel(d,e,this._pixelData);this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.putImageData(this._pixelData,0,0),this._dirtyEffect=!1},a.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},a.prototype.reset=function(){},a.prototype.debugDraw=function(a,b,c){a.save(),a.translate(b,c),a.rotate(this.rotation);var e=this.width*this.scale.x,f=this.height*this.scale.y,g=e*this.anchor.x,h=f*this.anchor.y;a.strokeStyle=d.Color.Black.toString(),a.strokeRect(-g,-h,e,f),a.restore()},a.prototype.draw=function(a,b,c){this._dirtyEffect&&this._applyEffects(),this.width=this.naturalWidth*this.scale.x,this.height=this.naturalHeight*this.scale.y,a.save();var d=this.width*this.anchor.x,e=this.height*this.anchor.y;a.translate(b,c),a.rotate(this.rotation);var f=this.swidth*this.scale.x,g=this.sheight*this.scale.y;this.flipHorizontal&&(a.translate(f,0),a.scale(-1,1)),this.flipVertical&&(a.translate(0,g),a.scale(1,-1)),a.drawImage(this._spriteCanvas,0,0,this.swidth,this.sheight,-d,-e,f,g),a.restore()},a.prototype.clone=function(){var b=new a(this._texture,this.sx,this.sy,this.swidth,this.sheight);b.scale=this.scale.clone(),b.rotation=this.rotation,b.flipHorizontal=this.flipHorizontal,b.flipVertical=this.flipVertical;var c=0,d=this.effects.length;for(c;c<d;c++)b.addEffect(this.effects[c]);return b},a}();b.Sprite=h}),c("Drawing/Animation",["require","exports","Drawing/SpriteEffects","Algebra","Util/Util"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b,c,e){this.currentFrame=0,this._oldTime=Date.now(),this.anchor=new d.Vector(0,0),this.rotation=0,this.scale=new d.Vector(1,1),this.loop=!1,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.naturalWidth=0,this.naturalHeight=0,this.sprites=b,this.speed=c,this._engine=a,null!=e&&(this.loop=e),b&&b[0]&&(this.height=b[0]?b[0].height:0,this.width=b[0]?b[0].width:0,this.naturalWidth=b[0]?b[0].naturalWidth:0,this.naturalHeight=b[0]?b[0].naturalHeight:0,this.freezeFrame=b.length-1)}return a.prototype.opacity=function(a){this.addEffect(new c.Opacity(a))},a.prototype.grayscale=function(){this.addEffect(new c.Grayscale)},a.prototype.invert=function(){this.addEffect(new c.Invert)},a.prototype.fill=function(a){this.addEffect(new c.Fill(a))},a.prototype.colorize=function(a){this.addEffect(new c.Colorize(a))},a.prototype.lighten=function(a){void 0===a&&(a=.1),this.addEffect(new c.Lighten(a))},a.prototype.darken=function(a){void 0===a&&(a=.1),this.addEffect(new c.Darken(a))},a.prototype.saturate=function(a){void 0===a&&(a=.1),this.addEffect(new c.Saturate(a))},a.prototype.desaturate=function(a){void 0===a&&(a=.1),this.addEffect(new c.Desaturate(a))},a.prototype.addEffect=function(a){for(var b in this.sprites)this.sprites[b].addEffect(a)},a.prototype.removeEffect=function(a){for(var b in this.sprites)this.sprites[b].removeEffect(a)},a.prototype.clearEffects=function(){for(var a in this.sprites)this.sprites[a].clearEffects()},a.prototype._setAnchor=function(a){for(var b in this.sprites)this.sprites[b].anchor.setTo(a.x,a.y)},a.prototype._setRotation=function(a){for(var b in this.sprites)this.sprites[b].rotation=a},a.prototype._setScale=function(a){for(var b in this.sprites)this.sprites[b].scale=a},a.prototype.reset=function(){this.currentFrame=0},a.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length},a.prototype.tick=function(){var a=Date.now();a-this._oldTime>this.speed&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._oldTime=a)},a.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},a.prototype.skip=function(a){this.currentFrame=(this.currentFrame+a)%this.sprites.length},a.prototype.draw=function(a,b,c){this.tick(),this._updateValues();var d;this.currentFrame<this.sprites.length&&(d=this.sprites[this.currentFrame],this.flipVertical&&(d.flipVertical=this.flipVertical),this.flipHorizontal&&(d.flipHorizontal=this.flipHorizontal),d.draw(a,b,c)),this.freezeFrame!==-1&&this.currentFrame>=this.sprites.length&&(d=this.sprites[e.clamp(this.freezeFrame,0,this.sprites.length-1)],d.draw(a,b,c)),d&&(this.width=d.width,this.height=d.height)},a.prototype.play=function(a,b){this.reset(),this._engine.playAnimation(this,a,b)},a}();b.Animation=f}),c("Drawing/SpriteSheet",["require","exports","Drawing/Sprite","Drawing/Animation","Drawing/Color","Drawing/SpriteEffects","Util/Log","Label"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j=function(){function a(a,b,d,e,f){this.image=a,this.columns=b,this.rows=d,this.sprites=[],this._internalImage=a.image,this.sprites=new Array(b*d);var g=0,h=0;for(g=0;g<d;g++)for(h=0;h<b;h++)this.sprites[h+g*b]=new c.Sprite(this.image,h*e,g*f,e,f)}return a.prototype.getAnimationByIndices=function(a,b,c){var e=this,f=b.map(function(a){return e.sprites[a]});return f=f.map(function(a){return a.clone()}),new d.Animation(a,f,c)},a.prototype.getAnimationBetween=function(a,b,c,e){var f=this.sprites.slice(b,c);return f=f.map(function(a){return a.clone()}),new d.Animation(a,f,e)},a.prototype.getAnimationForAll=function(a,b){var c=this.sprites.map(function(a){return a.clone()});return new d.Animation(a,c,b)},a.prototype.getSprite=function(a){if(a>=0&&a<this.sprites.length)return this.sprites[a];throw new Error("Invalid index: "+a)},a}();b.SpriteSheet=j;var k=function(a){function b(b,c,d,e,g,h,i){var j=a.call(this,b,e,g,h,i)||this;return j.image=b,j.alphabet=c,j.caseInsensitive=d,j.spWidth=h,j.spHeight=i,j._currentColor=f.Color.Black.clone(),j._currentOpacity=1,j._sprites={},j._textShadowOn=!1,j._textShadowDirty=!0,j._textShadowColor=f.Color.Black.clone(),j._textShadowSprites={},j._shadowOffsetX=5,j._shadowOffsetY=5,j._sprites=j.getTextSprites(),j}return e(b,a),b.prototype.getTextSprites=function(){for(var a={},b=0;b<this.alphabet.length;b++){var c=this.alphabet[b];this.caseInsensitive&&(c=c.toLowerCase()),a[c]=this.sprites[b].clone()}return a},b.prototype.setTextShadow=function(a,b,c){this._textShadowOn=!0,this._shadowOffsetX=a,this._shadowOffsetY=b,this._textShadowColor=c.clone(),this._textShadowDirty=!0;for(var d in this._sprites)this._textShadowSprites[d]=this._sprites[d].clone()},b.prototype.useTextShadow=function(a){this._textShadowOn=a,a&&this.setTextShadow(5,5,this._textShadowColor)},b.prototype.draw=function(a,b,c,d,e){if(e=this._parseOptions(e),this._currentColor.toString()!==e.color.toString()||this._currentOpacity!==e.opacity){this._currentOpacity=e.opacity,this._currentColor=e.color;for(var f in this._sprites)this._sprites[f].clearEffects(),this._sprites[f].fill(e.color),this._sprites[f].opacity(e.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var j in this._textShadowSprites)this._textShadowSprites[j].clearEffects(),this._textShadowSprites[j].addEffect(new g.Fill(this._textShadowColor.clone()));this._textShadowDirty=!1}var k=this.sprites[0],l=k.sheight,m=e.fontSize/l,n=b.length*k.swidth*m+b.length*e.letterSpacing,o=c;e.textAlign===i.TextAlign.Left||e.textAlign===i.TextAlign.Start?o=c:e.textAlign===i.TextAlign.Right||e.textAlign===i.TextAlign.End?o=c-n:e.textAlign===i.TextAlign.Center&&(o=c-n/2);var p=d-l*m;e.baseAlign===i.BaseAlign.Top||e.baseAlign===i.BaseAlign.Hanging?p=d:e.baseAlign===i.BaseAlign.Ideographic||e.baseAlign===i.BaseAlign.Bottom||e.baseAlign===i.BaseAlign.Alphabetic?p=d-l*m:e.baseAlign===i.BaseAlign.Middle&&(p=d-l*m/2);for(var q=0;q<b.length;q++){var r=b[q];this.caseInsensitive&&(r=r.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[r].scale.x=m,this._textShadowSprites[r].scale.y=m,this._textShadowSprites[r].draw(a,o+this._shadowOffsetX,p+this._shadowOffsetY));var s=this._sprites[r];s.scale.x=m,s.scale.y=m,s.draw(a,o,p),o+=s.width+e.letterSpacing}catch(a){h.Logger.getInstance().error("SpriteFont Error drawing char "+r)}}},b.prototype._parseOptions=function(a){return{fontSize:a.fontSize||10,letterSpacing:a.letterSpacing||0,color:a.color||f.Color.Black.clone(),textAlign:void 0===typeof a.textAlign?i.TextAlign.Left:a.textAlign,baseAlign:void 0===typeof a.baseAlign?i.BaseAlign.Bottom:a.baseAlign,maxWidth:a.maxWidth||-1,opacity:a.opacity||0}},b}(j);b.SpriteFont=k}),c("Label",["require","exports","Drawing/Color","Actor"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f;!function(a){a[a.Em=0]="Em",a[a.Rem=1]="Rem",a[a.Px=2]="Px",a[a.Pt=3]="Pt",a[a.Percent=4]="Percent"}(f=b.FontUnit||(b.FontUnit={}));var g;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right",a[a.Center=2]="Center",a[a.Start=3]="Start",a[a.End=4]="End"}(g=b.TextAlign||(b.TextAlign={}));var h;!function(a){a[a.Top=0]="Top",a[a.Hanging=1]="Hanging",a[a.Middle=2]="Middle",a[a.Alphabetic=3]="Alphabetic",a[a.Ideographic=4]="Ideographic",a[a.Bottom=5]="Bottom"}(h=b.BaseAlign||(b.BaseAlign={}));var i;!function(a){a[a.Normal=0]="Normal",a[a.Italic=1]="Italic",a[a.Oblique=2]="Oblique"}(i=b.FontStyle||(b.FontStyle={}));var j=function(a){function b(b,e,j,k,l){var m=a.call(this,e,j)||this;return m.bold=!1,m.fontSize=10,m.fontStyle=i.Normal,m.fontUnit=f.Px,m.textAlign=g.Left,m.baseAlign=h.Bottom,m.letterSpacing=0,m.caseInsensitive=!0,m._textShadowOn=!1,m._shadowOffsetX=0,m._shadowOffsetY=0,m._shadowColor=c.Color.Black.clone(),m.text=b||"",m.color=c.Color.Black.clone(),m.spriteFont=l,m.collisionType=d.CollisionType.PreventCollision,m.fontFamily=k||"sans-serif",m}return e(b,a),b.prototype.getTextWidth=function(a){var b=a.font;a.font=this._fontString;var c=a.measureText(this.text).width;return a.font=b,c},b.prototype._lookupFontUnit=function(a){switch(a){case f.Em:return"em";case f.Rem:return"rem";case f.Pt:return"pt";case f.Px:return"px";case f.Percent:return"%";default:return"px"}},b.prototype._lookupTextAlign=function(a){switch(a){case g.Left:return"left";case g.Right:return"right";case g.Center:return"center";case g.End:return"end";case g.Start:return"start";default:return"start"}},b.prototype._lookupBaseAlign=function(a){switch(a){case h.Alphabetic:return"alphabetic";case h.Bottom:return"bottom";case h.Hanging:return"hangin";case h.Ideographic:return"ideographic";case h.Middle:return"middle";case h.Top:return"top";default:return"alphabetic"}},b.prototype._lookupFontStyle=function(a){var b=this.bold?" bold":"";switch(a){case i.Italic:return"italic"+b;case i.Normal:return"normal"+b;case i.Oblique:return"oblique"+b;default:return"normal"+b}},b.prototype.setTextShadow=function(a,b,c){this.spriteFont.setTextShadow(a,b,c)},b.prototype.useTextShadow=function(a){this.spriteFont.useTextShadow(a)},b.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowColor=c.Color.Black.clone()},b.prototype.update=function(b,c){a.prototype.update.call(this,b,c)},b.prototype.draw=function(b,c){b.save(),b.translate(this.pos.x,this.pos.y),b.scale(this.scale.x,this.scale.y),b.rotate(this.rotation),this._textShadowOn&&(b.save(),b.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(b),b.restore()),this._fontDraw(b),a.prototype.draw.call(this,b,c),b.restore()},b.prototype._fontDraw=function(a){if(this.spriteFont)this.spriteFont.draw(a,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{var b=a.textAlign,c=a.textBaseline;a.textAlign=this._lookupTextAlign(this.textAlign),a.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),a.fillStyle=this.color.toString(),a.font=this._fontString,this.maxWidth?a.fillText(this.text,0,0,this.maxWidth):a.fillText(this.text,0,0),a.textAlign=b,a.textBaseline=c}},Object.defineProperty(b.prototype,"_fontString",{get:function(){return this._lookupFontStyle(this.fontStyle)+" "+this.fontSize+this._lookupFontUnit(this.fontUnit)+" "+this.fontFamily},enumerable:!0,configurable:!0}),b.prototype.debugDraw=function(b){a.prototype.debugDraw.call(this,b)},b}(d.Actor);b.Label=j}),c("Interfaces/IAudio",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Interfaces/IAudioImplementation",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Resources/Sound",["require","exports","Util/Log","Util/Util","Promises"],function(a,b,c,d,e){"use strict";function f(){return window.AudioContext?new i:new h}if(Object.defineProperty(b,"__esModule",{value:!0}),window.AudioContext)var g=new window.AudioContext;var h=function(){function a(){this.responseType="blob"}return a.prototype.processData=function(a){var b=URL.createObjectURL(a);return e.Promise.resolve(b)},a.prototype.createInstance=function(a){return new k(a)},a}();b.AudioTag=h;var i=function(){function a(){this._logger=c.Logger.getInstance(),this.responseType="arraybuffer"}return a.prototype.processData=function(a){var b=this,c=new e.Promise;return g.decodeAudioData(a,function(a){c.resolve(a)},function(){b._logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),c.resolve(void 0)}),c},a.prototype.createInstance=function(a){return new l(a)},a.unlock=function(){if(!a._unlocked&&g){var b=g.createBuffer(1,1,22050),c=g.createBufferSource(),d=!1;c.buffer=b,c.connect(g.destination),c.onended=function(){return d=!0},c.noteOn?c.noteOn(0):c.start(0),setTimeout(function(){if(c.playbackState){var b=c;b.playbackState!==b.PLAYING_STATE&&b.playbackState!==b.FINISHED_STATE||(a._unlocked=!0)}else(g.currentTime>0||d)&&(a._unlocked=!0)},0)}},a.isUnlocked=function(){return this._unlocked},a}();i._unlocked=!1,b.WebAudio=i,b.getAudioImplementation=f;var j=function(){function a(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];this._logger=c.Logger.getInstance(),this._data=null,this._tracks=[],this._isLoaded=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},this._wasPlayingOnHidden=!1,this.path="";for(var e=0,g=b;e<g.length;e++){var h=g[e];if(a.canPlayFile(h)){this.path=h;break}}this.path||(this._logger.warn("This browser does not support any of the audio files specified:",b.join(", ")),this._logger.warn("Attempting to use",b[0]),this.path=b[0]),this.sound=f()}return a.canPlayFile=function(a){try{var b=new Audio,d=/.*\.([A-Za-z0-9]+)$/,e=a.match(d)[1];return!!b.canPlayType("audio/"+e)}catch(a){return c.Logger.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",a),!1}},a.prototype.wireEngine=function(a){var b=this;a&&(this._engine=a,this._engine.on("hidden",function(){a.pauseAudioWhenHidden&&b.isPlaying()&&(b._wasPlayingOnHidden=!0,b.pause())}),this._engine.on("visible",function(){a.pauseAudioWhenHidden&&b._wasPlayingOnHidden&&(b.play(),b._wasPlayingOnHidden=!1)}))},a.prototype.instanceCount=function(){return this._tracks.length},a.prototype.setVolume=function(a){this._volume=a;for(var b=0,c=this._tracks;b<c.length;b++){var d=c[b];d.setVolume(a)}this._logger.debug("Set volume for all instances of sound",this.path,"to",a)},a.prototype.setLoop=function(a){this._loop=a;for(var b=0,c=this._tracks;b<c.length;b++){var d=c[b];d.setLoop(a)}this._logger.debug("Set loop for all instances of sound",this.path,"to",a)},a.prototype.isPlaying=function(){return this._tracks.some(function(a){return a.isPlaying()})},a.prototype.play=function(a){var b=this;if(this._isLoaded){for(var c=[],f=0,g=this._tracks;f<g.length;f++){var h=g[f];c.push(h.play())}if(this._isPaused)return this._isPaused=!1,this._logger.debug("Resuming paused instances for sound",this.path,this._tracks),e.Promise.join(c);var i=this.sound.createInstance(this._data);return i.setLoop(this._loop),a?i.setVolume(d.clamp(a,0,1)):i.setVolume(this._volume),this._tracks.push(i),this._logger.debug("Playing new instance for sound",this.path),i.play().then(function(){return b._tracks.splice(b._tracks.indexOf(i),1),!0})}return e.Promise.resolve(!0)},a.prototype.pause=function(){for(var a=0,b=this._tracks;a<b.length;a++){var c=b[a];c.pause()}this._isPaused=!0,this._logger.debug("Paused all instances of sound",this.path)},a.prototype.stop=function(){this._isPaused=!1;for(var a=this._tracks.concat([]),b=0,c=a;b<c.length;b++){var d=c[b];d.stop()}this._logger.debug("Stopped all instances of sound",this.path)},a.prototype.isLoaded=function(){return this._isLoaded},a.prototype.load=function(){var a=this,b=new e.Promise;if(this.getData())return this._logger.debug("Already have data for audio resource",this.path),b.resolve(this.sound),this.oncomplete(),b;this._logger.debug("Started loading sound",this.path);try{this._fetchResource(function(c){return 200!==c.status?(a._logger.error("Failed to load audio resource ",a.path," server responded with error code",c.status),a.onerror(c.response),void b.resolve(null)):void a.setData(c.response).then(function(){a.oncomplete(),a._logger.debug("Completed loading sound",a.path),b.resolve(a.sound)},function(a){return b.resolve(a)})})}catch(a){this._logger.error("Error loading sound! If this is a cross origin error,             you must host your sound with your html and javascript."),this.onerror(a),b.resolve(a)}return b},a.prototype._fetchResource=function(a){var b=new XMLHttpRequest;b.open("GET",this.path,!0),b.responseType=this.sound.responseType,b.onprogress=this.onprogress,b.onerror=this.onerror,b.onload=function(){return a(b)},b.send()},a.prototype.getData=function(){return this._data},a.prototype.setData=function(a){var b=this;return this.sound.processData(a).then(function(a){return b._isLoaded=!0,b._data=b.processData(a),a})},a.prototype.processData=function(a){return a},a}();b.Sound=j;var k=function(){function a(a){this._isPlaying=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this._audioElement=new Audio(a)}return a.prototype.isPlaying=function(){return this._isPlaying},Object.defineProperty(a.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),a.prototype.setLoop=function(a){this._loop=a,this._audioElement.loop=a,this._wireUpOnEnded()},a.prototype.setVolume=function(a){this._volume=a,this._audioElement.volume=d.clamp(a,0,1)},a.prototype.play=function(){return this._isPaused?this._resume():this._isPlaying||this._start(),this._playingPromise},a.prototype._start=function(){this._audioElement.load(),this._audioElement.loop=this._loop,this._audioElement.play(),this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new e.Promise,this._wireUpOnEnded()},a.prototype._resume=function(){this._isPaused&&(this._audioElement.play(),this._isPaused=!1,this._isPlaying=!0,this._wireUpOnEnded())},a.prototype.pause=function(){this._isPlaying&&(this._audioElement.pause(),this._isPaused=!0,this._isPlaying=!1)},a.prototype.stop=function(){this._isPlaying&&(this._audioElement.pause(),this._audioElement.currentTime=0,this._handleOnEnded())},a.prototype._wireUpOnEnded=function(){var a=this;this._loop||(this._audioElement.onended=function(){return a._handleOnEnded()})},a.prototype._handleOnEnded=function(){this._isPlaying=!1,this._isPaused=!1,this._playingPromise.resolve(!0)},a}(),l=function(){function a(a){this._buffer=a,this._volumeNode=g.createGain(),this._isPlaying=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this._currentOffset=0}return a.prototype.isPlaying=function(){return this._isPlaying},a.prototype.setVolume=function(a){this._volume=a,this._volumeNode.gain.value=d.clamp(a,0,1)},a.prototype.setLoop=function(a){this._loop=a,this._bufferSource&&(this._bufferSource.loop=a,this._wireUpOnEnded())},a.prototype.play=function(){return this._isPaused?this._resume():this._isPlaying||this._start(),this._playingPromise},a.prototype._start=function(){this._volumeNode.connect(g.destination),this._createBufferSource(),this._bufferSource.start(0,0),this._startTime=(new Date).getTime(),this._currentOffset=0,this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new e.Promise,this._wireUpOnEnded()},a.prototype._resume=function(){if(this._isPaused){this._bufferSource.onended=null,this._createBufferSource();var a=1/this._bufferSource.playbackRate.value*this._buffer.duration;this._bufferSource.start(0,this._currentOffset%a),this._isPaused=!1,this._isPlaying=!0,this._wireUpOnEnded()}},a.prototype._createBufferSource=function(){this._bufferSource=g.createBufferSource(),this._bufferSource.buffer=this._buffer,this._bufferSource.loop=this._loop,this._bufferSource.playbackRate.value=1,this._bufferSource.connect(this._volumeNode)},a.prototype.pause=function(){if(this._isPlaying){this._bufferSource.stop(0);var a=1/(this._bufferSource.playbackRate.value||1);this._currentOffset=((new Date).getTime()-this._startTime)*a/1e3,this._isPaused=!0,this._isPlaying=!1}},a.prototype.stop=function(){this._isPlaying&&(this._bufferSource.stop(0),this._bufferSource.onended||this._handleOnEnded(),this._currentOffset=0,this._isPlaying=!1,this._isPaused=!1)},a.prototype._wireUpOnEnded=function(){var a=this;this._loop||(this._bufferSource.onended=function(){return a._handleOnEnded()})},a.prototype._handleOnEnded=function(){this._isPaused||(this._isPlaying=!1,this._playingPromise.resolve(!0))},a}()}),c("Interfaces/ILoader",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Loader",["require","exports","Drawing/Color","Resources/Sound","Util/Log","Promises","Class","Util/DrawUtil"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j=function(a){function b(b){var c=a.call(this)||this;return c._resourceList=[],c._index=0,c._resourceCount=0,c._numLoaded=0,c._progressCounts={},c._totalCounts={},c.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",c.logoWidth=468,c.logoHeight=118,c.backgroundColor="#176BAA",c.getData=function(){},c.setData=function(){},c.processData=function(){},c.onprogress=function(a){f.Logger.getInstance().debug("[ex.Loader] Loading "+(100*a.loaded/a.total).toFixed(0))},c.oncomplete=function(){},c.onerror=function(){},b&&c.addResources(b),c}return e(b,a),Object.defineProperty(b.prototype,"_image",{get:function(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement},enumerable:!0,configurable:!0}),b.prototype.wireEngine=function(a){this._engine=a},b.prototype.addResource=function(a){var b=this._index++;this._resourceList.push(a),this._progressCounts[b]=0,this._totalCounts[b]=1,this._resourceCount++},b.prototype.addResources=function(a){var b=0,c=a.length;for(b;b<c;b++)this.addResource(a[b])},b.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},b.prototype.load=function(){function a(b,c){b[c]&&b[c].load().then(function(){a(b,c+1)})}var b=this,c=new g.Promise,d=this;
if(0===this._resourceList.length)return d.oncomplete.call(d),c.resolve();var e=new Array(this._resourceList.length),f=this._resourceList.length;return this._resourceList.forEach(function(a,g){b._engine&&a.wireEngine(b._engine),a.onprogress=function(a){var b=a.total,c=a.loaded;e[g]={loaded:c/b*(100/f),total:100};var h=e.reduce(function(a,b){return{loaded:a.loaded+b.loaded,total:100}},{loaded:0,total:100});d.onprogress.call(d,h)},a.oncomplete=a.onerror=function(){d._numLoaded++,d._numLoaded===d._resourceCount&&(d.oncomplete.call(d),c.resolve())}}),a(this._resourceList,0),c},b.prototype.draw=function(a){a.fillStyle=this.backgroundColor,a.fillRect(0,0,this._engine.canvasWidth,this._engine.canvasHeight);var b=this._engine.canvas.height/2,d=Math.min(this.logoWidth,.75*this._engine.canvas.width),e=this._engine.canvasWidth/2-d/2,f=Math.floor(d*(this.logoHeight/this.logoWidth)),g=this._engine.getAntialiasing();this._engine.setAntialiasing(!0),a.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,e,b-f-20,d,f),a.lineWidth=2,i.roundRect(a,e,b,d,20,10);var h=d*(this._numLoaded/this._resourceCount),j=5,k=h-2*j,l=20-2*j;i.roundRect(a,e+j,b+j,k>0?k:0,l,5,null,c.Color.White),this._engine.setAntialiasing(g)},b.prototype.update=function(a,b){},b}(h.Class);b.Loader=j;var k=function(a){function b(b,c){var e=a.call(this,c)||this;return e._handleOnTrigger=function(){return e._waitPromise.state()===g.PromiseState.Pending&&(d.WebAudio.unlock(),e._waitPromise.resolve(e._loadedValue),e._playTrigger.style.display="none",!1)},e._playTrigger=document.getElementById(b),e._playTrigger.addEventListener("click",e._handleOnTrigger),e}return e(b,a),b.prototype.load=function(){var b=this;return this._waitPromise=new g.Promise,a.prototype.load.call(this).then(function(a){b._loaded=!0,b._loadedValue=a,b._playTrigger.style.display="block"},function(a){b._waitPromise.reject(a)}),this._waitPromise},b}(j);b.PauseAfterLoader=k}),c("Interfaces/IActorTrait",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Traits/CapturePointer",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.update=function(a,b){a.enableCapturePointer&&(a.isKilled()||b.input.pointers.propogate(a))},a}();b.CapturePointer=c}),c("Traits/EulerMovement",["require","exports","Physics","Actor"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(){}return a.prototype.update=function(a,b,e){var f=e/1e3,g=a.acc.clone();a.collisionType===d.CollisionType.Active&&g.addEqual(c.Physics.acc),a.oldVel=a.vel,a.vel.addEqual(g.scale(f)),a.pos.addEqual(a.vel.scale(f)).addEqual(g.scale(.5*f*f)),a.rx+=a.torque*(1/a.moi)*f,a.rotation+=a.rx*f,a.scale.x+=a.sx*e/1e3,a.scale.y+=a.sy*e/1e3},a}();b.EulerMovement=e}),c("Util/CullingBox",["require","exports","Algebra","Drawing/Color"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(){this._topLeft=new c.Vector(0,0),this._topRight=new c.Vector(0,0),this._bottomLeft=new c.Vector(0,0),this._bottomRight=new c.Vector(0,0)}return a.prototype.isSpriteOffScreen=function(a,b){var d=a.currentDrawing.width,e=a.currentDrawing.height,f=a.rotation,g=a.getCenter(),h=a.getWorldPos();this._topLeft.x=h.x-d/2,this._topLeft.y=h.y-e/2,this._topLeft=this._topLeft.rotate(f,g),this._topRight.x=h.x+d/2,this._topRight.y=h.y-e/2,this._topRight=this._topRight.rotate(f,g),this._bottomLeft.x=h.x-d/2,this._bottomLeft.y=h.y+e/2,this._bottomLeft=this._bottomLeft.rotate(f,g),this._bottomRight.x=h.x+d/2,this._bottomRight.y=h.y+e/2,this._bottomRight=this._bottomRight.rotate(f,g);var i=b.worldToScreenCoordinates(this._topLeft),j=b.worldToScreenCoordinates(this._topRight),k=b.worldToScreenCoordinates(this._bottomLeft),l=b.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(i.x,j.x,k.x,l.x),this._yCoords.push(i.y,j.y,k.y,l.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var m=b.screenToWorldCoordinates(new c.Vector(this._xMin,this._yMin)),n=b.screenToWorldCoordinates(new c.Vector(this._xMax,this._yMax));this._xMinWorld=m.x,this._yMinWorld=m.y,this._xMaxWorld=n.x,this._yMaxWorld=n.y;var o=[new c.Vector(this._xMin,this._yMin),new c.Vector(this._xMax,this._yMin),new c.Vector(this._xMin,this._yMax),new c.Vector(this._xMax,this._yMax)];if(o[0].x<0&&o[1].x>b.canvas.clientWidth&&(o[0].y>0||o[2].y<b.canvas.clientHeight))return!1;if(o[0].y<0&&o[2].y>b.canvas.clientHeight&&(o[1].x>0||o[0].x<b.canvas.clientWidth))return!1;for(var p=0;p<o.length;p++)if(o[p].x>0&&o[p].y>0&&o[p].x<b.canvas.clientWidth&&o[p].y<b.canvas.clientHeight)return!1;return!0},a.prototype.debugDraw=function(a){a.beginPath(),a.strokeStyle=d.Color.White.toString(),a.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),a.stroke(),a.fillStyle=d.Color.Red.toString(),a.beginPath(),a.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),a.closePath(),a.fill(),a.fillStyle=d.Color.Green.toString(),a.beginPath(),a.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),a.closePath(),a.fill(),a.fillStyle=d.Color.Blue.toString(),a.beginPath(),a.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),a.closePath(),a.fill(),a.fillStyle=d.Color.Magenta.toString(),a.beginPath(),a.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),a.closePath(),a.fill()},a}();b.CullingBox=e}),c("Traits/OffscreenCulling",["require","exports","Util/CullingBox","Algebra","Events"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(){this.cullingBox=new c.CullingBox}return a.prototype.update=function(a,b){var c=a.eventDispatcher,f=a.anchor,g=a.getGlobalScale(),h=g.x*a.getWidth()/a.scale.x,i=g.y*a.getHeight()/a.scale.y,j=a.getWorldPos(),k=b.worldToScreenCoordinates(new d.Vector(j.x-f.x*h,j.y-f.y*i)),l=1;a.scene&&a.scene.camera&&(l=Math.abs(a.scene.camera.getZoom()));var m=!0;null!=a.currentDrawing&&(m=this.cullingBox.isSpriteOffScreen(a,b)),a.isOffScreen?(k.x+h*l>0&&k.y+i*l>0&&k.x<b.canvasWidth&&k.y<b.canvasHeight||!m)&&(c.emit("enterviewport",new e.EnterViewPortEvent(a)),a.isOffScreen=!1):(k.x+h*l<0||k.y+i*l<0||k.x>b.canvasWidth||k.y>b.canvasHeight)&&m&&(c.emit("exitviewport",new e.ExitViewPortEvent(a)),a.isOffScreen=!0)},a}();b.OffscreenCulling=f}),c("Traits/TileMapCollisionDetection",["require","exports","Actor","Collision/Side","Events"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(){}return a.prototype.update=function(a,b){var f=a.eventDispatcher;if(a.collisionType!==c.CollisionType.PreventCollision&&b.currentScene&&b.currentScene.tileMaps)for(var g=0;g<b.currentScene.tileMaps.length;g++)for(var h,i=b.currentScene.tileMaps[g],j=d.Side.None,k=2,l=!1;(h=i.collides(a))&&!(k--<0);)j=a.getSideFromIntersect(h),f.emit("collision",new e.CollisionEvent(a,null,j,h)),a.collisionType!==c.CollisionType.Active&&a.collisionType!==c.CollisionType.Elastic||(a.pos.y+=h.y,a.pos.x+=h.x,a.collisionType!==c.CollisionType.Elastic||l||(l=!0,j===d.Side.Left?a.vel.x=Math.abs(a.vel.x):j===d.Side.Right?a.vel.x=-Math.abs(a.vel.x):j===d.Side.Top?a.vel.y=Math.abs(a.vel.y):j===d.Side.Bottom&&(a.vel.y=-Math.abs(a.vel.y))))},a}();b.TileMapCollisionDetection=f}),c("Traits/Index",["require","exports","Traits/CapturePointer","Traits/EulerMovement","Traits/OffscreenCulling","Traits/TileMapCollisionDetection"],function(a,b,c,d,e,f){"use strict";function g(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),g(c),g(d),g(e),g(f)}),c("Particles",["require","exports","Actor","Drawing/Color","Algebra","Util/Util","Util/DrawUtil","Traits/Index"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j;!function(a){a[a.Circle=0]="Circle",a[a.Rectangle=1]="Rectangle"}(j=b.EmitterType||(b.EmitterType={}));var k=function(){function a(a,b,c,e,g,h,i,j,k,l){this.position=new f.Vector(0,0),this.velocity=new f.Vector(0,0),this.acceleration=new f.Vector(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=d.Color.White.clone(),this.endColor=d.Color.White.clone(),this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=d.Color.White.clone(),this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.emitter=a,this.life=b||this.life,this.opacity=c||this.opacity,this.endColor=g||this.endColor.clone(),this.beginColor=e||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=h||this.position,this.velocity=i||this.velocity,this.acceleration=j||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=k||0,this.endSize=l||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return a.prototype.kill=function(){this.emitter.removeParticle(this)},a.prototype.update=function(a){if(this.life=this.life-a,this.elapsedMultiplier=this.elapsedMultiplier+a,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=g.clamp(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=g.clamp(this.sizeRate*a+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=g.clamp(this._currentColor.r+this._rRate*a,0,255),this._currentColor.g=g.clamp(this._currentColor.g+this._gRate*a,0,255),this._currentColor.b=g.clamp(this._currentColor.b+this._bRate*a,0,255),this._currentColor.a=g.clamp(this.opacity,1e-4,1),this.focus){var b=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(a/1e3);this.velocity=this.velocity.add(b)}else this.velocity=this.velocity.add(this.acceleration.scale(a/1e3));this.position=this.position.add(this.velocity.scale(a/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*a/1e3)%(2*Math.PI))},a.prototype.draw=function(a){return this.particleSprite?(this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),void this.particleSprite.draw(a,this.position.x,this.position.y)):(this._currentColor.a=g.clamp(this.opacity,1e-4,1),a.fillStyle=this._currentColor.toString(),a.beginPath(),a.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),a.fill(),void a.closePath())},a}();b.Particle=k;var l=function(a){function b(b,e,h,k){var l=a.call(this,b,e,h,k,d.Color.White)||this;l._particlesToEmit=0,l.numParticles=0,l.isEmitting=!0,l.particles=null,l.deadParticles=null,l.minVel=0,l.maxVel=0,l.acceleration=new f.Vector(0,0),l.minAngle=0,l.maxAngle=0,l.emitRate=1,l.particleLife=2e3,l.opacity=1,l.fadeFlag=!1,l.focus=null,l.focusAccel=1,l.startSize=null,l.endSize=null,l.minSize=5,l.maxSize=5,l.beginColor=d.Color.White,l.endColor=d.Color.White,l.particleSprite=null,l.emitterType=j.Rectangle,l.radius=0,l.particleRotationalVelocity=0,l.randomRotation=!1,l.collisionType=c.CollisionType.PreventCollision,l.particles=new g.Collection,l.deadParticles=new g.Collection;for(var m=0;m<l.traits.length;m++)l.traits[m]instanceof i.OffscreenCulling&&l.traits.splice(m,1);return l}return e(b,a),b.prototype.removeParticle=function(a){this.deadParticles.push(a)},b.prototype.emitParticles=function(a){for(var b=0;b<a;b++)this.particles.push(this._createParticle())},b.prototype.clearParticles=function(){this.particles.clear()},b.prototype._createParticle=function(){var a=0,b=0,c=g.randomInRange(this.minAngle,this.maxAngle),d=g.randomInRange(this.minVel,this.maxVel),e=this.startSize||g.randomInRange(this.minSize,this.maxSize),h=d*Math.cos(c),i=d*Math.sin(c);if(this.emitterType===j.Rectangle)a=g.randomInRange(this.pos.x,this.pos.x+this.getWidth()),b=g.randomInRange(this.pos.y,this.pos.y+this.getHeight());else if(this.emitterType===j.Circle){var l=g.randomInRange(0,this.radius);a=l*Math.cos(c)+this.pos.x,b=l*Math.sin(c)+this.pos.y}var m=new k(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new f.Vector(a,b),new f.Vector(h,i),this.acceleration,this.startSize,this.endSize);return m.fadeFlag=this.fadeFlag,m.particleSize=e,this.particleSprite&&(m.particleSprite=this.particleSprite),m.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(m.currentRotation=g.randomInRange(0,2*Math.PI)),this.focus&&(m.focus=this.focus.add(new f.Vector(this.pos.x,this.pos.y)),m.focusAccel=this.focusAccel),m},b.prototype.update=function(b,c){var d=this;a.prototype.update.call(this,b,c),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(c/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(function(a){return a.update(c)}),this.deadParticles.forEach(function(a){return d.particles.removeElement(a)}),this.deadParticles.clear()},b.prototype.draw=function(a){this.particles.forEach(function(b){return b.draw(a)})},b.prototype.debugDraw=function(b){a.prototype.debugDraw.call(this,b),b.fillStyle=d.Color.Black.toString(),b.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(b.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),h.line(b,d.Color.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,a.prototype.getCenter.call(this).x,a.prototype.getCenter.call(this).y),b.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))},b}(c.Actor);b.ParticleEmitter=l}),c("TileMap",["require","exports","Collision/BoundingBox","Drawing/Color","Class","Algebra","Util/Log","Events"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j=function(a){function b(b,c,d,e,f,g){var i=a.call(this)||this;i.x=b,i.y=c,i.cellWidth=d,i.cellHeight=e,i.rows=f,i.cols=g,i._collidingX=-1,i._collidingY=-1,i._onScreenXStart=0,i._onScreenXEnd=9999,i._onScreenYStart=0,i._onScreenYEnd=9999,i._spriteSheets={},i.logger=h.Logger.getInstance(),i.data=[],i.data=new Array(f*g);for(var j=0;j<g;j++)for(var k=0;k<f;k++)!function(){var a=new l(j*d+b,k*e+c,d,e,j+k*g);i.data[j+k*g]=a}();return i}return e(b,a),b.prototype.on=function(b,c){a.prototype.on.call(this,b,c)},b.prototype.registerSpriteSheet=function(a,b){this._spriteSheets[a]=b},b.prototype.collides=function(a){for(var b=a.pos.x+a.getWidth(),c=a.pos.y+a.getHeight(),d=a.getBounds(),e=[],f=d.left;f<=b;f+=Math.min(a.getWidth()/2,this.cellWidth/2))for(var h=d.top;h<=c;h+=Math.min(a.getHeight()/2,this.cellHeight/2)){var i=this.getCellByPoint(f,h);if(i&&i.solid){var j=d.collides(i.getBounds()),k=a.getCenter().sub(i.getCenter());j&&j.dot(k)>0&&e.push(j)}}if(0===e.length)return null;var l=e.reduce(function(a,b){var c=a.x,d=a.y;return Math.abs(a.x)<Math.abs(b.x)&&(c=b.x),Math.abs(a.y)<Math.abs(b.y)&&(d=b.y),new g.Vector(c,d)});return l},b.prototype.getCellByIndex=function(a){return this.data[a]},b.prototype.getCell=function(a,b){return a<0||b<0||a>=this.cols||b>=this.rows?null:this.data[a+b*this.cols]},b.prototype.getCellByPoint=function(a,b){a=Math.floor((a-this.x)/this.cellWidth),b=Math.floor((b-this.y)/this.cellHeight);var c=this.getCell(a,b);return a>=0&&b>=0&&a<this.cols&&b<this.rows&&c?c:null},b.prototype.update=function(a,b){this.emit("preupdate",new i.PreUpdateEvent(a,b,this));var c=a.screenToWorldCoordinates(new g.Vector(0,0)),d=a.screenToWorldCoordinates(new g.Vector(a.canvas.clientWidth,a.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor(c.x/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((c.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor(d.x/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((d.y-this.y)/this.cellHeight)+2,0),this.emit("postupdate",new i.PostUpdateEvent(a,b,this))},b.prototype.draw=function(a,b){this.emit("predraw",new i.PreDrawEvent(a,b,this)),a.save(),a.translate(this.x,this.y);var c,d,e,f=this._onScreenXStart,g=Math.min(this._onScreenXEnd,this.cols),h=this._onScreenYStart,j=Math.min(this._onScreenYEnd,this.rows);for(f;f<g;f++){for(h;h<j;h++)for(c=this.getCell(f,h).sprites.filter(function(a){return a.spriteId>-1}),d=0,e=c.length;d<e;d++){var k=this._spriteSheets[c[d].spriteSheetKey];if(k){var l=k.getSprite(c[d].spriteId);l?l.draw(a,f*this.cellWidth,h*this.cellHeight):this.logger.warn("Sprite does not exist for id",c[d].spriteId,"in sprite sheet",c[d].spriteSheetKey,l,k)}else this.logger.warn("Sprite sheet",c[d].spriteSheetKey,"does not exist",k)}h=this._onScreenYStart}a.restore(),this.emit("postdraw",new i.PostDrawEvent(a,b,this))},b.prototype.debugDraw=function(a){var b=this.cols*this.cellWidth,c=this.rows*this.cellHeight;a.save(),a.strokeStyle=d.Color.Red.toString();for(var e=0;e<this.cols+1;e++)a.beginPath(),a.moveTo(this.x+e*this.cellWidth,this.y),a.lineTo(this.x+e*this.cellWidth,this.y+c),a.stroke();for(var f=0;f<this.rows+1;f++)a.beginPath(),a.moveTo(this.x,this.y+f*this.cellHeight),a.lineTo(this.x+b,this.y+f*this.cellHeight),a.stroke();var g=d.Color.Red.clone();g.a=.3,this.data.filter(function(a){return a.solid}).forEach(function(b){a.fillStyle=g.toString(),a.fillRect(b.x,b.y,b.width,b.height)}),this._collidingY>-1&&this._collidingX>-1&&(a.fillStyle=d.Color.Cyan.toString(),a.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),a.restore()},b}(f.Class);b.TileMap=j;var k=function(){function a(a,b){this.spriteSheetKey=a,this.spriteId=b}return a}();b.TileSprite=k;var l=function(){function a(a,b,d,e,f,g,h){void 0===g&&(g=!1),void 0===h&&(h=[]),this.x=a,this.y=b,this.width=d,this.height=e,this.index=f,this.solid=g,this.sprites=h,this._bounds=new c.BoundingBox(this.x,this.y,this.x+this.width,this.y+this.height)}return a.prototype.getBounds=function(){return this._bounds},a.prototype.getCenter=function(){return new g.Vector(this.x+this.width/2,this.y+this.height/2)},a.prototype.pushSprite=function(a){this.sprites.push(a)},a.prototype.removeSprite=function(a){var b=-1;(b=this.sprites.indexOf(a))>-1&&this.sprites.splice(b,1)},a.prototype.clearSprites=function(){this.sprites.length=0},a}();b.Cell=l}),c("Timer",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(b,c,d){this.id=0,this.interval=10,this.fcn=function(){},this.repeats=!1,this._elapsedTime=0,this._totalTimeAlive=0,this.complete=!1,this.scene=null,this.id=a.id++,this.interval=c||this.interval,this.fcn=b||this.fcn,this.repeats=d||this.repeats}return a.prototype.update=function(a){this._totalTimeAlive+=a,this._elapsedTime+=a,this._elapsedTime>this.interval&&(this.fcn.call(this),this.repeats?this._elapsedTime=0:this.complete=!0)},a.prototype.getTimeRunning=function(){return this._totalTimeAlive},a.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},a}();c.id=0,b.Timer=c}),c("Trigger",["require","exports","Drawing/Color","Actions/Action","EventDispatcher","Actor"],function(a,b,c,d,f,g){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var h=function(a){function b(b,c,e,h,i,j){var k=a.call(this,b,c,e,h)||this;return k._action=function(){},k.repeats=1,k.target=null,k.repeats=j||k.repeats,k._action=i||k._action,k.collisionType=g.CollisionType.PreventCollision,k.eventDispatcher=new f.EventDispatcher(k),k.actionQueue=new d.ActionQueue(k),k}return e(b,a),b.prototype.update=function(a,b){if(this.actionQueue.update(b),this.pos.x+=this.vel.x*b/1e3,this.pos.y+=this.vel.y*b/1e3,this.rotation+=this.rx*b/1e3,this.scale.x+=this.sx*b/1e3,this.scale.y+=this.sy*b/1e3,this.target)this.collides(this.target)&&this._dispatchAction();else for(var c=0;c<a.currentScene.children.length;c++){var d=a.currentScene.children[c];d!==this&&d.collisionType!==g.CollisionType.PreventCollision&&this.collides(d)&&this._dispatchAction()}0===this.repeats&&this.kill()},b.prototype._dispatchAction=function(){this._action.call(this),this.repeats--},b.prototype.draw=function(a,b){},b.prototype.debugDraw=function(b){a.prototype.debugDraw.call(this,b),b.save(),b.translate(this.pos.x,this.pos.y);var d=this.getBounds(),e=this.getWorldPos();d.left=d.left-e.x,d.right=d.right-e.x,d.top=d.top-e.y,d.bottom=d.bottom-e.y,b.fillStyle=c.Color.Violet.toString(),b.strokeStyle=c.Color.Violet.toString(),b.fillText("Trigger",10,10),d.debugDraw(b),b.restore()},b}(g.Actor);b.Trigger=h}),c("Actions/Index",["require","exports","Actions/ActionContext","Actions/RotationType","Actions/Action"],function(a,b,c,d,e){"use strict";function f(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),f(c),f(d),b.Actions=e,b.Internal={Actions:e}}),c("Collision/DynamicTree",["require","exports","Physics","Collision/BoundingBox","Util/Log"],function(a,b,c,d,e){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a){this.parent=a,this.parent=a||null,this.body=null,this.bounds=new d.BoundingBox,this.left=null,this.right=null,this.height=0}return a.prototype.isLeaf=function(){return!this.left&&!this.right},a}();b.TreeNode=f;var g=function(){function a(a){void 0===a&&(a=new d.BoundingBox(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this.worldBounds=a,this.root=null,this.nodes={}}return a.prototype._insert=function(a){if(null===this.root)return this.root=a,void(this.root.parent=null);for(var b=a.bounds,c=this.root;!c.isLeaf();){var d,e,g=c.left,h=c.right,i=c.bounds.getPerimeter(),j=c.bounds.combine(b),k=j.getPerimeter(),l=2*k,m=2*(k-i),n=0,o=b.combine(g.bounds);g.isLeaf()?n=o.getPerimeter()+m:(e=g.bounds.getPerimeter(),d=o.getPerimeter(),n=d-e+m);var p=0,q=b.combine(h.bounds);if(h.isLeaf()?p=q.getPerimeter()+m:(e=h.bounds.getPerimeter(),d=q.getPerimeter(),p=d-e+m),l<n&&l<p)break;c=n<p?g:h}var r=c.parent,s=new f(r);s.bounds=b.combine(c.bounds),s.height=c.height+1,null!==r?(r.left===c?r.left=s:r.right=s,s.left=c,s.right=a,c.parent=s,a.parent=s):(s.left=c,s.right=a,c.parent=s,a.parent=s,this.root=s);for(var t=a.parent;t;){if(t=this._balance(t),!t.left)throw new Error("Parent of current leaf cannot have a null left child"+t);if(!t.right)throw new Error("Parent of current leaf cannot have a null right child"+t);t.height=1+Math.max(t.left.height,t.right.height),t.bounds=t.left.bounds.combine(t.right.bounds),t=t.parent}},a.prototype._remove=function(a){if(a===this.root)return void(this.root=null);var b,c=a.parent,d=c.parent;if(b=c.left===a?c.right:c.left,d){d.left===c?d.left=b:d.right=b,b.parent=d;for(var e=d;e;)e=this._balance(e),e.bounds=e.left.bounds.combine(e.right.bounds),e.height=1+Math.max(e.left.height,e.right.height),e=e.parent}else this.root=b,b.parent=null},a.prototype.trackBody=function(a){var b=new f;b.body=a,b.bounds=a.getBounds(),b.bounds.left-=2,b.bounds.top-=2,b.bounds.right+=2,b.bounds.bottom+=2,this.nodes[a.actor.id]=b,this._insert(b)},a.prototype.updateBody=function(a){var b=this.nodes[a.actor.id];if(!b)return!1;var d=a.getBounds();if(!this.worldBounds.contains(d))return e.Logger.getInstance().warn("Actor with id "+a.actor.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(a),!1;if(b.bounds.contains(d))return!1;this._remove(b),d.left-=c.Physics.boundsPadding,d.top-=c.Physics.boundsPadding,d.right+=c.Physics.boundsPadding,d.bottom+=c.Physics.boundsPadding;var f=a.vel.x*c.Physics.dynamicTreeVelocityMultiplyer,g=a.vel.y*c.Physics.dynamicTreeVelocityMultiplyer;return f<0?d.left+=f:d.right+=f,g<0?d.top+=g:d.bottom+=g,b.bounds=d,this._insert(b),!0},a.prototype.untrackBody=function(a){var b=this.nodes[a.actor.id];b&&(this._remove(b),this.nodes[a.actor.id]=null,delete this.nodes[a.actor.id])},a.prototype._balance=function(a){if(null===a)throw new Error("Cannot balance at null node");if(a.isLeaf()||a.height<2)return a;var b=a.left,c=a.right,d=a,e=b,f=c,g=b.left,h=b.right,i=c.left,j=c.right,k=f.height-e.height;if(k>1)return f.left=d,f.parent=d.parent,d.parent=f,f.parent?f.parent.left===d?f.parent.left=f:f.parent.right=f:this.root=f,i.height>j.height?(f.right=i,d.right=j,j.parent=d,d.bounds=e.bounds.combine(j.bounds),f.bounds=d.bounds.combine(i.bounds),d.height=1+Math.max(e.height,j.height),f.height=1+Math.max(d.height,i.height)):(f.right=j,d.right=i,i.parent=d,d.bounds=e.bounds.combine(i.bounds),f.bounds=d.bounds.combine(j.bounds),d.height=1+Math.max(e.height,i.height),f.height=1+Math.max(d.height,j.height)),f;if(k<-1){if(e.left=d,e.parent=d.parent,d.parent=e,e.parent)if(e.parent.left===d)e.parent.left=e;else{if(e.parent.right!==d)throw"Error rotating Dynamic Tree";e.parent.right=e}else this.root=e;return g.height>h.height?(e.right=g,d.left=h,h.parent=d,d.bounds=f.bounds.combine(h.bounds),e.bounds=d.bounds.combine(g.bounds),d.height=1+Math.max(f.height,h.height),e.height=1+Math.max(d.height,g.height)):(e.right=h,d.left=g,g.parent=d,d.bounds=f.bounds.combine(g.bounds),e.bounds=d.bounds.combine(h.bounds),d.height=1+Math.max(f.height,g.height),e.height=1+Math.max(d.height,h.height)),e}return a},a.prototype.getHeight=function(){return null===this.root?0:this.root.height},a.prototype.query=function(a,b){var c=a.getBounds(),d=function(e){if(e&&e.bounds.collides(c)){if(!e.isLeaf()||e.body===a)return d(e.left)||d(e.right);if(b.call(a,e.body))return!0}return!1};d(this.root)},a.prototype.rayCastQuery=function(a,b,c){void 0===b&&(b=1/0);var d=function(e){if(e&&e.bounds.rayCast(a,b)){if(!e.isLeaf())return d(e.left)||d(e.right);if(c.call(a,e.body))return!0}return!1};d(this.root)},a.prototype.getNodes=function(){var a=function(b){return b?[b].concat(a(b.left),a(b.right)):[]};return a(this.root)},a.prototype.debugDraw=function(a){var b=function(c){c&&(c.isLeaf()?(a.lineWidth=1,a.strokeStyle="green"):(a.lineWidth=1,a.strokeStyle="white"),c.bounds.debugDraw(a),c.left&&b(c.left),c.right&&b(c.right))};b(this.root)},a}();b.DynamicTree=g}),c("Collision/ICollisionResolver",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Collision/DynamicTreeCollisionBroadphase",["require","exports","Physics","Collision/DynamicTree","Collision/Pair","Algebra","Actor","Util/Log"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(){this._dynamicCollisionTree=new d.DynamicTree,this._collisionHash={},this._collisionPairCache=[]}return a.prototype.track=function(a){return a?void this._dynamicCollisionTree.trackBody(a):void h.Logger.getInstance().warn("Cannot track null physics body")},a.prototype.untrack=function(a){return a?void this._dynamicCollisionTree.untrackBody(a):void h.Logger.getInstance().warn("Cannot untrack a null physics body")},a.prototype._canCollide=function(a,b){var c=e.Pair.calculatePairHash(a.body,b.body);return!this._collisionHash[c]&&((a.collisionType!==g.CollisionType.Fixed||b.collisionType!==g.CollisionType.Fixed)&&(b.collisionType!==g.CollisionType.PreventCollision&&!b.isKilled()))},a.prototype.broadphase=function(a,b,d){var h=this,i=b/1e3,j=a.filter(function(a){return!a.isKilled()&&a.collisionType!==g.CollisionType.PreventCollision});this._collisionPairCache=[],this._collisionHash={};for(var k,l=0,m=j.length;l<m;l++)k=j[l],this._dynamicCollisionTree.query(k.body,function(a){if(h._canCollide(k,a.actor)){var b=new e.Pair(k.body,a);h._collisionHash[b.id]=!0,h._collisionPairCache.push(b)}return!1});if(d&&(d.physics.pairs=this._collisionPairCache.length),c.Physics.checkForFastBodies)for(var n=0,o=j;n<o.length;n++){var k=o[n];if(k.collisionType===g.CollisionType.Active){var p=k.vel.magnitude()*i+.5*k.acc.magnitude()*i*i,q=Math.min(k.body.getBounds().getHeight(),k.body.getBounds().getWidth());if(c.Physics.disableMinimumSpeedForFastBody||p>q/2){d&&d.physics.fastBodies++;var r=k.pos.sub(k.oldPos),s=k.body.collisionArea.getCenter(),t=k.body.collisionArea.getFurthestPoint(k.vel),u=t.sub(r),v=new f.Ray(u,k.vel);v.pos=v.pos.add(v.dir.scale(-2*c.Physics.surfaceEpsilon));var w,x=new f.Vector(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(v,p+2*c.Physics.surfaceEpsilon,function(a){if(k.body!==a&&a.collisionArea){var b=a.collisionArea.rayCast(v,p+10*c.Physics.surfaceEpsilon);if(b){var d=b.sub(u);d.magnitude()<x.magnitude()&&(x=d,w=a)}}return!1}),w&&f.Vector.isValid(x)){var y=new e.Pair(k.body,w);this._collisionHash[y.id]||(this._collisionHash[y.id]=!0,this._collisionPairCache.push(y));var z=s.sub(t);k.pos=u.add(z).add(x).add(v.dir.scale(2*c.Physics.surfaceEpsilon)),k.body.collisionArea.recalc(),d&&d.physics.fastBodyCollisions++}}}}return this._collisionPairCache},a.prototype.narrowphase=function(a,b){for(var c=0;c<a.length;c++)a[c].collide(),b&&a[c].collision&&(b.physics.collisions++,b.physics.collidersHash[a[c].id]=a[c])},a.prototype.resolve=function(a,b){var d=0,e=this._collisionPairCache.length;for(d=0;d<e;d++)this._collisionPairCache[d].resolve(b);for(d=0;d<e;d++)this._collisionPairCache[d].collision&&(this._collisionPairCache[d].bodyA.applyMtv(),this._collisionPairCache[d].bodyB.applyMtv(),this._collisionPairCache[d].bodyA.actor.integrate(a*c.Physics.collisionShift),this._collisionPairCache[d].bodyB.actor.integrate(a*c.Physics.collisionShift))},a.prototype.update=function(a){var b=0,c=0,d=a.length;for(c;c<d;c++)this._dynamicCollisionTree.updateBody(a[c].body)&&b++;return b},a.prototype.debugDraw=function(a){if(c.Physics.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(a),c.Physics.showContacts||c.Physics.showCollisionNormals)for(var b=0,d=this._collisionPairCache;b<d.length;b++){var e=d[b];e.debugDraw(a)}},a}();b.DynamicTreeCollisionBroadphase=i}),c("Collision/IPhysics",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Collision/NaiveCollisionBroadphase",["require","exports","Physics","Collision/CollisionContact","Collision/Pair","Actor"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(){}return a.prototype.track=function(){},a.prototype.untrack=function(){},a.prototype.broadphase=function(a){for(var b,g,h=a.filter(function(a){return!a.isKilled()&&a.collisionType!==f.CollisionType.PreventCollision}),i=[],j=0,k=h.length;j<k;j++){b=h[j];for(var l=j+1;l<k;l++){g=h[l];var m;if(m=b.collides(g)){var n=new e.Pair(b.body,g.body);n.collision=new d.CollisionContact(b.collisionArea,g.collisionArea,m,b.pos,m),i.some(function(a){return a.id===n.id})||i.push(n)}}}var o=0,p=i.length;for(o;o<p;o++)i[o].resolve(c.Physics.collisionResolutionStrategy);return i},a.prototype.narrowphase=function(){},a.prototype.resolve=function(){},a.prototype.update=function(){return 0},a.prototype.debugDraw=function(){},a}();b.NaiveCollisionBroadphase=g}),c("Collision/Index",["require","exports","Collision/Body","Collision/BoundingBox","Collision/CircleArea","Collision/CollisionContact","Collision/CollisionJumpTable","Collision/DynamicTree","Collision/DynamicTreeCollisionBroadphase","Collision/EdgeArea","Collision/NaiveCollisionBroadphase","Collision/Pair","Collision/PolygonArea","Collision/Side"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),o(c),o(d),o(e),o(f),o(g),o(h),o(i),o(j),o(k),o(l),o(m),o(n)}),c("Drawing/Polygon",["require","exports","Algebra"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=new c.Vector(0,0),this.rotation=0,this.scale=new c.Vector(1,1),
this._points=a;var b=this._points.reduce(function(a,b){return Math.min(a,b.x)},0),d=this._points.reduce(function(a,b){return Math.max(a,b.x)},0);this.width=d-b;var e=this._points.reduce(function(a,b){return Math.min(a,b.y)},0),f=this._points.reduce(function(a,b){return Math.max(a,b.y)},0);this.height=f-e,this.naturalHeight=this.height,this.naturalWidth=this.width}return a.prototype.addEffect=function(){},a.prototype.removeEffect=function(){},a.prototype.clearEffects=function(){},a.prototype.reset=function(){},a.prototype.draw=function(a,b,c){a.save(),a.translate(b+this.anchor.x,c+this.anchor.y),a.scale(this.scale.x,this.scale.y),a.rotate(this.rotation),a.beginPath(),a.lineWidth=this.lineWidth;var d=this._points[0];a.moveTo(d.x,d.y);var e=0,f=this._points.length;for(e;e<f;e++)a.lineTo(this._points[e].x,this._points[e].y);a.lineTo(d.x,d.y),a.closePath(),this.filled&&(a.fillStyle=this.fillColor.toString(),a.fill()),a.strokeStyle=this.lineColor.toString(),this.flipHorizontal&&(a.translate(this.width,0),a.scale(-1,1)),this.flipVertical&&(a.translate(0,this.height),a.scale(1,-1)),a.stroke(),a.restore()},a}();b.Polygon=d}),c("Drawing/Index",["require","exports","Drawing/Animation","Drawing/Color","Drawing/Polygon","Drawing/Sprite","Drawing/SpriteSheet","Drawing/SpriteEffects"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),i(c),i(d),i(e),i(f),i(g),b.Effects=h}),c("Interfaces/Index",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Math/Random",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=4294967295,d=function(){function a(a){this.seed=a,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(a||Date.now())>>>0;for(var b=1;b<this._n;b++){var c=this._mt[b-1]^this._mt[b-1]>>>this._w-2;this._mt[b]=(this._f*((4294901760&c)>>>16)<<16)+this._f*(65535&c)+b>>>0}this._index=this._n}return a.prototype._twist=function(){for(var a=[0,this._a],b=0,d=0;d<this._n-this._m;d++)b=this._mt[d]&this._upperMask|this._mt[d+1]&this._lowerMask,this._mt[d]=this._mt[d+this._m]^b>>>1^a[1&b]&c;for(;d<this._n-1;d++)b=this._mt[d]&this._upperMask|this._mt[d+1]&this._lowerMask,this._mt[d]=this._mt[d+(this._m-this._n)]^b>>>1^a[1&b]&c;b=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^b>>>1^a[1&b]&c,this._index=0},a.prototype.nextInt=function(){this._index>=this._n&&this._twist();var a=this._mt[this._index++];return a^=a>>>this._u,a^=a<<this._s&this._b,a^=a<<this._t&this._c,a^=a>>>this._l,a>>>0},a.prototype.next=function(){return this.nextInt()*(1/4294967296)},a.prototype.floating=function(a,b){return(b-a)*this.next()+a},a.prototype.integer=function(a,b){return Math.floor((b-a+1)*this.next()+a)},a.prototype.bool=function(a){return void 0===a&&(a=.5),this.next()<=a},a.prototype.pickOne=function(a){return a[this.integer(0,a.length-1)]},a.prototype.pickSet=function(a,b,c){return void 0===c&&(c=!1),c?this._pickSetWithDuplicates(a,b):this._pickSetWithoutDuplicates(a,b)},a.prototype._pickSetWithoutDuplicates=function(a,b){if(b>a.length||b<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(b===a.length)return a;for(var c=new Array(b),d=0,e=a.slice(0);d<b;){var f=this.integer(0,e.length-1);c[d++]=e[f],e.splice(f,1)}return c},a.prototype._pickSetWithDuplicates=function(a,b){if(b<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");for(var c=new Array(b),d=0;d<b;d++)c.push(this.pickOne(a));return c},a.prototype.shuffle=function(a){for(var b=a.slice(0),c=null,d=0;d<b.length-2;d++){var e=this.integer(d,b.length-1);c=b[d],b[d]=b[e],b[e]=c}return b},a.prototype.range=function(a,b,c){for(var d=new Array(a),e=0;e<a;e++)d[e]=this.integer(b,c);return d},a.prototype.d4=function(){return this.integer(1,4)},a.prototype.d6=function(){return this.integer(1,6)},a.prototype.d8=function(){return this.integer(1,8)},a.prototype.d10=function(){return this.integer(1,10)},a.prototype.d12=function(){return this.integer(1,12)},a.prototype.d20=function(){return this.integer(1,20)},a}();b.Random=d}),c("Math/PerlinNoise",["require","exports","Math/Random","Drawing/Color","Util/Util"],function(a,b,c,d,e){"use strict";function f(a,b,c){return b+a*(c-b)}function g(a){return a*a*a*(a*(6*a-15)+10)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},a=e.extend({},this._defaultPerlinOptions,a),this.persistance=a.persistance,this.amplitude=a.amplitude,this.frequency=a.frequency,this.octaves=a.octaves,a.seed?this._random=new c.Random(a.seed):this._random=new c.Random,this._perm=this._random.shuffle(this._perm);for(var b=0;b<512;b++)this._p[b]=255&this._perm[b%256]}return a.prototype.noise=function(){for(var a=this.amplitude,b=this.frequency,c=0,d=0,e=0;e<this.octaves;e++){switch(arguments.length){case 1:c+=this._noise1d(arguments[0]*b)*a;break;case 2:c+=this._noise2d(arguments[0]*b,arguments[1]*b)*a;break;case 3:c+=this._noise3d(arguments[0]*b,arguments[1]*b,arguments[2]*b)*a;break;default:throw new Error("Invalid arguments for perlin noise")}d+=a,a*=this.persistance,b*=2}return c/d},a.prototype.sequence=function(a,b){b||(b=1/a);for(var c=new Array(a),d=0;d<a;d++)c[d]=this.noise(d*b);return c},a.prototype.grid=function(a,b,c){c||(c=1/Math.min(a,b));for(var d=new Array(a*b),e=0;e<b;e++)for(var f=0;f<a;f++)d[f+e*a]=this.noise(f*c,e*c);return d},a.prototype._gradient3d=function(a,b,c,d){var e=15&a,f=e<8?b:c,g=e<4?c:12===e||14===e?b:d;return(0===(1&e)?f:-f)+(0===(2&e)?g:-g)},a.prototype._gradient2d=function(a,b,c){var d=0===(1&a)?b:c;return 0===(2&a)?-d:d},a.prototype._gradient1d=function(a,b){return 0===(1&a)?-b:b},a.prototype._noise1d=function(a){var b=255&Math.floor(a);a-=Math.floor(a);var c=g(a);return(f(c,this._gradient1d(this._p[b],a),this._gradient1d(this._p[b+1],a-1))+1)/2},a.prototype._noise2d=function(a,b){var c=255&Math.floor(a),d=255&Math.floor(b);a-=Math.floor(a),b-=Math.floor(b);var e=g(a),h=g(b),i=this._p[c]+d,j=this._p[c+1]+d;return(f(h,f(e,this._gradient2d(this._p[i],a,b),this._gradient2d(this._p[j],a-1,b)),f(e,this._gradient2d(this._p[i+1],a,b-1),this._gradient2d(this._p[j+1],a-1,b-1)))+1)/2},a.prototype._noise3d=function(a,b,c){var d=255&Math.floor(a),e=255&Math.floor(b),h=255&Math.floor(c);a-=Math.floor(a),b-=Math.floor(b),c-=Math.floor(c);var i=g(a),j=g(b),k=g(c),l=this._p[d]+e,m=this._p[d+1]+e,n=this._p[l]+h,o=this._p[m]+h,p=this._p[l+1]+h,q=this._p[m+1]+h;return(f(k,f(j,f(i,this._gradient3d(this._p[n],a,b,c),this._gradient3d(this._p[o],a-1,b,c)),f(i,this._gradient3d(this._p[p],a,b-1,c),this._gradient3d(this._p[q],a-1,b-1,c))),f(j,f(i,this._gradient3d(this._p[n+1],a,b,c-1),this._gradient3d(this._p[o+1],a-1,b,c-1)),f(i,this._gradient3d(this._p[p+1],a,b-1,c-1),this._gradient3d(this._p[q+1],a-1,b-1,c-1))))+1)/2},a}();b.PerlinGenerator=h;var i=function(){function a(a,b){this.generator=a,this.colorFcn=b,b||(this.colorFcn=function(a){return a<125?d.Color.Black:d.Color.White})}return a.prototype.image=function(a,b){var c=document.createElement("img"),d=document.createElement("canvas");d.width=a,d.height=b;var e=d.getContext("2d");return this.draw(e,0,0,a,b),c.src=d.toDataURL(),c},a.prototype.draw=function(a,b,c,d,e){for(var f=this.generator.grid(d,e),g=a.getImageData(b,c,d,e),h=0;h<e;h++)for(var i=0;i<d;i++){var j=f[i+d*h],k=255&Math.floor(255*j),l=4*(i+h*g.width),m=this.colorFcn(k);g.data[l]=m.r,g.data[l+1]=m.g,g.data[l+2]=m.b,g.data[l+3]=Math.floor(255*m.a)}a.putImageData(g,b,c)},a}();b.PerlinDrawer2D=i}),c("Math/Index",["require","exports","Math/PerlinNoise","Math/Random"],function(a,b,c,d){"use strict";function e(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),e(c),e(d)}),c("PostProcessing/IPostProcessor",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("PostProcessing/ColorBlindCorrector",["require","exports","Util/Log"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.Protanope=0]="Protanope",a[a.Deuteranope=1]="Deuteranope",a[a.Tritanope=2]="Tritanope"}(d=b.ColorBlindness||(b.ColorBlindness={}));var e=function(){function a(a,b,e){void 0===b&&(b=!1),void 0===e&&(e=d.Protanope),this.engine=a,this.simulate=b,this.colorMode=e,this._vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",this._fragmentShader="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {vec4 o =  texture2D(u_image, v_texCoord);float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);//MODE CODE//vec4 error;error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);error.a = 1.0;vec4 diff = o - error;vec4 correction;correction.r = 0.0;correction.g =  (diff.r * 0.7) + (diff.g * 1.0);correction.b =  (diff.r * 0.7) + (diff.b * 1.0);correction = o + correction;correction.a = o.a;//SIMULATE//}",this._internalCanvas=document.createElement("canvas"),this._internalCanvas.width=a.getDrawWidth(),this._internalCanvas.height=a.getDrawHeight(),this._gl=this._internalCanvas.getContext("webgl",{preserveDrawingBuffer:!0}),this._program=this._gl.createProgram();var f=this._getShader("Fragment",this._getFragmentShaderByMode(e)),g=this._getShader("Vertex",this._vertexShader);this._gl.attachShader(this._program,g),this._gl.attachShader(this._program,f),this._gl.linkProgram(this._program),this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||c.Logger.getInstance().error("Unable to link shader program!"),this._gl.useProgram(this._program)}return a.prototype._getFragmentShaderByMode=function(a){var b="";return a===d.Protanope?b="float l = 0.0 * L + 2.02344 * M + -2.52581 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":a===d.Deuteranope?b="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.494207 * L + 0.0 * M + 1.24827 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":a===d.Tritanope&&(b="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = -0.395913 * L + 0.801109 * M + 0.0 * S;"),this.simulate?this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = error.rgba;"):this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = correction.rgba;"),this._fragmentShader.replace("//MODE CODE//",b)},a.prototype._setRectangle=function(a,b,c,d){var e=a,f=a+c,g=b,h=b+d;this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([e,g,f,g,e,h,e,h,f,g,f,h]),this._gl.STATIC_DRAW)},a.prototype._getShader=function(a,b){var d;return"Fragment"===a?d=this._gl.createShader(this._gl.FRAGMENT_SHADER):"Vertex"===a?d=this._gl.createShader(this._gl.VERTEX_SHADER):c.Logger.getInstance().error("Error unknown shader type",a),this._gl.shaderSource(d,b),this._gl.compileShader(d),this._gl.getShaderParameter(d,this._gl.COMPILE_STATUS)?d:(c.Logger.getInstance().error("Unable to compile shader!",this._gl.getShaderInfoLog(d)),null)},a.prototype.process=function(a,b){var c=this._gl.getAttribLocation(this._program,"a_position"),d=this._gl.getAttribLocation(this._program,"a_texCoord"),e=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(d),this._gl.vertexAttribPointer(d,2,this._gl.FLOAT,!1,0,0);var f=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,f),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,a);var g=this._gl.getUniformLocation(this._program,"u_resolution");this._gl.uniform2f(g,this._internalCanvas.width,this._internalCanvas.height);var h=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,h),this._gl.enableVertexAttribArray(c),this._gl.vertexAttribPointer(c,2,this._gl.FLOAT,!1,0,0),this._setRectangle(0,0,a.width,a.height),this._gl.drawArrays(this._gl.TRIANGLES,0,6);var i=new Uint8Array(a.width*a.height*4);this._gl.readPixels(0,0,a.width,a.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i),a.data.set(i),b.putImageData(a,0,0)},a}();b.ColorBlindCorrector=e}),c("PostProcessing/Index",["require","exports","PostProcessing/ColorBlindCorrector"],function(a,b,c){"use strict";function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),d(c)}),c("Resources/Index",["require","exports","Resources/Resource","Resources/Sound","Resources/Texture"],function(a,b,c,d,e){"use strict";function f(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),f(c),f(d),f(e)}),c("Input/Gamepad",["require","exports","Class","Events"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f=function(a){function b(b){var c=a.call(this)||this;return c.enabled=!1,c.supported=!!navigator.getGamepads,c._gamePadTimeStamps=[0,0,0,0],c._oldPads=[],c._pads=[],c._initSuccess=!1,c._navigator=navigator,c._minimumConfiguration=null,c._engine=b,c}return e(b,a),b.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},b.prototype.setMinimumGamepadConfiguration=function(a){this._enableAndUpdate(),this._minimumConfiguration=a},b.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update())},b.prototype._isGamepadValid=function(a){if(!this._minimumConfiguration)return!0;if(!a)return!1;var b=a.axes.filter(function(a){return void 0!==typeof a}).length,c=a.buttons.filter(function(a){return void 0!==typeof a}).length;return b>=this._minimumConfiguration.axis&&c>=this._minimumConfiguration.buttons&&a.connected},b.prototype.on=function(b,c){this._enableAndUpdate(),a.prototype.on.call(this,b,c)},b.prototype.off=function(b,c){this._enableAndUpdate(),a.prototype.off.call(this,b,c)},b.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var a=this._navigator.getGamepads(),b=0;b<a.length;b++)if(a[b]){if(!this.at(b).connected&&this._isGamepadValid(a[b])&&this.eventDispatcher.emit("connect",new d.GamepadConnectEvent(b,this.at(b))),this.at(b).connected=!0,!a[b].timestamp||a[b].timestamp!==this._gamePadTimeStamps[b]){this._gamePadTimeStamps[b]=a[b].timestamp,this.at(b).navigatorGamepad=a[b];var c,e,f,g,j;for(c in h)e=h[c],"number"==typeof e&&a[b].buttons[e]&&(j=a[b].buttons[e].value,j!==this._oldPads[b].getButton(e)&&(a[b].buttons[e].pressed?(this.at(b).updateButton(e,j),this.at(b).eventDispatcher.emit("button",new d.GamepadButtonEvent(e,j,this.at(b)))):this.at(b).updateButton(e,0)));for(f in i)g=i[f],"number"==typeof g&&(j=a[b].axes[g],j!==this._oldPads[b].getAxes(g)&&(this.at(b).updateAxes(g,j),this.at(b).eventDispatcher.emit("axis",new d.GamepadAxisEvent(g,j,this.at(b)))));this._oldPads[b]=this._clonePad(a[b])}}else{var k=this.at(b);k.connected&&this.eventDispatcher.emit("disconnect",new d.GamepadDisconnectEvent(b,k)),k.connected=!1}}},b.prototype.at=function(a){if(this._enableAndUpdate(),a>=this._pads.length)for(var b=this._pads.length-1,c=a;b<c;b++)this._pads.push(new g),this._oldPads.push(new g);return this._pads[a]},b.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var a=[],b=0;b<this._pads.length;b++)this._isGamepadValid(this.at(b).navigatorGamepad)&&this.at(b).connected&&a.push(this.at(b));return a},b.prototype.count=function(){return this._pads.filter(function(a){return a.connected}).length},b.prototype._clonePads=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(this._clonePad(a[c]));return b},b.prototype._clonePad=function(a){var b,c,d=new g;if(!a)return d;for(b=0,c=a.buttons.length;b<c;b++)a.buttons[b]&&d.updateButton(b,a.buttons[b].value);for(b=0,c=a.axes.length;b<c;b++)d.updateAxes(b,a.axes[b]);return d},b}(c.Class);f.MinAxisMoveThreshold=.05,b.Gamepads=f;var g=function(a){function b(){var b=a.call(this)||this;b.connected=!1,b._buttons=new Array(16),b._axes=new Array(4);var c;for(c=0;c<b._buttons.length;c++)b._buttons[c]=0;for(c=0;c<b._axes.length;c++)b._axes[c]=0;return b}return e(b,a),b.prototype.isButtonPressed=function(a,b){return void 0===b&&(b=1),this._buttons[a]>=b},b.prototype.getButton=function(a){return this._buttons[a]},b.prototype.getAxes=function(a){var b=this._axes[a];return Math.abs(b)<f.MinAxisMoveThreshold?0:b},b.prototype.updateButton=function(a,b){this._buttons[a]=b},b.prototype.updateAxes=function(a,b){this._axes[a]=b},b}(c.Class);b.Gamepad=g;var h;!function(a){a[a.Face1=0]="Face1",a[a.Face2=1]="Face2",a[a.Face3=2]="Face3",a[a.Face4=3]="Face4",a[a.LeftBumper=4]="LeftBumper",a[a.RightBumper=5]="RightBumper",a[a.LeftTrigger=6]="LeftTrigger",a[a.RightTrigger=7]="RightTrigger",a[a.Select=8]="Select",a[a.Start=9]="Start",a[a.LeftStick=10]="LeftStick",a[a.RightStick=11]="RightStick",a[a.DpadUp=12]="DpadUp",a[a.DpadDown=13]="DpadDown",a[a.DpadLeft=14]="DpadLeft",a[a.DpadRight=15]="DpadRight"}(h=b.Buttons||(b.Buttons={}));var i;!function(a){a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY"}(i=b.Axes||(b.Axes={}))}),c("Input/Pointer",["require","exports","Engine","Events","UIActor","Algebra","Class","Util/Util"],function(a,b,c,d,f,g,h,i){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var j;!function(a){a[a.Touch=0]="Touch",a[a.Mouse=1]="Mouse",a[a.Pen=2]="Pen",a[a.Unknown=3]="Unknown"}(j=b.PointerType||(b.PointerType={}));var k;!function(a){a[a.Left=0]="Left",a[a.Middle=1]="Middle",a[a.Right=2]="Right",a[a.Unknown=3]="Unknown"}(k=b.PointerButton||(b.PointerButton={}));var l;!function(a){a[a.Pixel=0]="Pixel",a[a.Line=1]="Line",a[a.Page=2]="Page"}(l=b.WheelDeltaMode||(b.WheelDeltaMode={}));var m;!function(a){a[a.Canvas=0]="Canvas",a[a.Document=1]="Document"}(m=b.PointerScope||(b.PointerScope={}));var n=-.025,o=function(a){function b(b,c,d,e,f,g,h,i,j,k){var l=a.call(this)||this;return l.x=b,l.y=c,l.pageX=d,l.pageY=e,l.screenX=f,l.screenY=g,l.index=h,l.pointerType=i,l.button=j,l.ev=k,l}return e(b,a),b}(d.GameEvent);b.PointerEvent=o;var p=function(a){function b(b,c,d,e,f,g,h,i,j,k,l,m){var n=a.call(this)||this;return n.x=b,n.y=c,n.pageX=d,n.pageY=e,n.screenX=f,n.screenY=g,n.index=h,n.deltaX=i,n.deltaY=j,n.deltaZ=k,n.deltaMode=l,n.ev=m,n}return e(b,a),b}(d.GameEvent);b.WheelEvent=p;var q=function(a){function b(b){var c=a.call(this)||this;return c._pointerDown=[],c._pointerUp=[],c._pointerMove=[],c._pointerCancel=[],c._wheel=[],c._pointers=[],c._activePointers=[],c._engine=b,c._pointers.push(new r),c._activePointers=[-1],c.primary=c._pointers[0],c}return e(b,a),b.prototype.on=function(b,c){a.prototype.on.call(this,b,c)},b.prototype.init=function(a){a=a||this._engine.canvas,a.addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),a.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),a.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),a.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",a.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),a.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),a.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),a.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerMove))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",a.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),a.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),a.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),a.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerMove))):(a.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),a.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),a.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove))),"onwheel"in document.createElement("div")?a.addEventListener("wheel",this._handleWheelEvent("wheel",this._wheel)):void 0!==document.onmousewheel?a.addEventListener("mousewheel",this._handleWheelEvent("wheel",this._wheel)):a.addEventListener("MozMousePixelScroll",this._handleWheelEvent("wheel",this._wheel))},b.prototype.update=function(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0,this._wheel.length=0},b.prototype.at=function(a){if(a>=this._pointers.length)for(var b=this._pointers.length-1,c=a;b<c;b++)this._pointers.push(new r),this._activePointers.push(-1);return this._pointers[a]},b.prototype.count=function(){return this._pointers.length},b.prototype.propogate=function(a){var b=a instanceof f.UIActor,c=0,d=this._pointerUp.length;for(c;c<d;c++)a.contains(this._pointerUp[c].x,this._pointerUp[c].y,!b)&&a.eventDispatcher.emit("pointerup",this._pointerUp[c]);for(c=0,d=this._pointerDown.length,c;c<d;c++)a.contains(this._pointerDown[c].x,this._pointerDown[c].y,!b)&&a.eventDispatcher.emit("pointerdown",this._pointerDown[c]);if(a.capturePointer.captureMoveEvents)for(c=0,d=this._pointerMove.length,c;c<d;c++)a.contains(this._pointerMove[c].x,this._pointerMove[c].y,!b)&&a.eventDispatcher.emit("pointermove",this._pointerMove[c]);for(c=0,d=this._pointerCancel.length,c;c<d;c++)a.contains(this._pointerCancel[c].x,this._pointerCancel[c].y,!b)&&a.eventDispatcher.emit("pointercancel",this._pointerCancel[c]);for(c=0,d=this._wheel.length,c;c<d;c++)a.contains(this._wheel[c].x,this._wheel[c].y,!b)&&a.eventDispatcher.emit("pointerwheel",this._wheel[c])},b.prototype._handleMouseEvent=function(a,b){var c=this;return function(d){d.preventDefault();var e=d.pageX-i.getPosition(c._engine.canvas).x,f=d.pageY-i.getPosition(c._engine.canvas).y,h=c._engine.screenToWorldCoordinates(new g.Vector(e,f)),k=new o(h.x,h.y,d.pageX,d.pageY,e,f,0,j.Mouse,d.button,d);b.push(k),c.at(0).eventDispatcher.emit(a,k)}},b.prototype._handleTouchEvent=function(a,b){var c=this;return function(d){d.preventDefault();for(var e=0,f=d.changedTouches.length;e<f;e++){var h=c._pointers.length>1?c._getPointerIndex(d.changedTouches[e].identifier):0;if(h!==-1){var l=d.changedTouches[e].pageX-i.getPosition(c._engine.canvas).x,m=d.changedTouches[e].pageY-i.getPosition(c._engine.canvas).y,n=c._engine.screenToWorldCoordinates(new g.Vector(l,m)),p=new o(n.x,n.y,d.changedTouches[e].pageX,d.changedTouches[e].pageY,l,m,h,j.Touch,k.Unknown,d);b.push(p),c.at(h).eventDispatcher.emit(a,p),c._pointers.length>1&&("up"===a?c._activePointers[h]=-1:"down"===a&&(c._activePointers[h]=d.changedTouches[e].identifier))}}}},b.prototype._handlePointerEvent=function(a,b){var c=this;return function(d){d.preventDefault();var e=c._pointers.length>1?c._getPointerIndex(d.pointerId):0;if(e!==-1){var f=d.pageX-i.getPosition(c._engine.canvas).x,h=d.pageY-i.getPosition(c._engine.canvas).y,j=c._engine.screenToWorldCoordinates(new g.Vector(f,h)),k=new o(j.x,j.y,d.pageX,d.pageY,f,h,e,c._stringToPointerType(d.pointerType),d.button,d);b.push(k),c.at(e).eventDispatcher.emit(a,k),c._pointers.length>1&&("up"===a?c._activePointers[e]=-1:"down"===a&&(c._activePointers[e]=d.pointerId))}}},b.prototype._handleWheelEvent=function(a,b){var d=this;return function(e){(d._engine.pageScrollPreventionMode===c.ScrollPreventionMode.All||d._engine.pageScrollPreventionMode===c.ScrollPreventionMode.Canvas&&e.target===d._engine.canvas)&&e.preventDefault();var f=e.pageX-i.getPosition(d._engine.canvas).x,h=e.pageY-i.getPosition(d._engine.canvas).y,j=d._engine.screenToWorldCoordinates(new g.Vector(f,h)),k=e.deltaX||e.wheelDeltaX*n||0,m=e.deltaY||e.wheelDeltaY*n||e.wheelDelta*n||e.detail||0,o=e.deltaZ||0,q=l.Pixel;e.deltaMode&&(1===e.deltaMode?q=l.Line:2===e.deltaMode&&(q=l.Page));var r=new p(j.x,j.y,e.pageX,e.pageY,f,h,0,k,m,o,q,e);b.push(r),d.at(0).eventDispatcher.emit(a,r)}},b.prototype._getPointerIndex=function(a){var b;if((b=this._activePointers.indexOf(a))>-1)return b;for(var c=0;c<this._activePointers.length;c++)if(this._activePointers[c]===-1)return c;return-1},b.prototype._stringToPointerType=function(a){switch(a){case"touch":return j.Touch;case"mouse":return j.Mouse;case"pen":return j.Pen;default:return j.Unknown}},b}(h.Class);b.Pointers=q;var r=function(a){function b(){var b=a.call(this)||this;return b.lastPagePos=null,b.lastScreenPos=null,b.lastWorldPos=null,b.on("move",b._onPointerMove),b}return e(b,a),b.prototype._onPointerMove=function(a){this.lastWorldPos=new g.Vector(a.x,a.y),this.lastPagePos=new g.Vector(a.pageX,a.pageY),this.lastScreenPos=new g.Vector(a.screenX,a.screenY)},b}(h.Class);b.Pointer=r}),c("Input/Keyboard",["require","exports","Class","Events"],function(a,b,c,d){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var f;!function(a){a[a.Num1=97]="Num1",a[a.Num2=98]="Num2",a[a.Num3=99]="Num3",a[a.Num4=100]="Num4",a[a.Num5=101]="Num5",a[a.Num6=102]="Num6",a[a.Num7=103]="Num7",a[a.Num8=104]="Num8",a[a.Num9=105]="Num9",a[a.Num0=96]="Num0",a[a.Numlock=144]="Numlock",a[a.Semicolon=186]="Semicolon",a[a.A=65]="A",a[a.B=66]="B",a[a.C=67]="C",a[a.D=68]="D",a[a.E=69]="E",a[a.F=70]="F",a[a.G=71]="G",a[a.H=72]="H",a[a.I=73]="I",a[a.J=74]="J",a[a.K=75]="K",a[a.L=76]="L",a[a.M=77]="M",a[a.N=78]="N",a[a.O=79]="O",a[a.P=80]="P",a[a.Q=81]="Q",a[a.R=82]="R",a[a.S=83]="S",a[a.T=84]="T",a[a.U=85]="U",a[a.V=86]="V",a[a.W=87]="W",a[a.X=88]="X",a[a.Y=89]="Y",a[a.Z=90]="Z",a[a.Shift=16]="Shift",a[a.Alt=18]="Alt",a[a.Up=38]="Up",a[a.Down=40]="Down",a[a.Left=37]="Left",a[a.Right=39]="Right",a[a.Space=32]="Space",a[a.Esc=27]="Esc"}(f=b.Keys||(b.Keys={}));var g=function(a){function b(b){var c=a.call(this)||this;return c.key=b,c}return e(b,a),b}(d.GameEvent);b.KeyEvent=g;var h=function(a){function b(b){var c=a.call(this)||this;return c._keys=[],c._keysUp=[],c._keysDown=[],c._engine=b,c}return e(b,a),b.prototype.on=function(b,c){a.prototype.on.call(this,b,c)},b.prototype.init=function(a){var b=this;a=a||window,a.addEventListener("blur",function(){b._keys.length=0}),a.addEventListener("keyup",function(a){var c=b._normalizeKeyCode(a.keyCode),d=b._keys.indexOf(c);b._keys.splice(d,1),b._keysUp.push(c);var e=new g(c);b.eventDispatcher.emit("up",e),b.eventDispatcher.emit("release",e)}),a.addEventListener("keydown",function(a){var c=b._normalizeKeyCode(a.keyCode);if(b._keys.indexOf(c)===-1){b._keys.push(c),b._keysDown.push(c);var d=new g(c);b.eventDispatcher.emit("down",d),b.eventDispatcher.emit("press",d)}})},b.prototype.update=function(){this._keysDown.length=0,this._keysUp.length=0;for(var a=0;a<this._keys.length;a++)this.eventDispatcher.emit("hold",new g(this._keys[a]))},b.prototype.getKeys=function(){return this._keys},b.prototype.wasPressed=function(a){return this._keysDown.indexOf(a)>-1},b.prototype.isHeld=function(a){return this._keys.indexOf(a)>-1},b.prototype.wasReleased=function(a){return this._keysUp.indexOf(a)>-1},b.prototype._normalizeKeyCode=function(a){switch(a){case 59:return f.Semicolon;default:return a}},b}(c.Class);b.Keyboard=h}),c("Input/IEngineInput",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})}),c("Input/Index",["require","exports","Input/Gamepad","Input/Pointer","Input/Keyboard"],function(a,b,c,d,e){"use strict";function f(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),f(c),f(d),f(e)}),c("Util/Index",["require","exports","Util/Util","Util/DrawUtil"],function(a,b,c,d){"use strict";function e(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),e(c),b.DrawUtil=d}),c("Util/Detector",["require","exports","Util/Log"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"},e=function(){function a(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},arrayBufferSupport:function(){var a=new XMLHttpRequest;a.open("GET","/");try{a.responseType="arraybuffer"}catch(a){return!1}return"arraybuffer"===a.responseType},dataUrlSupport:function(){var a=document.createElement("canvas");return 0===a.toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){var a=document.createElement("a").style;return a.cssText="background-color:rgba(150,255,150,.5)",(""+a.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}return a.prototype.getBrowserFeatures=function(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features},a.prototype.logBrowserFeatures=function(){for(var a="%cSUPPORTED BROWSER FEATURES\n==========================%c\n",b=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],c=this.getBrowserFeatures(),e=0,f=Object.keys(d);e<f.length;e++){var g=f[e];c[g]?(a+="(%c✓%c)",b.push("font-weight: bold; color: green"),b.push("font-weight: normal; color: inherit")):(a+="(%c✗%c)",b.push("font-weight: bold; color: red"),b.push("font-weight: normal; color: inherit")),a+=" "+d[g]+"\n"}b.unshift(a),console.log.apply(console,b)},a.prototype._loadBrowserFeatures=function(){
var a=this;return{canvas:function(){return a._criticalTests.canvasSupport()}(),arraybuffer:function(){return a._criticalTests.arrayBufferSupport()}(),dataurl:function(){return a._criticalTests.dataUrlSupport()}(),objecturl:function(){return a._criticalTests.objectUrlSupport()}(),rgba:function(){return a._criticalTests.rgbaSupport()}(),webaudio:function(){return a._warningTest.webAudioSupport()}(),webgl:function(){return a._warningTest.webglSupport()}(),gamepadapi:function(){return!!navigator.getGamepads}()}},a.prototype.test=function(){var a=!1;for(var b in this._criticalTests)this._criticalTests[b].call(this)||(this.failedTests.push(b),c.Logger.getInstance().error("Critical browser feature missing, Excalibur requires:",b),a=!0);if(a)return!1;for(var d in this._warningTest)this._warningTest[d]()||c.Logger.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",d);return!0},a}();b.Detector=e}),c("Util/SortedList",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a){this._getComparable=a}return a.prototype.find=function(a){return this._find(this._root,a)},a.prototype._find=function(a,b){return null!=a&&(this._getComparable.call(b)===a.getKey()?a.getData().indexOf(b)>-1:this._getComparable.call(b)<a.getKey()?this._find(a.getLeft(),b):this._find(a.getRight(),b))},a.prototype.get=function(a){return this._get(this._root,a)},a.prototype._get=function(a,b){return null==a?[]:b===a.getKey()?a.getData():b<a.getKey()?this._get(a.getLeft(),b):this._get(a.getRight(),b)},a.prototype.add=function(a){return null==this._root?(this._root=new d(this._getComparable.call(a),[a],null,null),!0):this._insert(this._root,a)},a.prototype._insert=function(a,b){return null!=a&&(this._getComparable.call(b)===a.getKey()?!(a.getData().indexOf(b)>-1)&&(a.getData().push(b),!0):this._getComparable.call(b)<a.getKey()?null==a.getLeft()?(a.setLeft(new d(this._getComparable.call(b),[b],null,null)),!0):this._insert(a.getLeft(),b):null==a.getRight()?(a.setRight(new d(this._getComparable.call(b),[b],null,null)),!0):this._insert(a.getRight(),b))},a.prototype.removeByComparable=function(a){this._root=this._remove(this._root,a)},a.prototype._remove=function(a,b){if(null==a)return null;if(this._getComparable.call(b)!==a.getKey())return this._getComparable.call(b)<a.getKey()?(a.setLeft(this._remove(a.getLeft(),b)),a):(a.setRight(this._remove(a.getRight(),b)),a);var c=a.getData().indexOf(b);if(c>-1){if(a.getData().splice(c,1),0===a.getData().length){if(null==a.getLeft()&&null==a.getRight())return null;if(null==a.getLeft())return a.getRight();if(null==a.getRight())return a.getLeft();var d=this._findMinNode(a.getRight());return a.setKey(d.getKey()),a.setData(d.getData()),a.setRight(this._cleanup(a.getRight(),d)),a}return a}return null},a.prototype._cleanup=function(a,b){var c=b.getKey();if(null==a)return null;if(c===a.getKey()){if(null==a.getLeft()&&null==a.getRight())return null;if(null==a.getLeft())return a.getRight();if(null==a.getRight())return a.getLeft();var d=this._findMinNode(a.getRight());return a.setKey(d.getKey()),a.setData(d.getData()),a.setRight(this._cleanup(a.getRight(),d)),a}return this._getComparable.call(b)<a.getKey()?(a.setLeft(this._cleanup(a.getLeft(),b)),a):(a.setRight(this._cleanup(a.getRight(),b)),a)},a.prototype._findMinNode=function(a){for(var b=a;null!=b.getLeft();)b=b.getLeft();return b},a.prototype.list=function(){var a=new Array;return this._list(this._root,a),a},a.prototype._list=function(a,b){null!=a&&(this._list(a.getLeft(),b),a.getData().forEach(function(a){b.push(a)}),this._list(a.getRight(),b))},a}();b.SortedList=c;var d=function(){function a(a,b,c,d){this._key=a,this._data=b,this._left=c,this._right=d}return a.prototype.getKey=function(){return this._key},a.prototype.setKey=function(a){this._key=a},a.prototype.getData=function(){return this._data},a.prototype.setData=function(a){this._data=a},a.prototype.getLeft=function(){return this._left},a.prototype.setLeft=function(a){this._left=a},a.prototype.getRight=function(){return this._right},a.prototype.setRight=function(a){this._right=a},a}();b.BinaryTreeNode=d;var e=function(){function a(a){this._key=0,this._key=a}return a.prototype.getTheKey=function(){return this._key},a.prototype.setKey=function(a){this._key=a},a}();b.MockedElement=e}),c("Index",["require","exports","Actor","Algebra","Camera","Class","Debug","Engine","EventDispatcher","Events","Group","Label","Loader","Particles","Physics","Promises","Scene","TileMap","Timer","Trigger","UIActor","Actions/Index","Collision/Index","Drawing/Index","Math/Index","PostProcessing/Index","Resources/Index","Events","Input/Index","Traits/Index","Util/Index","Util/Decorators","Util/Detector","Util/CullingBox","Util/EasingFunctions","Util/Log","Util/SortedList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){"use strict";function L(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),b.EX_VERSION="0.10.0-alpha.1603+a24cdb6",L(c),L(d),L(e),L(f),L(g),L(h),L(i),L(j),L(k),L(l),L(m),L(n),L(o),L(p),L(q),L(r),L(s),L(t),L(u),L(v),L(w),L(x),L(y),L(z),L(A),b.Events=B,b.Input=C,b.Traits=D,b.Util=E,L(F),L(G),L(H),L(I),L(J),L(K)}),c("Engine",["require","exports","Index","Promises","Algebra","UIActor","Actor","Timer","TileMap","Loader","Util/Detector","Events","Util/Log","Drawing/Color","Scene","Debug","Class","Input/Index","Util/Decorators","Util/Util","Collision/BoundingBox"],function(a,b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var x;!function(a){a[a.FullScreen=0]="FullScreen",a[a.Container=1]="Container",a[a.Fixed=2]="Fixed",a[a.Position=3]="Position"}(x=b.DisplayMode||(b.DisplayMode={}));var y;!function(a){a[a.None=0]="None",a[a.Canvas=1]="Canvas",a[a.All=2]="All"}(y=b.ScrollPreventionMode||(b.ScrollPreventionMode={}));var z=function(a){function b(d){var e=a.call(this)||this;e._hasStarted=!1,e.debug=new r.Debug,e.postProcessors=[],e.scenes={},e._animations=[],e.isFullscreen=!1,e.displayMode=x.FullScreen,e.pauseAudioWhenHidden=!0,e.isDebug=!1,e.debugColor=new p.Color(255,255,255),e.backgroundColor=new p.Color(0,0,100),e.onFatalException=function(a){o.Logger.getInstance().fatal(a)},e._isSmoothingEnabled=!0,e._timescale=1,e._isLoading=!1,d=v.extend({},b._DefaultEngineOptions,d);var f=new m.Detector;if(!d.suppressMinimumBrowserFeatureDetection&&!(e._compatible=f.test())){var g=document.createElement("div");if(g.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(g),f.failedTests.forEach(function(a){var b=document.createElement("div");b.innerText="Browser feature missing "+a,document.body.appendChild(b)}),d.canvasElementId){var h=document.getElementById(d.canvasElementId);h&&h.parentElement.removeChild(h)}return e}return e._compatible=!0,console.log&&!d.suppressConsoleBootMessage&&(console.log("%cPowered by Excalibur.js (v"+c.EX_VERSION+")","background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),e._logger=o.Logger.getInstance(),e._logger.defaultLevel===o.LogLevel.Debug&&f.logBrowserFeatures(),e._logger.debug("Building engine..."),e.canvasElementId=d.canvasElementId,d.canvasElementId?(e._logger.debug("Using Canvas element specified: "+d.canvasElementId),e.canvas=document.getElementById(d.canvasElementId)):(e._logger.debug("Using generated canvas element"),e.canvas=document.createElement("canvas")),d.width&&d.height?(void 0===d.displayMode&&(e.displayMode=x.Fixed),e._logger.debug("Engine viewport is size "+d.width+" x "+d.height),e.canvasWidth=d.width,e.canvas.width=d.width,e.canvasHeight=d.height,e.canvas.height=d.height):d.displayMode||(e._logger.debug("Engine viewport is fullscreen"),e.displayMode=x.FullScreen),e._loader=new l.Loader,e._initialize(d),e.rootScene=e.currentScene=new q.Scene(e),e.addScene("root",e.rootScene),e.goToScene("root"),e}return e(b,a),Object.defineProperty(b.prototype,"fps",{get:function(){return this.stats.currFrame.fps},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"stats",{get:function(){return this.debug.stats},enumerable:!0,configurable:!0}),b.prototype.on=function(b,c){a.prototype.on.call(this,b,c)},b.prototype.getWorldBounds=function(){var a=this.screenToWorldCoordinates(g.Vector.Zero).x,b=this.screenToWorldCoordinates(g.Vector.Zero).y,c=a+this.getDrawWidth(),d=b+this.getDrawHeight();return new w.BoundingBox(a,b,c,d)},Object.defineProperty(b.prototype,"timescale",{get:function(){return this._timescale},set:function(a){return a<=0?void o.Logger.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):void(this._timescale=a)},enumerable:!0,configurable:!0}),b.prototype.playAnimation=function(a,b,c){this._animations.push(new A(a,b,c))},b.prototype.addTileMap=function(a){this.currentScene.addTileMap(a)},b.prototype.removeTileMap=function(a){this.currentScene.removeTileMap(a)},b.prototype.addTimer=function(a){return this.currentScene.addTimer(a)},b.prototype.removeTimer=function(a){return this.currentScene.removeTimer(a)},b.prototype.addScene=function(a,b){this.scenes[a]&&this._logger.warn("Scene",a,"already exists overwriting"),this.scenes[a]=b,b.engine=this},b.prototype.removeScene=function(a){if(a instanceof q.Scene)for(var b in this.scenes)this.scenes.hasOwnProperty(b)&&this.scenes[b]===a&&delete this.scenes[b];"string"==typeof a&&delete this.scenes[a]},b.prototype.add=function(a){return a instanceof h.UIActor?void this.currentScene.addUIActor(a):(a instanceof i.Actor&&this._addChild(a),a instanceof j.Timer&&this.addTimer(a),a instanceof k.TileMap&&this.addTileMap(a),void(2===arguments.length&&this.addScene(arguments[0],arguments[1])))},b.prototype.remove=function(a){return a instanceof h.UIActor?void this.currentScene.removeUIActor(a):(a instanceof i.Actor&&this._removeChild(a),a instanceof j.Timer&&this.removeTimer(a),a instanceof k.TileMap&&this.removeTileMap(a),a instanceof q.Scene&&this.removeScene(a),void("string"==typeof a&&this.removeScene(a)))},b.prototype._addChild=function(a){this.currentScene.add(a)},b.prototype._removeChild=function(a){this.currentScene.remove(a)},b.prototype.goToScene=function(a){if(this.scenes[a]){var b=this.currentScene,c=this.scenes[a];this._logger.debug("Going to scene:",a),this.currentScene.isInitialized&&(this.currentScene.onDeactivate.call(this.currentScene),this.currentScene.eventDispatcher.emit("deactivate",new n.DeactivateEvent(c,this.currentScene))),this.currentScene=c,this.currentScene._initialize(this),this.currentScene.onActivate.call(this.currentScene),this.currentScene.eventDispatcher.emit("activate",new n.ActivateEvent(b,this.currentScene))}else this._logger.error("Scene",a,"does not exist!")},b.prototype.getDrawWidth=function(){return this.currentScene&&this.currentScene.camera?this.canvasWidth/this.currentScene.camera.getZoom():this.canvasWidth},b.prototype.getDrawHeight=function(){return this.currentScene&&this.currentScene.camera?this.canvasHeight/this.currentScene.camera.getZoom():this.canvasHeight},b.prototype.screenToWorldCoordinates=function(a){var b=a.x,c=a.y;if(b=b/this.canvas.clientWidth*this.getDrawWidth(),c=c/this.canvas.clientHeight*this.getDrawHeight(),b-=this.getDrawWidth()/2,c-=this.getDrawHeight()/2,this.currentScene&&this.currentScene.camera){var d=this.currentScene.camera.getFocus();b+=d.x,c+=d.y}return new g.Vector(Math.floor(b),Math.floor(c))},b.prototype.worldToScreenCoordinates=function(a){var b=a.x,c=a.y;if(this.currentScene&&this.currentScene.camera){var d=this.currentScene.camera.getFocus();b-=d.x,c-=d.y}return b+=this.getDrawWidth()/2,c+=this.getDrawHeight()/2,b=b*this.canvas.clientWidth/this.getDrawWidth(),c=c*this.canvas.clientHeight/this.getDrawHeight(),new g.Vector(Math.floor(b),Math.floor(c))},b.prototype._setHeightByDisplayMode=function(a){this.displayMode===x.Container&&(this.canvasWidth=this.canvas.width=a.clientWidth,this.canvasHeight=this.canvas.height=a.clientHeight),this.displayMode===x.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvasWidth=this.canvas.width=a.innerWidth,this.canvasHeight=this.canvas.height=a.innerHeight)},b.prototype._initialize=function(a){var b=this;if(a.displayMode&&(this.displayMode=a.displayMode),this.displayMode===x.FullScreen||this.displayMode===x.Container){var c=this.displayMode===x.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(c),window.addEventListener("resize",function(){b._logger.debug("View port resized"),b._setHeightByDisplayMode(c),b._logger.info("parent.clientHeight "+c.clientHeight),b.setAntialiasing(b._isSmoothingEnabled)})}else if(this.displayMode===x.Position){if(!a.position)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof a.position){var d=a.position.split(" ");switch(d[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";var e=this.getDrawHeight()/-2;this.canvas.style.marginTop=e.toString();break;default:throw new Error("Invalid Position Given")}if(d[1])switch(d[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";var f=this.getDrawWidth()/-2;this.canvas.style.marginLeft=f.toString();break;default:throw new Error("Invalid Position Given")}}else a.position.top&&("number"==typeof a.position.top?this.canvas.style.top=a.position.top.toString()+"px":this.canvas.style.top=a.position.top),a.position.right&&("number"==typeof a.position.right?this.canvas.style.right=a.position.right.toString()+"px":this.canvas.style.right=a.position.right),a.position.bottom&&("number"==typeof a.position.bottom?this.canvas.style.bottom=a.position.bottom.toString()+"px":this.canvas.style.bottom=a.position.bottom),a.position.left&&("number"==typeof a.position.left?this.canvas.style.left=a.position.left.toString()+"px":this.canvas.style.left=a.position.left)}this.input={keyboard:new t.Keyboard(this),pointers:new t.Pointers(this),gamepads:new t.Gamepads(this)},this.input.keyboard.init(),this.input.pointers.init(a&&a.pointerScope===t.PointerScope.Document?document:this.canvas),this.input.gamepads.init(),this.pageScrollPreventionMode=a.scrollPreventionMode;var g,h;"undefined"!=typeof document.hidden?(g="hidden",h="visibilitychange"):"msHidden"in document?(g="msHidden",h="msvisibilitychange"):"webkitHidden"in document&&(g="webkitHidden",h="webkitvisibilitychange"),document.addEventListener(h,function(){document[g]?(b.eventDispatcher.emit("hidden",new n.HiddenEvent(b)),b._logger.debug("Window hidden")):(b.eventDispatcher.emit("visible",new n.VisibleEvent(b)),b._logger.debug("Window visible"))}),this.ctx=this.canvas.getContext("2d"),this.canvasElementId||document.body.appendChild(this.canvas)},b.prototype.setAntialiasing=function(a){this._isSmoothingEnabled=a;var b=this.ctx;b.imageSmoothingEnabled=a;for(var c=0,d=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"];c<d.length;c++){var e=d[c];e in b&&(b[e]=a)}},b.prototype.getAntialiasing=function(){return this.ctx.imageSmoothingEnabled||this.ctx.webkitImageSmoothingEnabled||this.ctx.mozImageSmoothingEnabled||this.ctx.msImageSmoothingEnabled},b.prototype._update=function(a){return this._isLoading?(this._loader.update(this,a),this.input.keyboard.update(),this.input.pointers.update(),void this.input.gamepads.update()):(this.emit("preupdate",new n.PreUpdateEvent(this,a,this)),this.currentScene.update(this,a),this._animations=this._animations.filter(function(a){return!a.animation.isDone()}),this.input.keyboard.update(),this.input.pointers.update(),this.input.gamepads.update(),this.eventDispatcher.emit("update",new n.PostUpdateEvent(this,a,this)),void this.emit("postupdate",new n.PostUpdateEvent(this,a,this)))},b.prototype._draw=function(a){var b=this.ctx;if(this.emit("predraw",new n.PreDrawEvent(b,a,this)),this._isLoading)return void this._loader.draw(b,a);b.clearRect(0,0,this.canvasWidth,this.canvasHeight),b.fillStyle=this.backgroundColor.toString(),b.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.currentScene.draw(this.ctx,a);var c=0,d=this._animations.length;for(c;c<d;c++)this._animations[c].animation.draw(b,this._animations[c].x,this._animations[c].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();for(var e=this.input.keyboard.getKeys(),f=0;f<e.length;f++)this.ctx.fillText(e[f].toString()+" : "+(t.Keys[e[f]]?t.Keys[e[f]]:"Not Mapped"),100,10*f+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}for(var g=0;g<this.postProcessors.length;g++)this.postProcessors[g].process(this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.ctx);this.emit("postdraw",new n.PostDrawEvent(b,a,this))},b.prototype.start=function(a){var c=this;if(!this._compatible){var d=new f.Promise;return d.reject("Excalibur is incompatible with your browser")}var e;return a?(this._loader=a,this._loader.wireEngine(this),e=this.load(this._loader)):e=f.Promise.resolve(),e.then(function(){c.emit("start",new n.GameStartEvent(c))}),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),b.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),e},b.createMainLoop=function(a,b,c){var d=c();return function e(){if(a._hasStarted)try{a._requestId=b(e),a.emit("preframe",new n.PreFrameEvent(a,a.stats.prevFrame));var f=c(),g=Math.floor(f-d)||1;g>200&&(g=1);var h=g*a.timescale,i=a.stats.prevFrame.id+1;a.stats.prevFrame.reset(a.stats.currFrame),a.stats.currFrame.reset(),a.stats.currFrame.id=i,a.stats.currFrame.delta=h,a.stats.currFrame.fps=1/(h/1e3);var j=c();a._update(h);var k=c();a._draw(h);var l=c();a.stats.currFrame.duration.update=k-j,a.stats.currFrame.duration.draw=l-k,d=f,a.emit("postframe",new n.PostFrameEvent(a,a.stats.currFrame))}catch(b){window.cancelAnimationFrame(a._requestId),a.stop(),a.onFatalException(b)}}},b.prototype.stop=function(){this._hasStarted&&(this.emit("stop",new n.GameStopEvent(this)),this._hasStarted=!1,this._logger.debug("Game stopped"))},b.prototype.isPaused=function(){return!this._hasStarted},b.prototype.screenshot=function(){var a=new Image,b=this.canvas.toDataURL("image/png");return a.src=b,a},b.prototype.load=function(a){var b=this,c=new f.Promise;return this._isLoading=!0,a.load().then(function(){setTimeout(function(){b._isLoading=!1,c.resolve()},500)}),c},b}(s.Class);z._DefaultEngineOptions={width:0,height:0,canvasElementId:"",pointerScope:t.PointerScope.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,scrollPreventionMode:y.Canvas},d([u.obsolete({alternateMethod:"ex.Engine.stats.currFrame.fps"})],z.prototype,"fps",null),b.Engine=z;var A=function(){function a(a,b,c){this.animation=a,this.x=b,this.y=c}return a}()}),c("UIActor",["require","exports","Algebra","Actor","Traits/Index"],function(a,b,c,d,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var g=function(a){function b(b,c,e,g){var h=a.call(this,b,c,e,g)||this;return h.traits=[],h.traits.push(new f.CapturePointer),h.anchor.setTo(0,0),h.collisionType=d.CollisionType.PreventCollision,h.enableCapturePointer=!0,h}return e(b,a),b.prototype.onInitialize=function(a){this._engine=a},b.prototype.contains=function(b,d,e){if(void 0===e&&(e=!0),e)return a.prototype.contains.call(this,b,d);var f=this._engine.worldToScreenCoordinates(new c.Vector(b,d));return a.prototype.contains.call(this,f.x,f.y)},b}(d.Actor);b.UIActor=g}),c("Util/Actors",["require","exports","UIActor","Label","Trigger"],function(a,b,c,d,e){"use strict";function f(a){return!(a instanceof c.UIActor||a instanceof e.Trigger||a instanceof d.Label)}function g(a){return a instanceof c.UIActor}Object.defineProperty(b,"__esModule",{value:!0}),b.isVanillaActor=f,b.isUIActor=g}),c("Scene",["require","exports","UIActor","Physics","Events","Util/Log","Timer","Collision/DynamicTreeCollisionBroadphase","Util/SortedList","Group","TileMap","Camera","Actor","Class","Util/Util","Util/Actors"],function(a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var r=function(a){function b(b){var c=a.call(this)||this;return c.children=[],c.tileMaps=[],c.groups={},c.uiActors=[],c._isInitialized=!1,c._sortedDrawingTree=new j.SortedList(n.Actor.prototype.getZIndex),c._broadphase=new i.DynamicTreeCollisionBroadphase,c._killQueue=[],c._timers=[],c._cancelQueue=[],c._logger=g.Logger.getInstance(),c.camera=new m.BaseCamera,b&&(c.camera.x=b.canvasWidth/2,c.camera.y=b.canvasHeight/2),c}return e(b,a),b.prototype.on=function(b,c){a.prototype.on.call(this,b,c)},b.prototype.onInitialize=function(a){this.camera&&(this.camera.x=a.canvasWidth/2,this.camera.y=a.canvasHeight/2),this._logger.debug("Scene.onInitialize",this,a)},b.prototype.onActivate=function(){this._logger.debug("Scene.onActivate",this)},b.prototype.onDeactivate=function(){this._logger.debug("Scene.onDeactivate",this)},b.prototype._initializeChildren=function(){for(var a=0,b=this.children;a<b.length;a++){var c=b[a];c._initialize(this.engine)}},Object.defineProperty(b.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),b.prototype._initialize=function(a){this.isInitialized||(this.onInitialize.call(this,a),this.eventDispatcher.emit("initialize",new f.InitializeEvent(a,this)),this._initializeChildren(),this._isInitialized=!0)},b.prototype.update=function(a,b){this.emit("preupdate",new f.PreUpdateEvent(a,b,this));var c,e;for(this.camera&&this.camera.update(a,b),c=0,e=this._cancelQueue.length;c<e;c++)this.removeTimer(this._cancelQueue[c]);for(this._cancelQueue.length=0,this._timers=this._timers.filter(function(a){return a.update(b),!a.complete}),c=0,e=this.uiActors.length;c<e;c++)this.uiActors[c].update(a,b);for(c=0,e=this.tileMaps.length;c<e;c++)this.tileMaps[c].update(a,b);for(c=0,e=this.children.length;c<e;c++)this.children[c].update(a,b);if(this._collectActorStats(a),this._broadphase&&d.Physics.enabled){var g=Date.now();this._broadphase.update(this.children,b);for(var h=this._broadphase.broadphase(this.children,b,a.stats.currFrame),i=Date.now(),j=Date.now(),k=d.Physics.collisionPasses,l=b/k;k>0;)this._broadphase.narrowphase(h,a.stats.currFrame),this._broadphase.resolve(l,d.Physics.collisionResolutionStrategy),k--;var m=Date.now();a.stats.currFrame.physics.broadphase=i-g,a.stats.currFrame.physics.narrowphase=m-j}var n;for(c=0,e=this._killQueue.length;c<e;c++)n=this.children.indexOf(this._killQueue[c]),n>-1&&(this._sortedDrawingTree.removeByComparable(this._killQueue[c]),this.children.splice(n,1));a.stats.currFrame.actors.killed=this._killQueue.length,this._killQueue.length=0,this.emit("postupdate",new f.PostUpdateEvent(a,b,this))},b.prototype.draw=function(a,b){this.emit("predraw",new f.PreDrawEvent(a,b,this)),a.save(),this.camera&&this.camera.draw(a);var c,d;for(c=0,d=this.tileMaps.length;c<d;c++)this.tileMaps[c].draw(a,b);var e=this._sortedDrawingTree.list();for(c=0,d=e.length;c<d;c++)e[c].visible&&!e[c].isOffScreen&&e[c].draw(a,b);for(this.engine&&this.engine.isDebug&&(a.strokeStyle="yellow",this.debugDraw(a)),a.restore(),c=0,d=this.uiActors.length;c<d;c++)this.uiActors[c].visible&&this.uiActors[c].draw(a,b);if(this.engine&&this.engine.isDebug)for(c=0,d=this.uiActors.length;c<d;c++)this.uiActors[c].debugDraw(a);this.emit("postdraw",new f.PostDrawEvent(a,b,this))},b.prototype.debugDraw=function(a){this.emit("predebugdraw",new f.PreDebugDrawEvent(a,this));var b,c;for(b=0,c=this.tileMaps.length;b<c;b++)this.tileMaps[b].debugDraw(a);for(b=0,c=this.children.length;b<c;b++)this.children[b].debugDraw(a);this._broadphase.debugDraw(a,20),this.camera.debugDraw(a),this.emit("postdebugdraw",new f.PostDebugDrawEvent(a,this))},b.prototype.contains=function(a){return this.children.indexOf(a)>-1},b.prototype.add=function(a){return a instanceof n.Actor&&a.unkill(),a instanceof c.UIActor?void(p.contains(this.uiActors,a)||this.addUIActor(a)):a instanceof n.Actor?void(p.contains(this.children,a)||(this._addChild(a),this._sortedDrawingTree.add(a))):a instanceof h.Timer?void(p.contains(this._timers,a)||this.addTimer(a)):void(a instanceof l.TileMap&&(p.contains(this.tileMaps,a)||this.addTileMap(a)))},b.prototype.remove=function(a){return a instanceof c.UIActor?void this.removeUIActor(a):(a instanceof n.Actor&&(this._broadphase.untrack(a.body),this._removeChild(a)),a instanceof h.Timer&&this.removeTimer(a),void(a instanceof l.TileMap&&this.removeTileMap(a)))},b.prototype.addUIActor=function(a){this.uiActors.push(a),a.scene=this},b.prototype.removeUIActor=function(a){var b=this.uiActors.indexOf(a);b>-1&&this.uiActors.splice(b,1)},b.prototype._addChild=function(a){this._broadphase.track(a.body),a.scene=this,this.children.push(a),this._sortedDrawingTree.add(a),a.parent=this.actor},b.prototype.addTileMap=function(a){this.tileMaps.push(a)},b.prototype.removeTileMap=function(a){var b=this.tileMaps.indexOf(a);b>-1&&this.tileMaps.splice(b,1)},b.prototype._removeChild=function(a){this._broadphase.untrack(a.body),this._killQueue.push(a),a.parent=null},b.prototype.addTimer=function(a){return this._timers.push(a),a.scene=this,a},b.prototype.removeTimer=function(a){var b=this._timers.indexOf(a);return b!==-1&&this._timers.splice(b,1),a},b.prototype.cancelTimer=function(a){return this._cancelQueue.push(a),a},b.prototype.isTimerActive=function(a){return this._timers.indexOf(a)>-1},b.prototype.createGroup=function(a){return new k.Group(a,this)},b.prototype.getGroup=function(a){return this.groups[a]},b.prototype.removeGroup=function(a){"string"==typeof a?delete this.groups[a]:a instanceof k.Group?delete this.groups[a.name]:this._logger.error("Invalid arguments to removeGroup",a)},b.prototype.cleanupDrawTree=function(a){this._sortedDrawingTree.removeByComparable(a)},b.prototype.updateDrawTree=function(a){this._sortedDrawingTree.add(a)},b.prototype._collectActorStats=function(a){for(var b=0,c=this.uiActors;b<c.length;b++){c[b];a.stats.currFrame.actors.ui++}for(var d=0,e=this.children;d<e.length;d++){var f=e[d];a.stats.currFrame.actors.alive++;for(var g=0,h=f.children;g<h.length;g++){var i=h[g];q.isUIActor(i)?a.stats.currFrame.actors.ui++:a.stats.currFrame.actors.alive++}}},b}(o.Class);b.Scene=r}),c("Events",["require","exports"],function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a}();b.GameEvent=c;var d=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.KillEvent=d;var f=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.GameStartEvent=f;var g=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.GameStopEvent=g;var h=function(a){function b(b,c,d){var e=a.call(this)||this;return e.ctx=b,e.delta=c,e.target=d,e}return e(b,a),b}(c);b.PreDrawEvent=h;var i=function(a){function b(b,c,d){var e=a.call(this)||this;return e.ctx=b,e.delta=c,e.target=d,e}return e(b,a),b}(c);b.PostDrawEvent=i;var j=function(a){function b(b,c){var d=a.call(this)||this;return d.ctx=b,d.target=c,d}return e(b,a),b}(c);b.PreDebugDrawEvent=j;var k=function(a){function b(b,c){var d=a.call(this)||this;return d.ctx=b,d.target=c,d}return e(b,a),b}(c);b.PostDebugDrawEvent=k;var l=function(a){function b(b,c,d){var e=a.call(this)||this;return e.engine=b,e.delta=c,e.target=d,e}return e(b,a),b}(c);b.PreUpdateEvent=l;var m=function(a){function b(b,c,d){var e=a.call(this)||this;return e.engine=b,e.delta=c,e.target=d,e}return e(b,a),b}(c);b.PostUpdateEvent=m;var n=function(a){function b(b,c){var d=a.call(this)||this;return d.engine=b,d.prevStats=c,d.target=b,d}return e(b,a),b}(c);b.PreFrameEvent=n;var o=function(a){function b(b,c){var d=a.call(this)||this;return d.engine=b,d.stats=c,d.target=b,d}return e(b,a),b}(c);b.PostFrameEvent=o;var p=function(a){function b(b,c){var d=a.call(this)||this;return d.index=b,d.gamepad=c,d.target=c,d}return e(b,a),b}(c);b.GamepadConnectEvent=p;var q=function(a){function b(b,c){var d=a.call(this)||this;return d.index=b,d.gamepad=c,d.target=c,d}return e(b,a),b}(c);b.GamepadDisconnectEvent=q;var r=function(a){function b(b,c,d){var e=a.call(this)||this;return e.button=b,e.value=c,e.target=d,e}return e(b,a),b}(c);b.GamepadButtonEvent=r;var s=function(a){function b(b,c,d){var e=a.call(this)||this;return e.axis=b,e.value=c,e.target=d,e}return e(b,a),b}(c);b.GamepadAxisEvent=s;var t=function(a){function b(b,c){var d=a.call(this)||this;return d.topic=b,d.handler=c,d}return e(b,a),b}(c);b.SubscribeEvent=t;var u=function(a){function b(b,c){var d=a.call(this)||this;return d.topic=b,d.handler=c,d}return e(b,a),b}(c);b.UnsubscribeEvent=u;var v=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.VisibleEvent=v;var w=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.HiddenEvent=w;var x=function(a){function b(b,c,d,e){var f=a.call(this)||this;return f.actor=b,f.other=c,f.side=d,f.intersection=e,f.target=b,f}return e(b,a),b}(c);b.CollisionEvent=x;var y=function(a){function b(b,c){var d=a.call(this)||this;return d.engine=b,d.target=c,d}return e(b,a),b}(c);b.InitializeEvent=y;var z=function(a){function b(b,c){var d=a.call(this)||this;return d.oldScene=b,d.target=c,d}return e(b,a),b}(c);b.ActivateEvent=z;var A=function(a){function b(b,c){var d=a.call(this)||this;return d.newScene=b,d.target=c,d}return e(b,a),b}(c);b.DeactivateEvent=A;var B=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.ExitViewPortEvent=B;var C=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return e(b,a),b}(c);b.EnterViewPortEvent=C}),c("Class",["require","exports","EventDispatcher"],function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.eventDispatcher=new c.EventDispatcher(this)}return a.prototype.on=function(a,b){this.eventDispatcher.on(a,b)},a.prototype.off=function(a,b){this.eventDispatcher.off(a,b)},a.prototype.emit=function(a,b){this.eventDispatcher.emit(a,b)},a.extend=function(b){var c,d=this;c=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return d.apply(this,arguments)};var e=function(){this.constructor=c};if(e.prototype=d.prototype,c.prototype=new e,b)for(var f in b)b.hasOwnProperty(f)&&(c.prototype[f]=b[f]);return c.extend=a.extend,c},a}();b.Class=d}),c("Actor",["require","exports","Physics","Class","Collision/BoundingBox","Resources/Texture","Events","Drawing/Color","Drawing/Sprite","Util/Log","Actions/ActionContext","Actions/Action","Algebra","Collision/Body","Collision/Side","Traits/Index","Drawing/SpriteEffects","Util/Util"],function(a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var t=function(a){function b(c,d,e,f,g){var h=a.call(this)||this;return h.id=b.maxId++,h.body=new o.Body(h),h._height=0,h._width=0,h.scale=new n.Vector(1,1),h.sx=0,h.sy=0,h.isOffScreen=!1,h.visible=!0,h.opacity=1,h.previousOpacity=1,h.logger=k.Logger.getInstance(),h.scene=null,h.parent=null,h.children=[],h.collisionType=u.PreventCollision,h.collisionGroups=[],h._collisionHandlers={},h._isInitialized=!1,h.frames={},h._effectsDirty=!1,h.currentDrawing=null,h.traits=[],h.enableCapturePointer=!1,h.capturePointer={captureMoveEvents:!1},h._zIndex=0,h._isKilled=!1,h._opacityFx=new r.Opacity(h.opacity),h.pos.x=c||0,h.pos.y=d||0,h._width=e||0,h._height=f||0,g&&(h.color=g.clone(),h.opacity=g.a),h.traits.push(new q.TileMapCollisionDetection),
h.traits.push(new q.OffscreenCulling),h.traits.push(new q.CapturePointer),h.actionQueue=new m.ActionQueue(h),h.actions=new l.ActionContext(h),h.anchor=new n.Vector(.5,.5),h.body.useBoxCollision(),h}return e(b,a),Object.defineProperty(b.prototype,"collisionArea",{get:function(){return this.body.collisionArea},set:function(a){this.body.collisionArea=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this.body.pos.x},set:function(a){this.body.pos.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this.body.pos.y},set:function(a){this.body.pos.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pos",{get:function(){return this.body.pos},set:function(a){this.body.pos.setTo(a.x,a.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"oldPos",{get:function(){return this.body.oldPos},set:function(a){this.body.oldPos.setTo(a.x,a.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vel",{get:function(){return this.body.vel},set:function(a){this.body.vel.setTo(a.x,a.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"oldVel",{get:function(){return this.body.oldVel},set:function(a){this.body.oldVel.setTo(a.x,a.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"acc",{get:function(){return this.body.acc},set:function(a){this.body.acc.setTo(a.x,a.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotation",{get:function(){return this.body.rotation},set:function(a){this.body.rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rx",{get:function(){return this.body.rx},set:function(a){this.body.rx=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"torque",{get:function(){return this.body.torque},set:function(a){this.body.torque=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"mass",{get:function(){return this.body.mass},set:function(a){this.body.mass=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"moi",{get:function(){return this.body.moi},set:function(a){this.body.moi=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"friction",{get:function(){return this.body.friction},set:function(a){this.body.friction=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"restitution",{get:function(){return this.body.restitution},set:function(a){this.body.restitution=a},enumerable:!0,configurable:!0}),b.prototype.onInitialize=function(a){},Object.defineProperty(b.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),b.prototype._initialize=function(a){this.isInitialized||(this.onInitialize(a),this.eventDispatcher.emit("initialize",new h.InitializeEvent(a,this)),this._isInitialized=!0);for(var b=0,c=this.children;b<c.length;b++){var d=c[b];d._initialize(a)}},b.prototype._checkForPointerOptIn=function(a){if(a){var b=a.toLowerCase();"pointerup"!==b&&"pointerdown"!==b&&"pointermove"!==b||(this.enableCapturePointer=!0,"pointermove"===b&&(this.capturePointer.captureMoveEvents=!0))}},b.prototype.on=function(a,b){this._checkForPointerOptIn(a),this.eventDispatcher.on(a,b)},b.prototype.kill=function(){this.scene?(this.emit("kill",new h.KillEvent(this)),this.scene.remove(this),this._isKilled=!0):this.logger.warn("Cannot kill actor, it was never added to the Scene")},b.prototype.unkill=function(){this._isKilled=!1},b.prototype.isKilled=function(){return this._isKilled},b.prototype.add=function(a){a.collisionType=u.PreventCollision,s.addItemToArray(a,this.children)&&(a.parent=this)},b.prototype.remove=function(a){s.removeItemFromArray(a,this.children)&&(a.parent=null)},b.prototype.setDrawing=function(a){a=a.toString(),this.currentDrawing!==this.frames[a]&&(null!=this.frames[a]?(this.frames[a].reset(),this.currentDrawing=this.frames[a]):k.Logger.getInstance().error("the specified drawing key '"+a+"' does not exist"))},b.prototype.addDrawing=function(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1]),this._effectsDirty=!0):(arguments[0]instanceof j.Sprite&&this.addDrawing("default",arguments[0]),arguments[0]instanceof g.Texture&&this.addDrawing("default",arguments[0].asSprite()))},Object.defineProperty(b.prototype,"z",{get:function(){return this.getZIndex()},set:function(a){this.setZIndex(a)},enumerable:!0,configurable:!0}),b.prototype.getZIndex=function(){return this._zIndex},b.prototype.setZIndex=function(a){this.scene.cleanupDrawTree(this),this._zIndex=a,this.scene.updateDrawTree(this)},b.prototype.addCollisionGroup=function(a){this.collisionGroups.push(a)},b.prototype.removeCollisionGroup=function(a){var b=this.collisionGroups.indexOf(a);b!==-1&&this.collisionGroups.splice(b,1)},b.prototype.getCenter=function(){return new n.Vector(this.pos.x+this.getWidth()/2-this.anchor.x*this.getWidth(),this.pos.y+this.getHeight()/2-this.anchor.y*this.getHeight())},b.prototype.getWidth=function(){return this._width*this.getGlobalScale().x},b.prototype.setWidth=function(a){this._width=a/this.scale.x},b.prototype.getHeight=function(){return this._height*this.getGlobalScale().y},b.prototype.setHeight=function(a){this._height=a/this.scale.y},b.prototype.getLeft=function(){return this.getBounds().left},b.prototype.getRight=function(){return this.getBounds().right},b.prototype.getTop=function(){return this.getBounds().top},b.prototype.getBottom=function(){return this.getBounds().bottom},b.prototype.getWorldRotation=function(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation},b.prototype.getWorldPos=function(){if(!this.parent)return this.pos.clone();var a=[],b=this;for(a.push(this);b.parent;)b=b.parent,a.push(b);var c=a.reduceRight(function(a,b){return b.parent?a+b.pos.x*b.getGlobalScale().x:a+b.pos.x},0),d=a.reduceRight(function(a,b){return b.parent?a+b.pos.y*b.getGlobalScale().y:a+b.pos.y},0),e=b.getWorldPos(),f=this.getWorldRotation();return new n.Vector(c,d).rotate(f,e)},b.prototype.getGlobalScale=function(){if(!this.parent)return new n.Vector(this.scale.x,this.scale.y);var a=this.parent.getGlobalScale();return new n.Vector(this.scale.x*a.x,this.scale.y*a.y)},b.prototype.getBounds=function(){var a=this._getCalculatedAnchor(),b=this.getWorldPos();return new f.BoundingBox(b.x-a.x,b.y-a.y,b.x+this.getWidth()-a.x,b.y+this.getHeight()-a.y).rotate(this.rotation,b)},b.prototype.getRelativeBounds=function(){var a=this._getCalculatedAnchor();return new f.BoundingBox(-a.x,-a.y,this.getWidth()-a.x,this.getHeight()-a.y).rotate(this.rotation)},b.prototype.contains=function(a,b,c){void 0===c&&(c=!1);var d=this.getBounds().contains(new n.Vector(a,b));return c?d||this.children.some(function(c){return c.contains(a,b,!0)}):d},b.prototype.getSideFromIntersect=function(a){return a?Math.abs(a.x)>Math.abs(a.y)?a.x<0?p.Side.Right:p.Side.Left:a.y<0?p.Side.Bottom:p.Side.Top:p.Side.None},b.prototype.collidesWithSide=function(a){var b=this.collides(a);return b?Math.abs(b.x)>Math.abs(b.y)?this.pos.x<a.pos.x?p.Side.Right:p.Side.Left:this.pos.y<a.pos.y?p.Side.Bottom:p.Side.Top:p.Side.None},b.prototype.collides=function(a){var b=this.getBounds(),c=a.getBounds(),d=b.collides(c);return d},b.prototype.onCollidesWith=function(a,b){this._collisionHandlers[a]||(this._collisionHandlers[a]=[]),this._collisionHandlers[a].push(b)},b.prototype.getCollisionHandlers=function(){return this._collisionHandlers},b.prototype.removeCollidesWith=function(a){this._collisionHandlers[a]=[]},b.prototype.within=function(a,b){return Math.sqrt(Math.pow(this.pos.x-a.pos.x,2)+Math.pow(this.pos.y-a.pos.y,2))<=b},b.prototype._getCalculatedAnchor=function(){return new n.Vector(this.getWidth()*this.anchor.x,this.getHeight()*this.anchor.y)},b.prototype._reapplyEffects=function(a){a.removeEffect(this._opacityFx),a.addEffect(this._opacityFx)},b.prototype.integrate=function(a){var b=a/1e3,d=this.acc.clone();this.collisionType===u.Active&&d.addEqual(c.Physics.acc),this.vel.addEqual(d.scale(b)),this.pos.addEqual(this.vel.scale(b)).addEqual(d.scale(.5*b*b)),this.rx+=this.torque*(1/this.moi)*b,this.rotation+=this.rx*b,this.scale.x+=this.sx*a/1e3,this.scale.y+=this.sy*a/1e3,this.body.update()},b.prototype.update=function(a,b){this._initialize(a),this.emit("preupdate",new h.PreUpdateEvent(a,b,this)),this.actionQueue.update(b),this.color&&(this.color.a=this.opacity),this.previousOpacity!==this.opacity&&(this.previousOpacity=this.opacity,this._opacityFx.opacity=this.opacity,this._effectsDirty=!0),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.integrate(b);for(var c=0,d=this.traits;c<d.length;c++){var e=d[c];e.update(this,a,b)}for(var f=0;f<this.children.length;f++)this.children[f].update(a,b);this.eventDispatcher.emit("update",new h.PostUpdateEvent(a,b,this)),this.emit("postupdate",new h.PostUpdateEvent(a,b,this))},b.prototype.draw=function(a,b){if(a.save(),a.translate(this.pos.x,this.pos.y),a.rotate(this.rotation),a.scale(this.scale.x,this.scale.y),a.save(),a.translate(-(this._width*this.anchor.x),-(this._height*this.anchor.y)),this.emit("predraw",new h.PreDrawEvent(a,b,this)),this.currentDrawing){var c=this.currentDrawing,d=(this._width-c.naturalWidth*c.scale.x)*this.anchor.x,e=(this._height-c.naturalHeight*c.scale.y)*this.anchor.y;this._effectsDirty&&(this._reapplyEffects(this.currentDrawing),this._effectsDirty=!1),this.currentDrawing.draw(a,d,e)}else this.color&&(a.fillStyle=this.color.toString(),a.fillRect(0,0,this._width,this._height));a.restore();for(var f=0;f<this.children.length;f++)this.children[f].visible&&this.children[f].draw(a,b);this.emit("postdraw",new h.PostDrawEvent(a,b,this)),a.restore()},b.prototype.debugDraw=function(a){this.emit("predebugdraw",new h.PreDebugDrawEvent(a,this)),this.body.debugDraw(a);var b=this.getBounds();b.debugDraw(a),a.fillText("id: "+this.id,b.left+3,b.top+10),a.fillStyle=i.Color.Yellow.toString(),a.beginPath(),a.arc(this.getWorldPos().x,this.getWorldPos().y,3,0,2*Math.PI),a.closePath(),a.fill();for(var c=0;c<this.traits.length;c++)this.traits[c]instanceof q.OffscreenCulling&&this.traits[c].cullingBox.debugDraw(a);a.strokeStyle=i.Color.Yellow.toString(),a.beginPath();var d=Math.min(this.getWidth(),this.getHeight());a.arc(this.getWorldPos().x,this.getWorldPos().y,d,0,2*Math.PI),a.closePath(),a.stroke();var e={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},f=a.font;for(var g in e)a.fillStyle=i.Color.Yellow.toString(),a.font="14px",a.textAlign="center",a.fillText(g,this.getWorldPos().x+Math.cos(e[g])*(d+10),this.getWorldPos().y+Math.sin(e[g])*(d+10));a.font=f;for(var j=0;j<this.children.length;j++)this.children[j].debugDraw(a);this.emit("postdebugdraw",new h.PostDebugDrawEvent(a,this))},b}(d.Class);t.maxId=0,b.Actor=t;var u;!function(a){a[a.PreventCollision=0]="PreventCollision",a[a.Passive=1]="Passive",a[a.Active=2]="Active",a[a.Elastic=3]="Elastic",a[a.Fixed=4]="Fixed"}(u=b.CollisionType||(b.CollisionType={}))}),c("Actions/Action",["require","exports","Actions/RotationType","Algebra","Util/Log","Util/Util"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b,c,e,f){this.actor=a,this.easingFcn=f,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new d.Vector(0,0),this._lerpEnd=new d.Vector(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=e,this._lerpEnd=new d.Vector(b,c)}return a.prototype._initialize=function(){this._lerpStart=new d.Vector(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},a.prototype.update=function(a){this._initialized||(this._initialize(),this._initialized=!0);var b=this.actor.pos.x,c=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(b=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),c=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.pos.x=b,this.actor.pos.y=c,this._currentLerpTime+=a):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y)},a.prototype.isComplete=function(a){return this._stopped||new d.Vector(a.pos.x,a.pos.y).distance(this._lerpStart)>=this._distance},a.prototype.reset=function(){this._initialized=!1},a.prototype.stop=function(){this._stopped=!0},a}();b.EaseTo=g;var h=function(){function a(a,b,c,e){this._started=!1,this._stopped=!1,this._actor=a,this._end=new d.Vector(b,c),this._speed=e}return a.prototype.update=function(a){this._started||(this._started=!0,this._start=new d.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var b=this._dir.scale(this._speed);this._actor.vel.x=b.x,this._actor.vel.y=b.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},a.prototype.isComplete=function(a){return this._stopped||new d.Vector(a.pos.x,a.pos.y).distance(this._start)>=this._distance},a.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.MoveTo=h;var i=function(){function a(a,b,c,f){if(this._started=!1,this._stopped=!1,this._actor=a,this._end=new d.Vector(b,c),f<=0)throw e.Logger.getInstance().error("Attempted to moveBy time less than or equal to zero : "+f),new Error("Cannot move in time <= 0");this._time=f}return a.prototype.update=function(a){this._started||(this._started=!0,this._start=new d.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize(),this._speed=this._distance/(this._time/1e3));var b=this._dir.scale(this._speed);this._actor.vel.x=b.x,this._actor.vel.y=b.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},a.prototype.isComplete=function(a){return this._stopped||new d.Vector(a.pos.x,a.pos.y).distance(this._start)>=this._distance},a.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.MoveBy=i;var j=function(){function a(a,b,c){this._started=!1,this._stopped=!1,this._actor=a,this._actorToFollow=b,this._current=new d.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new d.Vector(b.pos.x,b.pos.y),this._maximumDistance=void 0!==c?c:this._current.distance(this._end),this._speed=0}return a.prototype.update=function(a){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var b=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==b&&(this._speed=b),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var c=this._dir.scale(this._speed);this._actor.vel.x=c.x,this._actor.vel.y=c.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},a.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},a.prototype.isComplete=function(){return this._stopped},a.prototype.reset=function(){this._started=!1},a}();b.Follow=j;var k=function(){function a(a,b,c){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=a,this._actorToMeet=b,this._current=new d.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new d.Vector(b.pos.x,b.pos.y),this._speed=c||0,void 0!==c&&(this._speedWasSpecified=!0)}return a.prototype.update=function(a){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var b=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===b||this._speedWasSpecified||(this._speed=b),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var c=this._dir.scale(this._speed);this._actor.vel.x=c.x,this._actor.vel.y=c.y,this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},a.prototype.isComplete=function(){return this._stopped||this._distanceBetween<=1},a.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.Meet=k;var l=function(){function a(a,b,d,e){this._started=!1,this._stopped=!1,this._actor=a,this._end=b,this._speed=d,this._rotationType=e||c.RotationType.ShortestPath}return a.prototype.update=function(a){if(!this._started){this._started=!0,this._start=this._actor.rotation;var b=Math.abs(this._end-this._start),d=f.TwoPI-b;switch(b>d?(this._shortDistance=d,this._longDistance=b):(this._shortDistance=b,this._longDistance=d),this._shortestPathIsPositive=(this._start-this._end+f.TwoPI)%f.TwoPI>=Math.PI,this._rotationType){case c.RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case c.RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case c.RotationType.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case c.RotationType.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},a.prototype.isComplete=function(){var a=Math.abs(this._actor.rotation-this._start);return this._stopped||a>=Math.abs(this._distance)},a.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.RotateTo=l;var m=function(){function a(a,b,d,e){this._started=!1,this._stopped=!1,this._actor=a,this._end=b,this._time=d,this._rotationType=e||c.RotationType.ShortestPath}return a.prototype.update=function(a){if(!this._started){this._started=!0,this._start=this._actor.rotation;var b=Math.abs(this._end-this._start),d=f.TwoPI-b;switch(b>d?(this._shortDistance=d,this._longDistance=b):(this._shortDistance=b,this._longDistance=d),this._shortestPathIsPositive=(this._start-this._end+f.TwoPI)%f.TwoPI>=Math.PI,this._rotationType){case c.RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case c.RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case c.RotationType.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case c.RotationType.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}this._speed=Math.abs(this._distance/this._time*1e3)}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},a.prototype.isComplete=function(){var a=Math.abs(this._actor.rotation-this._start);return this._stopped||a>=Math.abs(this._distance)},a.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.RotateBy=m;var n=function(){function a(a,b,c,d,e){this._started=!1,this._stopped=!1,this._actor=a,this._endX=b,this._endY=c,this._speedX=d,this._speedY=e}return a.prototype.update=function(a){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var b=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*b}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var c=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*c}this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},a.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},a.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.ScaleTo=n;var o=function(){function a(a,b,c,d){this._started=!1,this._stopped=!1,this._actor=a,this._endX=b,this._endY=c,this._time=d,this._speedX=(this._endX-this._actor.scale.x)/d*1e3,this._speedY=(this._endY-this._actor.scale.y)/d*1e3}return a.prototype.update=function(a){this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY));var b=this._endX<this._startX?-1:1,c=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*b,this._actor.sy=this._speedY*c,this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},a.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},a.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.ScaleBy=o;var p=function(){function a(a,b){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=a,this._delay=b}return a.prototype.update=function(a){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=a},a.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},a.prototype.stop=function(){this._stopped=!0},a.prototype.reset=function(){this._elapsedTime=0,this._started=!1},a}();b.Delay=p;var q=function(){function a(a,b,c,d){void 0===d&&(d=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=a,this._timeVisible=b,this._timeNotVisible=c,this._duration=(b+c)*d}return a.prototype.update=function(a){this._started||(this._started=!0),this._elapsedTime+=a,this._totalTime+=a,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)},a.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},a.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},a.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},a}();b.Blink=q;var r=function(){function a(a,b,c){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=a,this._endOpacity=b,this._speed=c}return a.prototype.update=function(a){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*a)/this._speed),this._speed-=a,this.isComplete()&&(this._actor.opacity=this._endOpacity),e.Logger.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)},a.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05},a.prototype.stop=function(){this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.Fade=r;var s=function(){function a(a){this._stopped=!1,this._actor=a}return a.prototype.update=function(a){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},a.prototype.isComplete=function(){return this._stopped},a.prototype.stop=function(){},a.prototype.reset=function(){},a}();b.Die=s;var t=function(){function a(a,b){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=a,this._method=b}return a.prototype.update=function(a){this._method.call(this._actor),this._hasBeenCalled=!0},a.prototype.isComplete=function(){return this._hasBeenCalled},a.prototype.reset=function(){this._hasBeenCalled=!1},a.prototype.stop=function(){this._hasBeenCalled=!0},a}();b.CallMethod=t;var u=function(){function a(a,b,c){this._stopped=!1,this._actor=a,this._actionQueue=new w(a),this._repeat=b,this._originalRepeat=b;var d=0,e=c.length;for(d;d<e;d++)c[d].reset(),this._actionQueue.add(c[d])}return a.prototype.update=function(a){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(a)},a.prototype.isComplete=function(){return this._stopped||this._repeat<=0},a.prototype.stop=function(){this._stopped=!0},a.prototype.reset=function(){this._repeat=this._originalRepeat},a}();b.Repeat=u;var v=function(){function a(a,b){this._stopped=!1,this._actor=a,this._actionQueue=new w(a);var c=0,d=b.length;for(c;c<d;c++)b[c].reset(),this._actionQueue.add(b[c])}return a.prototype.update=function(a){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(a))},a.prototype.isComplete=function(){return this._stopped},a.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},a.prototype.reset=function(){},a}();b.RepeatForever=v;var w=function(){function a(a){this._actions=[],this._completedActions=[],this._actor=a}return a.prototype.add=function(a){this._actions.push(a)},a.prototype.remove=function(a){var b=this._actions.indexOf(a);this._actions.splice(b,1)},a.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},a.prototype.getActions=function(){return this._actions.concat(this._completedActions)},a.prototype.hasNext=function(){return this._actions.length>0},a.prototype.reset=function(){this._actions=this.getActions();var a=0,b=this._actions.length;for(a;a<b;a++)this._actions[a].reset();this._completedActions=[]},a.prototype.update=function(a){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(a),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},a}();b.ActionQueue=w}),"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setInterval(a,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError("this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.some||(Array.prototype.some=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;e<c;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),b("Index")});
//# sourceMappingURL=excalibur.min.js.map